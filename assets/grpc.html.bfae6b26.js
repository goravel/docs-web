import{_ as p,r as o,o as c,c as i,b as n,d as t,w as e,e as s,f as l}from"./app.80bfe622.js";const u={},r=n("h1",{id:"grpc",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#grpc","aria-hidden":"true"},"#"),s(" Grpc")],-1),d={class:"table-of-contents"},k=s("\u4ECB\u7ECD"),v=s("\u914D\u7F6E"),g=s("\u63A7\u5236\u5668"),m=s("\u5B9A\u4E49\u8DEF\u7531"),b=s("\u6CE8\u518C\u8DEF\u7531"),h=s("\u542F\u52A8 Grpc \u670D\u52A1\u5668"),f=s("\u62E6\u622A\u5668"),q=l(`<h2 id="\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u4ECB\u7ECD" aria-hidden="true">#</a> \u4ECB\u7ECD</h2><p>Grpc \u6A21\u5757\u53EF\u4EE5\u4F7F\u7528 <code>facades.Grpc</code> \u8FDB\u884C\u64CD\u4F5C\u3002</p><h2 id="\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E" aria-hidden="true">#</a> \u914D\u7F6E</h2><p>\u5728 <code>config/grpc.go</code> \u4E2D\u8FDB\u884C Grpc \u6A21\u5757\u7684\u914D\u7F6E\uFF0C\u5176\u4E2D <code>grpc.host</code> \u914D\u7F6E server \u7684\u57DF\u540D\uFF0C<code>grpc.clients</code> \u914D\u7F6E client \u7684\u76F8\u5173\u4FE1\u606F\u3002</p><h2 id="\u63A7\u5236\u5668" tabindex="-1"><a class="header-anchor" href="#\u63A7\u5236\u5668" aria-hidden="true">#</a> \u63A7\u5236\u5668</h2><p>\u63A7\u5236\u5668\u6587\u4EF6\u53EF\u4EE5\u5B9A\u4E49\u5728 <code>/app/grpc/controllers</code> \u76EE\u5F55\u4E2D\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// app/grpc/controllers</span>
<span class="token keyword">package</span> controllers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;context&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>

  <span class="token string">&quot;github.com/goravel/grpc/protos&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> UserController <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewUserController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>UserController <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>UserController<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>UserController<span class="token punctuation">)</span> <span class="token function">Show</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>protos<span class="token punctuation">.</span>UserRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span>protoBook <span class="token operator">*</span>protos<span class="token punctuation">.</span>UserResponse<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>protos<span class="token punctuation">.</span>UserResponse<span class="token punctuation">{</span>
		Code<span class="token punctuation">:</span> http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5B9A\u4E49\u8DEF\u7531" tabindex="-1"><a class="header-anchor" href="#\u5B9A\u4E49\u8DEF\u7531" aria-hidden="true">#</a> \u5B9A\u4E49\u8DEF\u7531</h2><p>\u6240\u6709\u8DEF\u7531\u6587\u4EF6\u53EF\u4EE5\u5B9A\u4E49\u5728 <code>/routes</code> \u76EE\u5F55\u4E2D\uFF0C\u4F8B\u5982 <code>/routes/grpc.go</code>\u3002\u7136\u540E\u6CE8\u518C\u5230 <code>app/providers/grpc_service_provider.go</code> \u6587\u4EF6\u4E2D\uFF0C\u4EE5\u5B9E\u73B0\u8DEF\u7531\u7684\u7ED1\u5B9A\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// routes/grpc.go</span>
<span class="token keyword">package</span> routes

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/goravel/grpc/protos&quot;</span>
	<span class="token string">&quot;github.com/goravel/framework/facades&quot;</span>

	<span class="token string">&quot;goravel/app/grpc/controllers&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">Grpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  protos<span class="token punctuation">.</span><span class="token function">RegisterUserServer</span><span class="token punctuation">(</span>facades<span class="token punctuation">.</span>Grpc<span class="token punctuation">.</span><span class="token function">Server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> controllers<span class="token punctuation">.</span><span class="token function">NewUserController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6CE8\u518C\u8DEF\u7531" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u518C\u8DEF\u7531" aria-hidden="true">#</a> \u6CE8\u518C\u8DEF\u7531</h3><p>\u8DEF\u7531\u5B9A\u4E49\u597D\u540E\uFF0C\u5728 <code>app/providers/grpc_service_provider.go</code> \u6587\u4EF6\u4E2D\u6CE8\u518C\u8DEF\u7531\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// app/providers/grpc_service_provider.go</span>
<span class="token keyword">package</span> providers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;goravel/routes&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> GrpcServiceProvider <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>router <span class="token operator">*</span>GrpcServiceProvider<span class="token punctuation">)</span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>router <span class="token operator">*</span>GrpcServiceProvider<span class="token punctuation">)</span> <span class="token function">Boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	routes<span class="token punctuation">.</span><span class="token function">Grpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u542F\u52A8-grpc-\u670D\u52A1\u5668" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8-grpc-\u670D\u52A1\u5668" aria-hidden="true">#</a> \u542F\u52A8 Grpc \u670D\u52A1\u5668</h2><p>\u5728 <code>main.go</code> \u4E2D\u542F\u52A8 Grpc.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span>Grpc<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>facades<span class="token punctuation">.</span>Config<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;grpc.host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    facades<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Grpc run error: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u62E6\u622A\u5668" tabindex="-1"><a class="header-anchor" href="#\u62E6\u622A\u5668" aria-hidden="true">#</a> \u62E6\u622A\u5668</h2><p>\u62E6\u622A\u5668\u53EF\u4EE5\u5B9A\u4E49\u5728 <code>app/grpc/inteceptors</code> \u6587\u4EF6\u5939\u4E2D\uFF0C\u7136\u540E\u6CE8\u518C\u5230 <code>app/grpc/kernel.go</code>\u3002</p><p><strong>\u670D\u52A1\u7AEF\u62E6\u622A\u5668</strong></p><p>\u5728 <code>app/grpc/kernel.go:UnaryServerInterceptors</code> \u65B9\u6CD5\u4E2D\u8BBE\u7F6E\u670D\u52A1\u7AEF\u62E6\u622A\u5668\u3002\u4F8B\u5982\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// app/grpc/kernel.go</span>
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;goravel/app/grpc/interceptors&quot;</span>

	<span class="token string">&quot;google.golang.org/grpc&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>kernel <span class="token operator">*</span>Kernel<span class="token punctuation">)</span> <span class="token function">UnaryServerInterceptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>grpc<span class="token punctuation">.</span>UnaryServerInterceptor <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>grpc<span class="token punctuation">.</span>UnaryServerInterceptor<span class="token punctuation">{</span>
		interceptors<span class="token punctuation">.</span>Server<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5BA2\u6237\u7AEF\u62E6\u622A\u5668</strong></p><p>\u5728 <code>app/grpc/kernel.go:UnaryClientInterceptorGroups</code> \u65B9\u6CD5\u4E2D\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u62E6\u622A\u5668\uFF0C\u8BE5\u65B9\u6CD5\u53EF\u4EE5\u5BF9\u62E6\u622A\u5668\u8FDB\u884C\u5206\u7EC4\u3002\u4F8B\u5982\u8BBE\u7F6E <code>trace</code> \u5206\u7EC4\u4E0B\u5305\u542B <code>interceptors.Client</code>\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// app/grpc/kernel.go</span>
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;goravel/app/grpc/interceptors&quot;</span>

	<span class="token string">&quot;google.golang.org/grpc&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>kernel <span class="token operator">*</span>Kernel<span class="token punctuation">)</span> <span class="token function">UnaryClientInterceptorGroups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>grpc<span class="token punctuation">.</span>UnaryClientInterceptor <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>grpc<span class="token punctuation">.</span>UnaryClientInterceptor<span class="token punctuation">{</span>
		<span class="token string">&quot;trace&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
			interceptors<span class="token punctuation">.</span>Client<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5206\u7EC4\u540D <code>trace</code> \u53EF\u4EE5\u88AB\u5E94\u7528\u5230\u914D\u7F6E\u9879 <code>grpc.clients.interceptors</code> \u4E0A\uFF0C\u8FD9\u6837\u8BE5 <code>Client</code> \u5C31\u4F1A\u88AB\u5E94\u7528\u8BE5\u5206\u7EC4\u4E0B\u7684\u6240\u6709\u62E6\u622A\u5668\u3002\u4F8B\u5982\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> config

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/goravel/framework/facades&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	config <span class="token operator">:=</span> facades<span class="token punctuation">.</span>Config
	config<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;grpc&quot;</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
		<span class="token comment">// Grpc Configuration</span>
		<span class="token comment">//</span>
		<span class="token comment">// Configure your server host</span>
		<span class="token string">&quot;host&quot;</span><span class="token punctuation">:</span> config<span class="token punctuation">.</span><span class="token function">Env</span><span class="token punctuation">(</span><span class="token string">&quot;GRPC_HOST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

		<span class="token comment">// Configure your client host and interceptors.</span>
		<span class="token comment">// Interceptors can be the group name of UnaryClientInterceptorGroups in app/grpc/kernel.go.</span>
		<span class="token string">&quot;clients&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span>
			<span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span>
				<span class="token string">&quot;host&quot;</span><span class="token punctuation">:</span>         config<span class="token punctuation">.</span><span class="token function">Env</span><span class="token punctuation">(</span><span class="token string">&quot;GRPC_HOST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">&quot;interceptors&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;trace&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,26);function y(_,w){const a=o("router-link");return c(),i("div",null,[r,n("nav",d,[n("ul",null,[n("li",null,[t(a,{to:"#\u4ECB\u7ECD"},{default:e(()=>[k]),_:1})]),n("li",null,[t(a,{to:"#\u914D\u7F6E"},{default:e(()=>[v]),_:1})]),n("li",null,[t(a,{to:"#\u63A7\u5236\u5668"},{default:e(()=>[g]),_:1})]),n("li",null,[t(a,{to:"#\u5B9A\u4E49\u8DEF\u7531"},{default:e(()=>[m]),_:1}),n("ul",null,[n("li",null,[t(a,{to:"#\u6CE8\u518C\u8DEF\u7531"},{default:e(()=>[b]),_:1})])])]),n("li",null,[t(a,{to:"#\u542F\u52A8-grpc-\u670D\u52A1\u5668"},{default:e(()=>[h]),_:1})]),n("li",null,[t(a,{to:"#\u62E6\u622A\u5668"},{default:e(()=>[f]),_:1})])])]),q])}const x=p(u,[["render",y],["__file","grpc.html.vue"]]);export{x as default};
