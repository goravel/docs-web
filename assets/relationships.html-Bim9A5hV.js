import{_ as i,r as o,o as c,c as l,a as n,b as s,w as e,e as u,d as t}from"./app-DXokG_9I.js";const r={},d=n("h1",{id:"relationships",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#relationships"},[n("span",null,"Relationships")])],-1),k={class:"table-of-contents"},m=u(`<h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction"><span>Introduction</span></a></h2><p>It&#39;s common for database tables to be interconnected. For instance, a blog post may have many comments, or an order may be linked to the user who placed it. <code>Orm</code> simplifies managing and dealing with such relationships, and it can handle various common relationships:</p><ul><li><a href="#One-To-One">One To One</a></li><li><a href="#One-To-Many">One To Many</a></li><li><a href="#Many-To-Many">Many To Many</a></li><li><a href="#Polymorphic">Polymorphic</a></li></ul><h2 id="defining-relationships" tabindex="-1"><a class="header-anchor" href="#defining-relationships"><span>Defining Relationships</span></a></h2><h3 id="one-to-one" tabindex="-1"><a class="header-anchor" href="#one-to-one"><span>One To One</span></a></h3><p>A one-to-one relationship is a very basic type of database relationship. For example, a <code>User</code> model might be associated with one <code>Phone</code> model.</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name  <span class="token builtin">string</span>
  Phone   <span class="token operator">*</span>Phone
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Phone <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  UserID   <span class="token builtin">uint</span>
  Name   <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When using <code>Orm</code>, it automatically assigns the foreign key to the relationship based on the parent model name. For instance, the <code>Phone</code> model is assumed to have a <code>UserID</code> foreign key by default. However, if you wish to change this convention, you can add a <code>foreignKey</code> tag to the <code>Phone</code> field in <code>User</code> model. (This also applies to other relationships.)</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name  <span class="token builtin">string</span>
  Phone   <span class="token operator">*</span>Phone <span class="token string">\`gorm:&quot;foreignKey:UserName&quot;\`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Phone <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  UserName <span class="token builtin">string</span>
  Name   <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Additionally, when using <code>Orm</code>, it is assumed that the foreign key should match the primary key column of the parent. This means that <code>Orm</code> will search for the user&#39;s <code>ID</code> column value in the <code>UserId</code> column of the <code>Phone</code> record. If you wish to use a primary key value other than <code>ID</code>, you can add a &quot;Tag&quot; reference to the <code>Phone</code> field in <code>User</code> model. To do this, simply pass a third argument to the <code>hasOne</code> method. (Other relationship setups are similar.)</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name  <span class="token builtin">string</span>
  Phone   <span class="token operator">*</span>Phone <span class="token string">\`gorm:&quot;foreignKey:UserName;references:name&quot;\`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Phone <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  UserName <span class="token builtin">string</span>
  Name   <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="defining-the-inverse-of-the-relationship" tabindex="-1"><a class="header-anchor" href="#defining-the-inverse-of-the-relationship"><span>Defining The Inverse Of The Relationship</span></a></h4><p>We can access the <code>Phone</code> model from our <code>User</code> model. Now, we need to establish a relationship on <code>Phone</code> model that allows us to access the phone&#39;s owner. To do this, we can define a <code>User</code> field in <code>Phone</code> model.</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name  <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Phone <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  UserID   <span class="token builtin">uint</span>
  Name   <span class="token builtin">string</span>
  User   <span class="token operator">*</span>User
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="one-to-many" tabindex="-1"><a class="header-anchor" href="#one-to-many"><span>One To Many</span></a></h3><p>A one-to-many relationship is used to define relationships where a single model is the parent to one or more child models. For example, a blog post may have an infinite number of comments. Like all other <code>Orm</code> relationships, one-to-many relationships are defined by defining a field on your <code>Orm</code> model:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name   <span class="token builtin">string</span>
  Comments <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Comment
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Comment <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  PostID   <span class="token builtin">uint</span>
  Name   <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Remember, <code>Orm</code> will automatically determine the proper foreign key column for the <code>Comment</code> model. By convention, Orm will take the &quot;hump case&quot; name of the parent model and suffix it with <code>ID</code>. So, in this example, Orm will assume the foreign key column on the <code>Comment</code> model is <code>PostID</code>.</p><h3 id="one-to-many-inverse-belongs-to" tabindex="-1"><a class="header-anchor" href="#one-to-many-inverse-belongs-to"><span>One To Many (Inverse) / Belongs To</span></a></h3><p>Now that we can access all of a post&#39;s comments, let&#39;s define a relationship to allow a comment to access its parent post. To define the inverse of a <code>One To Many</code> relationship, define a relationship method on the child model which calls the <code>belongsTo</code> method:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name   <span class="token builtin">string</span>
  Comments <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Comment
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Comment <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  PostID   <span class="token builtin">uint</span>
  Name   <span class="token builtin">string</span>
  Post   <span class="token operator">*</span>Post
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="many-to-many-relationships" tabindex="-1"><a class="header-anchor" href="#many-to-many-relationships"><span>Many To Many Relationships</span></a></h2><p>Many-to-many relations are slightly more complicated than <code>One To One</code> and <code>One To Many</code> relationships. An example of a many-to-many relationship is a user that has many roles and those roles are also shared by other users in the application. For example, a user may be assigned the role of &quot;Author&quot; and &quot;Editor&quot;; however, those roles may also be assigned to other users as well. So, a user has many roles and a role has many users.</p><h3 id="table-structure" tabindex="-1"><a class="header-anchor" href="#table-structure"><span>Table Structure</span></a></h3><p>To define this relationship, three database tables are needed: <code>users</code>, <code>roles</code>, and <code>role_user</code>. The <code>role_user</code> table naming can be customized and it contains <code>user_id</code> and <code>role_id</code> columns. This table is used as an intermediate table linking users and roles.</p><p>Remember, since a role can belong to many users, we cannot simply place a <code>user_id</code> column on the <code>roles</code> table. This would mean that a role could only belong to a single user. In order to provide support for roles being assigned to multiple users, the <code>role_user</code> table is needed. We can summarize the relationship&#39;s table structure like so:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>users
  id - integer
  name - string

roles
  id - integer
  name - string

role_user
  user_id - integer
  role_id - integer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="model-structure" tabindex="-1"><a class="header-anchor" href="#model-structure"><span>Model Structure</span></a></h3><p>We can define a <code>Roles</code> field on <code>User</code> model:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name  <span class="token builtin">string</span>
  Roles   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Role <span class="token string">\`gorm:&quot;many2many:role_user&quot;\`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Role <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name   <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="defining-the-inverse-of-the-relationship-1" tabindex="-1"><a class="header-anchor" href="#defining-the-inverse-of-the-relationship-1"><span>Defining The Inverse Of The Relationship</span></a></h3><p>To define the inverse of the relationship, just define a <code>Users</code> field in <code>Role</code> model and append a Tag.</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name  <span class="token builtin">string</span>
  Roles   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Role <span class="token string">\`gorm:&quot;many2many:role_user&quot;\`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Role <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name   <span class="token builtin">string</span>
  Users  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>User <span class="token string">\`gorm:&quot;many2many:role_user&quot;\`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="custom-intermediate-table" tabindex="-1"><a class="header-anchor" href="#custom-intermediate-table"><span>Custom intermediate table</span></a></h3><p>In general, the intermediate table foreign key is named by the &quot;snake case&quot; of the parent model name, you can override them by <code>joinForeignKey</code>, <code>joinReferences</code>:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name  <span class="token builtin">string</span>
  Roles   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Role <span class="token string">\`gorm:&quot;many2many:role_user;joinForeignKey:UserName;joinReferences:RoleName&quot;\`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Role <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name   <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Table structure:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>users
  id - integer
  name - string

roles
  id - integer
  name - string

role_user
  user_name - integer
  role_name - integer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="polymorphic" tabindex="-1"><a class="header-anchor" href="#polymorphic"><span>Polymorphic</span></a></h2><p>A polymorphic relationship allows the child model to belong to more than one type of model using a single association. For example, imagine you are building an application that allows users to share blog posts and videos. In such an application, a <code>Comment</code> model might belong to both the <code>Post</code> and <code>Video</code> models.</p><h3 id="table-structure-1" tabindex="-1"><a class="header-anchor" href="#table-structure-1"><span>Table structure</span></a></h3><p>A polymorphic relation is similar to a normal relation; however, the child model can belong to more than one type of model using a single association. For example, a blog <code>Post</code> and a <code>User</code> may share a polymorphic relation to an <code>Image</code> model. Using a polymorphic relation allows you to have a single table of unique images that may be associated with posts and users. First, let&#39;s examine the table structure:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>posts
  id - integer
  name - string

videos
  id - integer
  name - string

images
  id - integer
  url - string
  imageable_id - integer
  imageable_type - string

comments
  id - integer
  body - text
  commentable_id - integer
  commentable_type - string
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note the <code>imageable_id</code> and <code>imageable_type</code> columns on the <code>images</code> table. The <code>imageable_id</code> column will contain the ID value of the post or user, while the <code>imageable_type</code> column will contain the class name of the parent model. The <code>imageable_type</code> column is used by Orm to determine which &quot;type&quot; of parent model to return when accessing the <code>imageable</code> relation. The <code>comments</code> table is similar.</p><h3 id="model-structure-1" tabindex="-1"><a class="header-anchor" href="#model-structure-1"><span>Model Structure</span></a></h3><p>Next, let&#39;s examine the model definitions needed to build this relationship:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name     <span class="token builtin">string</span>
  Image    <span class="token operator">*</span>Image <span class="token string">\`gorm:&quot;polymorphic:Imageable&quot;\`</span>
  Comments <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Comment <span class="token string">\`gorm:&quot;polymorphic:Commentable&quot;\`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Video <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name     <span class="token builtin">string</span>
  Image    <span class="token operator">*</span>Image <span class="token string">\`gorm:&quot;polymorphic:Imageable&quot;\`</span>
  Comments <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Comment <span class="token string">\`gorm:&quot;polymorphic:Commentable&quot;\`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Image <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name          <span class="token builtin">string</span>
  ImageableID   <span class="token builtin">uint</span>
  ImageableType <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Comment <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name            <span class="token builtin">string</span>
  CommentableID   <span class="token builtin">uint</span>
  CommentableType <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can change the polymorphic value by <code>polymorphicValue</code> Tag, such as:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name  <span class="token builtin">string</span>
  Image   <span class="token operator">*</span>Image <span class="token string">\`gorm:&quot;polymorphic:Imageable;polymorphicValue:master&quot;\`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="querying-associations" tabindex="-1"><a class="header-anchor" href="#querying-associations"><span>Querying Associations</span></a></h2><p>For example, imagine a blog application in which a <code>User</code> model has many associated <code>Post</code> models:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name   <span class="token builtin">string</span>
  Posts  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Post
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  UserID   <span class="token builtin">uint</span>
  Name     <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="create-or-update-associations" tabindex="-1"><a class="header-anchor" href="#create-or-update-associations"><span>Create or Update Associations</span></a></h3><p>You can use the <code>Select</code>, <code>Omit</code> methods to to control the create and update of associations. These two method cannot be used at the same time and the associated control functions are only applicable to <code>Create</code>, <code>Update</code>, <code>Save</code>:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>user <span class="token operator">:=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> Posts<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>models<span class="token punctuation">.</span>Post<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment">// Create all child associations while creating User</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>orm<span class="token punctuation">.</span>Associations<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

<span class="token comment">// Only create Post while creating User. Note: If you don&#39;t use \`orm.Associations\`, but customize specific child associations separately, all fields in the parent model should also be listed at this time.</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Post&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

<span class="token comment">// When creating a User, ignore the Post, but create all other child associations</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Omit</span><span class="token punctuation">(</span><span class="token string">&quot;Post&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

<span class="token comment">// When creating User, ignore Name field, but create all child associations</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Omit</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

<span class="token comment">// When creating User, ignore Name field and all child associations</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Omit</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> orm<span class="token punctuation">.</span>Associations<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="find-associations" tabindex="-1"><a class="header-anchor" href="#find-associations"><span>Find Associations</span></a></h3><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// Find all matching related records</span>
<span class="token keyword">var</span> posts <span class="token punctuation">[</span><span class="token punctuation">]</span>models<span class="token punctuation">.</span>Post
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>posts<span class="token punctuation">)</span>

<span class="token comment">// Find associations with conditions</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;goravel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;id desc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>posts<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="append-associations" tabindex="-1"><a class="header-anchor" href="#append-associations"><span>Append Associations</span></a></h3><p>Append new associations for <code>Many To Many</code>, <code>One To Many</code>, replace current association for <code>One To One</code>, <code>One To One(revers)</code>:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>models<span class="token punctuation">.</span>Post<span class="token punctuation">{</span>Post1<span class="token punctuation">,</span> Post2<span class="token punctuation">}</span><span class="token punctuation">)</span>

facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>models<span class="token punctuation">.</span>Post<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;goravel&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="replace-associations" tabindex="-1"><a class="header-anchor" href="#replace-associations"><span>Replace Associations</span></a></h3><p>Replace current associations with new ones:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>models<span class="token punctuation">.</span>Post<span class="token punctuation">{</span>Post1<span class="token punctuation">,</span> Post2<span class="token punctuation">}</span><span class="token punctuation">)</span>

facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Post<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;goravel&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Post2<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="delete-associations" tabindex="-1"><a class="header-anchor" href="#delete-associations"><span>Delete Associations</span></a></h3><p>Remove the relationship between source &amp; arguments if exists, only delete the reference, won’t delete those objects from DB, the foreign key must be NULL:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>models<span class="token punctuation">.</span>Post<span class="token punctuation">{</span>Post1<span class="token punctuation">,</span> Post2<span class="token punctuation">}</span><span class="token punctuation">)</span>

facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>Post1<span class="token punctuation">,</span> Post2<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="clear-associations" tabindex="-1"><a class="header-anchor" href="#clear-associations"><span>Clear Associations</span></a></h3><p>Remove all reference between source &amp; association, won’t delete those associations:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="count-associations" tabindex="-1"><a class="header-anchor" href="#count-associations"><span>Count Associations</span></a></h3><p>Return the count of current associations:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Count with conditions</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;goravel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="batch-data" tabindex="-1"><a class="header-anchor" href="#batch-data"><span>Batch Data</span></a></h3><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// Find all roles for all users</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>posts<span class="token punctuation">)</span>

<span class="token comment">// Delete User A from all user&#39;s Posts</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>userA<span class="token punctuation">)</span>

<span class="token comment">// Get distinct count of all users&#39; Posts</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// For \`Append\`, \`Replace\` with batch data, the length of the arguments needs to be equal to the data&#39;s length or else it will return an error</span>
<span class="token keyword">var</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span>user1<span class="token punctuation">,</span> user2<span class="token punctuation">,</span> user3<span class="token punctuation">}</span>

<span class="token comment">// We have 3 users, Append userA to user1&#39;s team, append userB to user2&#39;s team, append userA, userB and userC to user3&#39;s team</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Team&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>userA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>userB<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span>userA<span class="token punctuation">,</span> userB<span class="token punctuation">,</span> userC<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Reset user1&#39;s team to userA，reset user2&#39;s team to userB, reset user3&#39;s team to userA, userB and userC</span>
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Association</span><span class="token punctuation">(</span><span class="token string">&quot;Team&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>userA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>userB<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span>userA<span class="token punctuation">,</span> userB<span class="token punctuation">,</span> userC<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="eager-loading" tabindex="-1"><a class="header-anchor" href="#eager-loading"><span>Eager Loading</span></a></h2><p>Eager loading conveniences for querying multiple models, and alleviates the &quot;N + 1&quot; query problem. To illustrate the N + 1 query problem, consider a <code>Book</code> model that &quot;belongs to&quot; an <code>Author</code> model:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Author <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name  <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Book <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  AuthorID   <span class="token builtin">uint</span>
  Name       <span class="token builtin">string</span>
  Author     <span class="token operator">*</span>Author
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now, let&#39;s retrieve all books and their authors:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> books models<span class="token punctuation">.</span>Book
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>books<span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> book <span class="token operator">:=</span> <span class="token keyword">range</span> books <span class="token punctuation">{</span>
  <span class="token keyword">var</span> author models<span class="token punctuation">.</span>Author
  facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>author<span class="token punctuation">,</span> book<span class="token punctuation">.</span>AuthorID<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To retrieve all the books in the database table along with their authors, the loop code executes a query for each book. This means that for a collection of 25 books, the loop would run 26 queries - one for the collection of books and 25 more to get the author of each book.</p><p>However, we can simplify this process using eager loading. By using the <code>With</code> method, we can specify which relationships need to be eagerly loaded and reduce the number of queries to just two.</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> books models<span class="token punctuation">.</span>Book
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token string">&quot;Author&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>books<span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> book <span class="token operator">:=</span> <span class="token keyword">range</span> books <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>Author<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For this operation, only two queries will be executed - one query to retrieve all books and one query to retrieve authors for all of the books:</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">\`</span>books<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">\`</span>authors<span class="token punctuation">\`</span></span> <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="eager-loading-multiple-relationships" tabindex="-1"><a class="header-anchor" href="#eager-loading-multiple-relationships"><span>Eager Loading Multiple Relationships</span></a></h3><p>Sometimes you may need to eager load several different relationships. To do so, just call the <code>With</code> method multiple times:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> book models<span class="token punctuation">.</span>Book
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token string">&quot;Author&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token string">&quot;Publisher&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>book<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nested-eager-loading" tabindex="-1"><a class="header-anchor" href="#nested-eager-loading"><span>Nested Eager Loading</span></a></h3><p>To eager load a relationship&#39;s relationships, you may use &quot;dot&quot; syntax. For example, let&#39;s eager load all of the book&#39;s authors and all of the author&#39;s personal contacts:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> book models<span class="token punctuation">.</span>Book
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token string">&quot;Author.Contacts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>book<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="constraining-eager-loads" tabindex="-1"><a class="header-anchor" href="#constraining-eager-loads"><span>Constraining Eager Loads</span></a></h3><p>Sometimes you may wish to eager load a relationship but also specify additional query conditions for the eager loading query. You can accomplish this as below:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;github.com/goravel/framework/contracts/database/orm&quot;</span>

<span class="token keyword">var</span> book models<span class="token punctuation">.</span>Book
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token string">&quot;Author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>book<span class="token punctuation">)</span>

facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token string">&quot;Author&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>query orm<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> orm<span class="token punctuation">.</span>Query <span class="token punctuation">{</span>
  <span class="token keyword">return</span> query<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>book<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this example, Orm will only eager load posts where the post&#39;s <code>name</code> column equals the word <code>author</code>.</p><h3 id="lazy-eager-loading" tabindex="-1"><a class="header-anchor" href="#lazy-eager-loading"><span>Lazy Eager Loading</span></a></h3><p>Sometimes you may need to eager load a relationship after the parent model has already been retrieved. For example, this may be useful if you need to dynamically decide whether to load related models:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> books models<span class="token punctuation">.</span>Book
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>books<span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> book <span class="token operator">:=</span> <span class="token keyword">range</span> books <span class="token punctuation">{</span>
  <span class="token keyword">if</span> someCondition <span class="token punctuation">{</span>
    err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>book<span class="token punctuation">,</span> <span class="token string">&quot;Author&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you need to set additional query constraints on the eager loading query, you can use the code below:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;github.com/goravel/framework/contracts/database/orm&quot;</span>

<span class="token keyword">var</span> book models<span class="token punctuation">.</span>Book
facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>book<span class="token punctuation">,</span> <span class="token string">&quot;Author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>book<span class="token punctuation">)</span>

facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>book<span class="token punctuation">,</span> <span class="token string">&quot;Author&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>query orm<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> orm<span class="token punctuation">.</span>Query <span class="token punctuation">{</span>
  <span class="token keyword">return</span> query<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>book<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To load a relationship only when it has not already been loaded, use the <code>LoadMissing</code> method:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">LoadMissing</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>book<span class="token punctuation">,</span> <span class="token string">&quot;Author&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,101);function v(h,g){const a=o("router-link"),p=o("CommentService");return c(),l("div",null,[d,n("nav",k,[n("ul",null,[n("li",null,[s(a,{to:"#introduction"},{default:e(()=>[t("Introduction")]),_:1})]),n("li",null,[s(a,{to:"#defining-relationships"},{default:e(()=>[t("Defining Relationships")]),_:1}),n("ul",null,[n("li",null,[s(a,{to:"#one-to-one"},{default:e(()=>[t("One To One")]),_:1})]),n("li",null,[s(a,{to:"#one-to-many"},{default:e(()=>[t("One To Many")]),_:1})]),n("li",null,[s(a,{to:"#one-to-many-inverse-belongs-to"},{default:e(()=>[t("One To Many (Inverse) / Belongs To")]),_:1})])])]),n("li",null,[s(a,{to:"#many-to-many-relationships"},{default:e(()=>[t("Many To Many Relationships")]),_:1}),n("ul",null,[n("li",null,[s(a,{to:"#table-structure"},{default:e(()=>[t("Table Structure")]),_:1})]),n("li",null,[s(a,{to:"#model-structure"},{default:e(()=>[t("Model Structure")]),_:1})]),n("li",null,[s(a,{to:"#defining-the-inverse-of-the-relationship-1"},{default:e(()=>[t("Defining The Inverse Of The Relationship")]),_:1})]),n("li",null,[s(a,{to:"#custom-intermediate-table"},{default:e(()=>[t("Custom intermediate table")]),_:1})])])]),n("li",null,[s(a,{to:"#polymorphic"},{default:e(()=>[t("Polymorphic")]),_:1}),n("ul",null,[n("li",null,[s(a,{to:"#table-structure-1"},{default:e(()=>[t("Table structure")]),_:1})]),n("li",null,[s(a,{to:"#model-structure-1"},{default:e(()=>[t("Model Structure")]),_:1})])])]),n("li",null,[s(a,{to:"#querying-associations"},{default:e(()=>[t("Querying Associations")]),_:1}),n("ul",null,[n("li",null,[s(a,{to:"#create-or-update-associations"},{default:e(()=>[t("Create or Update Associations")]),_:1})]),n("li",null,[s(a,{to:"#find-associations"},{default:e(()=>[t("Find Associations")]),_:1})]),n("li",null,[s(a,{to:"#append-associations"},{default:e(()=>[t("Append Associations")]),_:1})]),n("li",null,[s(a,{to:"#replace-associations"},{default:e(()=>[t("Replace Associations")]),_:1})]),n("li",null,[s(a,{to:"#delete-associations"},{default:e(()=>[t("Delete Associations")]),_:1})]),n("li",null,[s(a,{to:"#clear-associations"},{default:e(()=>[t("Clear Associations")]),_:1})]),n("li",null,[s(a,{to:"#count-associations"},{default:e(()=>[t("Count Associations")]),_:1})]),n("li",null,[s(a,{to:"#batch-data"},{default:e(()=>[t("Batch Data")]),_:1})])])]),n("li",null,[s(a,{to:"#eager-loading"},{default:e(()=>[t("Eager Loading")]),_:1}),n("ul",null,[n("li",null,[s(a,{to:"#eager-loading-multiple-relationships"},{default:e(()=>[t("Eager Loading Multiple Relationships")]),_:1})]),n("li",null,[s(a,{to:"#nested-eager-loading"},{default:e(()=>[t("Nested Eager Loading")]),_:1})]),n("li",null,[s(a,{to:"#constraining-eager-loads"},{default:e(()=>[t("Constraining Eager Loads")]),_:1})]),n("li",null,[s(a,{to:"#lazy-eager-loading"},{default:e(()=>[t("Lazy Eager Loading")]),_:1})])])])])]),m,s(p)])}const f=i(r,[["render",v],["__file","relationships.html.vue"]]),y=JSON.parse(`{"path":"/orm/relationships.html","title":"Relationships","lang":"en-US","frontmatter":{"description":"Relationships Introduction It's common for database tables to be interconnected. For instance, a blog post may have many comments, or an order may be linked to the user who plac...","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://goravel.dev/zh/orm/relationships.html"}],["meta",{"property":"og:url","content":"https://goravel.dev/orm/relationships.html"}],["meta",{"property":"og:site_name","content":"Goravel"}],["meta",{"property":"og:title","content":"/orm/relationships.html"}],["meta",{"property":"og:description","content":"Relationships Introduction It's common for database tables to be interconnected. For instance, a blog post may have many comments, or an order may be linked to the user who plac..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Relationships\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Introduction","slug":"introduction","link":"#introduction","children":[]},{"level":2,"title":"Defining Relationships","slug":"defining-relationships","link":"#defining-relationships","children":[{"level":3,"title":"One To One","slug":"one-to-one","link":"#one-to-one","children":[]},{"level":3,"title":"One To Many","slug":"one-to-many","link":"#one-to-many","children":[]},{"level":3,"title":"One To Many (Inverse) / Belongs To","slug":"one-to-many-inverse-belongs-to","link":"#one-to-many-inverse-belongs-to","children":[]}]},{"level":2,"title":"Many To Many Relationships","slug":"many-to-many-relationships","link":"#many-to-many-relationships","children":[{"level":3,"title":"Table Structure","slug":"table-structure","link":"#table-structure","children":[]},{"level":3,"title":"Model Structure","slug":"model-structure","link":"#model-structure","children":[]},{"level":3,"title":"Defining The Inverse Of The Relationship","slug":"defining-the-inverse-of-the-relationship-1","link":"#defining-the-inverse-of-the-relationship-1","children":[]},{"level":3,"title":"Custom intermediate table","slug":"custom-intermediate-table","link":"#custom-intermediate-table","children":[]}]},{"level":2,"title":"Polymorphic","slug":"polymorphic","link":"#polymorphic","children":[{"level":3,"title":"Table structure","slug":"table-structure-1","link":"#table-structure-1","children":[]},{"level":3,"title":"Model Structure","slug":"model-structure-1","link":"#model-structure-1","children":[]}]},{"level":2,"title":"Querying Associations","slug":"querying-associations","link":"#querying-associations","children":[{"level":3,"title":"Create or Update Associations","slug":"create-or-update-associations","link":"#create-or-update-associations","children":[]},{"level":3,"title":"Find Associations","slug":"find-associations","link":"#find-associations","children":[]},{"level":3,"title":"Append Associations","slug":"append-associations","link":"#append-associations","children":[]},{"level":3,"title":"Replace Associations","slug":"replace-associations","link":"#replace-associations","children":[]},{"level":3,"title":"Delete Associations","slug":"delete-associations","link":"#delete-associations","children":[]},{"level":3,"title":"Clear Associations","slug":"clear-associations","link":"#clear-associations","children":[]},{"level":3,"title":"Count Associations","slug":"count-associations","link":"#count-associations","children":[]},{"level":3,"title":"Batch Data","slug":"batch-data","link":"#batch-data","children":[]}]},{"level":2,"title":"Eager Loading","slug":"eager-loading","link":"#eager-loading","children":[{"level":3,"title":"Eager Loading Multiple Relationships","slug":"eager-loading-multiple-relationships","link":"#eager-loading-multiple-relationships","children":[]},{"level":3,"title":"Nested Eager Loading","slug":"nested-eager-loading","link":"#nested-eager-loading","children":[]},{"level":3,"title":"Constraining Eager Loads","slug":"constraining-eager-loads","link":"#constraining-eager-loads","children":[]},{"level":3,"title":"Lazy Eager Loading","slug":"lazy-eager-loading","link":"#lazy-eager-loading","children":[]}]}],"git":{},"filePathRelative":"orm/relationships.md","autoDesc":true}`);export{f as comp,y as data};
