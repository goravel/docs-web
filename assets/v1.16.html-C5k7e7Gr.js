import{_ as i,c as o,a as l,b as s,e as t,f as p,d as a,r as c,o as u}from"./app-DmrjGHX8.js";const r={};function d(k,n){const e=c("RouteLink");return u(),o("div",null,[n[41]||(n[41]=l(`<h1 id="从-v1-15-升级到-v1-16" tabindex="-1"><a class="header-anchor" href="#从-v1-15-升级到-v1-16"><span>从 v1.15 升级到 v1.16</span></a></h1><h3 id="令人兴奋的新功能-🎉" tabindex="-1"><a class="header-anchor" href="#令人兴奋的新功能-🎉"><span>令人兴奋的新功能 🎉</span></a></h3><ul><li><a href="#%E6%96%B0%E5%A2%9E-facades-db">新增 facades.DB()</a></li><li><a href="#%E6%96%B0%E5%A2%9E-facades-http">新增 facades.Http()</a></li><li><a href="#%E9%87%8D%E6%9E%84-facades-queue">重构 facades.Queue()</a></li><li><a href="#facades-auth-%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A9%B1%E5%8A%A8">facades.Auth() 支持自定义驱动</a></li><li><a href="#make-%E5%91%BD%E4%BB%A4%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E4%BB%B6%E6%94%AF%E6%8C%81%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C">make:* 命令生成的文件支持自动注册</a></li><li><a href="#goravel-installer-%E6%94%AF%E6%8C%81%E9%80%89%E6%8B%A9%E9%A9%B1%E5%8A%A8">Goravel Installer 支持选择驱动</a></li></ul><h3 id="功能增强-🚀" tabindex="-1"><a class="header-anchor" href="#功能增强-🚀"><span>功能增强 🚀</span></a></h3><ul><li><a href="#%E6%8B%86%E5%88%86%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A9%B1%E5%8A%A8">拆分数据库驱动</a></li><li><a href="#orm-%E6%96%B0%E5%A2%9E%E7%89%B9%E6%80%A7">Orm 新增特性</a></li><li><a href="#%E6%94%AF%E6%8C%81%E6%A0%B9%E6%8D%AE%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%88%9B%E5%BB%BA-model">支持根据数据表创建 Model</a></li><li><a href="#%E6%94%AF%E6%8C%81%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96-sql-%E8%AF%AD%E5%8F%A5">支持运行时动态获取 SQL 语句</a></li><li><a href="#migration-%E6%96%B0%E5%A2%9E%E7%89%B9%E6%80%A7">Migration 新增特性</a></li><li><a href="#grpc-%E6%96%B0%E5%A2%9E-shutdown-%E6%96%B9%E6%B3%95">Grpc 新增 Shutdown 方法</a></li><li><a href="#artisan-%E6%96%B0%E5%A2%9E%E7%A6%81%E7%94%A8%E6%89%93%E5%8D%B0%E9%A2%9C%E8%89%B2%E9%80%89%E9%A1%B9">Artisan 新增禁用打印颜色选项</a></li><li><a href="#%E5%8A%A0%E8%A7%A3%E5%AF%86-env-%E6%96%87%E4%BB%B6">加解密 env 文件</a></li><li><a href="#%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E6%94%AF%E6%8C%81%E8%AE%BE%E7%BD%AE-header">发送邮件支持设置 Header</a></li><li><a href="#installer-%E6%94%AF%E6%8C%81%E8%87%AA%E5%8D%87%E7%BA%A7">Installer 支持自升级</a></li><li><a href="#%E5%A4%9A%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6%E6%94%AF%E6%8C%81-embed-%E5%8A%A0%E8%BD%BD">多语言文件支持 embed 加载</a></li><li><a href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%94%AF%E6%8C%81%E8%AE%BE%E7%BD%AE%E7%A7%92%E7%BA%A7%E4%BB%BB%E5%8A%A1">定时任务支持设置秒级任务</a></li><li><a href="#request-%E6%96%B0%E5%A2%9E%E7%89%B9%E6%80%A7">Request 新增特性</a></li><li><a href="#route-%E6%96%B0%E5%A2%9E%E7%89%B9%E6%80%A7">Route 新增特性</a></li><li><a href="#testing-%E6%94%AF%E6%8C%81%E5%88%9B%E5%BB%BA-cache-%E9%95%9C%E5%83%8F">Testing 支持创建 Cache 镜像</a></li><li><a href="#%E4%B8%8D%E5%90%8C-jwt-guard-%E6%94%AF%E6%8C%81%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%90%8C%E7%9A%84-ttl-%E4%B8%8E-secert">不同 JWT Guard 支持设置不同的 secert 与 ttl</a></li><li><a href="#%E6%B3%A8%E5%86%8C-serviceprovider-%E4%B8%8D%E5%86%8D%E4%BE%9D%E8%B5%96%E9%A1%BA%E5%BA%8F">注册 ServiceProvider 不再依赖顺序</a></li></ul><h3 id="破坏性变化-🛠" tabindex="-1"><a class="header-anchor" href="#破坏性变化-🛠"><span>破坏性变化 🛠</span></a></h3><ul><li><a href="#%E7%A7%BB%E9%99%A4-sql-%E8%BF%81%E7%A7%BB">移除 SQL 迁移</a></li><li><a href="#%E4%BC%98%E5%8C%96-config-%E6%A8%A1%E5%9D%97%E6%96%B9%E6%B3%95%E9%BB%98%E8%AE%A4%E5%80%BC%E7%B1%BB%E5%9E%8B">优化 Config 模块方法默认值类型</a></li><li><a href="#%E4%BC%98%E5%8C%96-orm-%E6%96%B9%E6%B3%95">优化 Orm 方法</a></li><li><a href="#%E4%BC%98%E5%8C%96-path-%E6%96%B9%E6%B3%95">优化 Path 方法</a></li><li><a href="#%E4%BC%98%E5%8C%96-request-%E6%96%B9%E6%B3%95">优化 Request 方法</a></li><li><a href="#%E4%BC%98%E5%8C%96-console-confirm-%E6%96%B9%E6%B3%95">优化 console Confirm 方法</a></li><li><a href="#%E4%BC%98%E5%8C%96-session-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A9%B1%E5%8A%A8%E6%96%B9%E5%BC%8F">优化 Session 自定义驱动方式</a></li><li><a href="#%E4%BC%98%E5%8C%96-testing-request-%E6%96%B9%E6%B3%95">优化 Testing.Request 方法</a></li><li><a href="#%E4%BC%98%E5%8C%96-carbon-%E6%96%B9%E6%B3%95">优化 Carbon 方法</a></li></ul><h2 id="升级指南" tabindex="-1"><a class="header-anchor" href="#升级指南"><span>升级指南</span></a></h2><p>随着 <a href="https://endoflife.date/go" target="_blank" rel="noopener noreferrer">Golang v1.22 不再被维护</a>，Goravel v1.16 默认支持 Golang 版本由 1.22 升级为 1.23。</p><p>goravel/example 项目由 v1.15 升级到 v1.16 PR 可以作为升级参考：<a href="https://github.com/goravel/example/pull/68" target="_blank" rel="noopener noreferrer">goravel/example#68</a></p><h3 id="_1-更新依赖" tabindex="-1"><a class="header-anchor" href="#_1-更新依赖"><span>1. 更新依赖</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">go get github.com/goravel/framework@master</span>
<span class="line"></span>
<span class="line">// 如果使用 gin</span>
<span class="line">go get github.com/goravel/gin@master</span>
<span class="line"></span>
<span class="line">// 如果使用 fiber</span>
<span class="line">go get github.com/goravel/fiber@master</span>
<span class="line"></span>
<span class="line">// 如果使用 redis</span>
<span class="line">go get github.com/goravel/redis@master</span>
<span class="line"></span>
<span class="line">// 如果使用 S3</span>
<span class="line">go get github.com/goravel/s3@master</span>
<span class="line"></span>
<span class="line">// 如果使用 Oss</span>
<span class="line">go get github.com/goravel/oss@master</span>
<span class="line"></span>
<span class="line">// 如果使用 Cos</span>
<span class="line">go get github.com/goravel/cos@master</span>
<span class="line"></span>
<span class="line">// 如果使用 Minio</span>
<span class="line">go get github.com/goravel/minio@master</span>
<span class="line"></span>
<span class="line">// 如果使用 Cloudinary</span>
<span class="line">go get github.com/goravel/cloudinary@master</span>
<span class="line"></span>
<span class="line">go mod tidy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-修改数据库配置" tabindex="-1"><a class="header-anchor" href="#_2-修改数据库配置"><span>2. 修改数据库配置</span></a></h3><p>删除数据库配置文件 <code>config/database.go</code> 中自己用不到的 <code>connections</code>，安装自己需要的数据库驱动。</p><p>以 Postgres 为例：</p><ol><li>安装驱动包</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">go get github.com/goravel/postgres</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>添加 <code>postgres.ServiceProvider</code> 到 <code>config/app.go</code> 文件</li></ol><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/app.go</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;github.com/goravel/postgres&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token string">&quot;providers&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>foundation<span class="token punctuation">.</span>ServiceProvider<span class="token punctuation">{</span></span>
<span class="line">  <span class="token operator">...</span></span>
<span class="line">  <span class="token operator">&amp;</span>postgres<span class="token punctuation">.</span>ServiceProvider<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>修改 <code>config/database.go</code> 文件中的配置</li></ol><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/database.go</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;github.com/goravel/framework/contracts/database/driver&quot;</span></span>
<span class="line">	postgresfacades <span class="token string">&quot;github.com/goravel/postgres/facades&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token string">&quot;connections&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">...</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;via&quot;</span><span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>driver<span class="token punctuation">.</span>Driver<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>      <span class="token keyword">return</span> postgresfacades<span class="token punctuation">.</span><span class="token function">Postgres</span><span class="token punctuation">(</span><span class="token string">&quot;postgres&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-修改-auth-go-配置文件" tabindex="-1"><a class="header-anchor" href="#_3-修改-auth-go-配置文件"><span>3. 修改 auth.go 配置文件</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/auth.go</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Supported: &quot;jwt&quot;</span></span>
<span class="line"><span class="token string">&quot;guards&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>   <span class="token string">&quot;jwt&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;provider&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">++</span> <span class="token comment">// Supported: &quot;orm&quot;</span></span>
<span class="line"><span class="token operator">++</span> <span class="token string">&quot;providers&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>   <span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>     <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;orm&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-修改-session-go-配置文件" tabindex="-1"><a class="header-anchor" href="#_4-修改-session-go-配置文件"><span>4. 修改 session.go 配置文件</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/session.go</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span> config<span class="token punctuation">.</span><span class="token function">Env</span><span class="token punctuation">(</span><span class="token string">&quot;SESSION_DRIVER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">:</span> config<span class="token punctuation">.</span><span class="token function">Env</span><span class="token punctuation">(</span><span class="token string">&quot;SESSION_DRIVER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span> <span class="token string">&quot;drivers&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>   <span class="token string">&quot;file&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>     <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-修改-queue-go-配置文件" tabindex="-1"><a class="header-anchor" href="#_5-修改-queue-go-配置文件"><span>5. 修改 queue.go 配置文件</span></a></h3><ul><li><p>如果正在使用 Queue 模块的 Redis 驱动，需相应修改：<a href="#%E4%BC%98%E5%8C%96-queue-%E9%85%8D%E7%BD%AE">优化 Queue 配置</a>。</p></li><li><p>如果没有使用或想要以后使用 database 驱动，需要修改 <code>config/queue.go</code> 文件中的配置：</p></li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/queue.go</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> <span class="token comment">// Drivers: &quot;sync&quot;, &quot;redis&quot;</span></span>
<span class="line"><span class="token operator">++</span> <span class="token comment">// Drivers: &quot;sync&quot;, &quot;database&quot;, &quot;custom&quot;</span></span>
<span class="line"><span class="token string">&quot;connections&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;sync&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;sync&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">--</span>  <span class="token string">&quot;redis&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">--</span>    <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>     <span class="token string">&quot;redis&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">--</span>    <span class="token string">&quot;connection&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">--</span>    <span class="token string">&quot;queue&quot;</span><span class="token punctuation">:</span>      config<span class="token punctuation">.</span><span class="token function">Env</span><span class="token punctuation">(</span><span class="token string">&quot;REDIS_QUEUE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">--</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>  <span class="token string">&quot;database&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>     <span class="token string">&quot;database&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;connection&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;queue&quot;</span><span class="token punctuation">:</span>      <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;concurrent&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">++</span> <span class="token string">&quot;failed&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>  <span class="token string">&quot;database&quot;</span><span class="token punctuation">:</span> config<span class="token punctuation">.</span><span class="token function">Env</span><span class="token punctuation">(</span><span class="token string">&quot;DB_CONNECTION&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>  <span class="token string">&quot;table&quot;</span><span class="token punctuation">:</span>    <span class="token string">&quot;failed_jobs&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加 database 驱动需要的迁移文件： <a href="https://github.com/goravel/goravel/blob/master/database/migrations/20210101000002_create_jobs_table.go" target="_blank" rel="noopener noreferrer">database/migrations/20210101000002_create_jobs_table.go</a>，并在 <code>database/kernel.go</code> 文件中注册该迁移文件。</p><h3 id="_6-如果需要使用-http-client" tabindex="-1"><a class="header-anchor" href="#_6-如果需要使用-http-client"><span>6. 如果需要使用 HTTP Client</span></a></h3><p><code>config/http.go</code> 文件中新增 HTTP Client 配置项:</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/http.go</span></span>
<span class="line"><span class="token operator">++</span> <span class="token string">&quot;client&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>   <span class="token string">&quot;base_url&quot;</span><span class="token punctuation">:</span>                config<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP_CLIENT_BASE_URL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>   <span class="token string">&quot;timeout&quot;</span><span class="token punctuation">:</span>                 config<span class="token punctuation">.</span><span class="token function">GetDuration</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP_CLIENT_TIMEOUT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>   <span class="token string">&quot;max_idle_conns&quot;</span><span class="token punctuation">:</span>          config<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP_CLIENT_MAX_IDLE_CONNS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>   <span class="token string">&quot;max_idle_conns_per_host&quot;</span><span class="token punctuation">:</span> config<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP_CLIENT_MAX_IDLE_CONNS_PER_HOST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>   <span class="token string">&quot;max_conns_per_host&quot;</span><span class="token punctuation">:</span>      config<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP_CLIENT_MAX_CONN_PER_HOST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>   <span class="token string">&quot;idle_conn_timeout&quot;</span><span class="token punctuation">:</span>       config<span class="token punctuation">.</span><span class="token function">GetDuration</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP_CLIENT_IDLE_CONN_TIMEOUT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-如果正在使用-goravel-redis-驱动" tabindex="-1"><a class="header-anchor" href="#_7-如果正在使用-goravel-redis-驱动"><span>7. 如果正在使用 goravel/redis 驱动</span></a></h3><p>需修改 <code>config/cache.go</code> 文件中的配置：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/cache.go</span></span>
<span class="line"><span class="token string">&quot;redis&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>     <span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;connection&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;via&quot;</span><span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>cache<span class="token punctuation">.</span>Driver<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">--</span>  <span class="token keyword">return</span> redisfacades<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span><span class="token string">&quot;redis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token operator">++</span>  <span class="token keyword">return</span> redisfacades<span class="token punctuation">.</span><span class="token function">Cache</span><span class="token punctuation">(</span><span class="token string">&quot;redis&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-如果正在使用-carbon-datetime-等方法" tabindex="-1"><a class="header-anchor" href="#_8-如果正在使用-carbon-datetime-等方法"><span>8. 如果正在使用 carbon.DateTime 等方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-carbon-%E6%96%B9%E6%B3%95">优化 Carbon 方法</a></p><h3 id="_9-如果正在使用-session-自定义驱动" tabindex="-1"><a class="header-anchor" href="#_9-如果正在使用-session-自定义驱动"><span>9. 如果正在使用 session 自定义驱动</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-session-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A9%B1%E5%8A%A8%E6%96%B9%E5%BC%8F">优化 Session 自定义驱动方式</a></p><h3 id="_10-如果正在使用-facades-config-中的方法" tabindex="-1"><a class="header-anchor" href="#_10-如果正在使用-facades-config-中的方法"><span>10. 如果正在使用 facades.Config() 中的方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-config-%E6%A8%A1%E5%9D%97%E6%96%B9%E6%B3%95%E9%BB%98%E8%AE%A4%E5%80%BC%E7%B1%BB%E5%9E%8B">优化 Config 模块方法默认值类型</a></p><h3 id="_11-如果正在使用-sql-数据迁移" tabindex="-1"><a class="header-anchor" href="#_11-如果正在使用-sql-数据迁移"><span>11. 如果正在使用 SQL 数据迁移</span></a></h3><p>需相应修改：<a href="#%E7%A7%BB%E9%99%A4-sql-%E8%BF%81%E7%A7%BB">移除 SQL 迁移</a></p><h3 id="_12-如果正在使用-orm" tabindex="-1"><a class="header-anchor" href="#_12-如果正在使用-orm"><span>12. 如果正在使用 Orm</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-orm-%E6%96%B9%E6%B3%95">优化 Orm 方法</a></p><h3 id="_13-如果正在使用-path-方法" tabindex="-1"><a class="header-anchor" href="#_13-如果正在使用-path-方法"><span>13. 如果正在使用 Path 方法</span></a></h3><p>Path 方法由原来返回相对路径改为返回绝对路径，如果正在使用需检查是否需要修改：<a href="#%E4%BC%98%E5%8C%96-path-%E6%96%B9%E6%B3%95">优化 Path 方法</a></p><h3 id="_14-如果-正在使用-ctx-request-inputmap-方法" tabindex="-1"><a class="header-anchor" href="#_14-如果-正在使用-ctx-request-inputmap-方法"><span>14. 如果 正在使用 <code>ctx.Request().InputMap</code> 方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-request-%E6%96%B9%E6%B3%95">优化 Request 方法</a></p><h3 id="_15-如果正在使用-console-confirm-方法" tabindex="-1"><a class="header-anchor" href="#_15-如果正在使用-console-confirm-方法"><span>15. 如果正在使用 <code>console.Confirm</code> 方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-console-confirm-%E6%96%B9%E6%B3%95">优化 console Confirm 方法</a></p><h3 id="_16-如果正在使用-testing-request-方法" tabindex="-1"><a class="header-anchor" href="#_16-如果正在使用-testing-request-方法"><span>16. 如果正在使用 Testing.Request 方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-testing-request-%E6%96%B9%E6%B3%95">优化 Testing.Request 方法</a></p><h2 id="功能介绍" tabindex="-1"><a class="header-anchor" href="#功能介绍"><span>功能介绍</span></a></h2><h3 id="新增-facades-db" tabindex="-1"><a class="header-anchor" href="#新增-facades-db"><span>新增 facades.DB()</span></a></h3><p>新增 <code>facades.DB()</code> 模块，方便进行数据库的原生操作，比 ORM 速度更快。</p>`,56)),s("p",null,[t(e,{to:"/zh/database/getting-started.html"},{default:p(()=>n[0]||(n[0]=[a("查看文档")])),_:1})]),n[42]||(n[42]=s("h3",{id:"新增-facades-http",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#新增-facades-http"},[s("span",null,"新增 facades.Http()")])],-1)),n[43]||(n[43]=s("p",null,[a("新增一个内置的 HTTP 客户端 "),s("code",null,"facades.Http()"),a("，让 API 调用变得轻而易举。")],-1)),s("p",null,[t(e,{to:"/zh/digging-deeper/http-client.html"},{default:p(()=>n[1]||(n[1]=[a("查看文档")])),_:1})]),n[44]||(n[44]=l('<h3 id="重构-facades-queue" tabindex="-1"><a class="header-anchor" href="#重构-facades-queue"><span>重构 facades.Queue()</span></a></h3><ol><li>v1.15 之前 Queue 仅支持同步驱动与 Redis 驱动，从 v1.16 开始支持数据库驱动及自定义驱动。</li><li>新增 <code>jobs</code> 和 <code>failed_jobs</code> 表，用于存储任务及失败任务。</li><li>新增 <code>queue:retry</code> 命令，用于重试失败的任务。</li><li>新增 <code>queue:failed</code> 命令，用于查看失败任务。</li><li>支持在启动队列任务时设置重试次数。</li></ol>',2)),s("p",null,[n[3]||(n[3]=a("详情请 ")),t(e,{to:"/zh/digging-deeper/queues.html"},{default:p(()=>n[2]||(n[2]=[a("查看文档")])),_:1})]),n[45]||(n[45]=s("h3",{id:"facades-auth-支持自定义驱动",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#facades-auth-支持自定义驱动"},[s("span",null,"facades.Auth() 支持自定义驱动")])],-1)),s("p",null,[n[5]||(n[5]=a("v1.15 之前 Auth 仅支持 JWT 驱动，从 v1.16 开始支持 Session 及自定义驱动，详情请 ")),t(e,{to:"/zh/security/authentication.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A9%B1%E5%8A%A8"},{default:p(()=>n[4]||(n[4]=[a("查看文档")])),_:1}),n[6]||(n[6]=a("。"))]),n[46]||(n[46]=l('<h3 id="make-命令生成的文件支持自动注册" tabindex="-1"><a class="header-anchor" href="#make-命令生成的文件支持自动注册"><span>make:* 命令生成的文件支持自动注册</span></a></h3><p><code>make:migration</code>、 <code>make:seeder</code> 等命令生成的文件，在生成后会自动注册到框架中，无需像之前一样需要手动注册。</p><h3 id="goravel-installer-支持选择驱动" tabindex="-1"><a class="header-anchor" href="#goravel-installer-支持选择驱动"><span>Goravel Installer 支持选择驱动</span></a></h3><p>使用 Goravel Installer 安装新项目的过程中可以选择安装不同的驱动，例如：可以选择安装 goravel/gin 或 goravel/fiber 等。</p><h3 id="拆分数据库驱动" tabindex="-1"><a class="header-anchor" href="#拆分数据库驱动"><span>拆分数据库驱动</span></a></h3><p>之前多个数据库驱动同时集成在框架中，使得软件打包体积变大，从 v1.16 开始，数据库驱动将作为独立包存在，只需安装自己需要的数据库驱动即可。</p><table><thead><tr><th>数据库类型</th><th>驱动包</th></tr></thead><tbody><tr><td>Postgres</td><td><a href="https://github.com/goravel/postgres" target="_blank" rel="noopener noreferrer">github.com/goravel/postgres</a></td></tr><tr><td>MySQL</td><td><a href="https://github.com/goravel/mysql" target="_blank" rel="noopener noreferrer">github.com/goravel/mysql</a></td></tr><tr><td>Sqlserver</td><td><a href="https://github.com/goravel/sqlserver" target="_blank" rel="noopener noreferrer">github.com/goravel/sqlserver</a></td></tr><tr><td>SQLite</td><td><a href="https://github.com/goravel/sqlite" target="_blank" rel="noopener noreferrer">github.com/goravel/sqlite</a></td></tr></tbody></table><h3 id="orm-新增特性" tabindex="-1"><a class="header-anchor" href="#orm-新增特性"><span>Orm 新增特性</span></a></h3>',8)),s("ul",null,[s("li",null,[s("p",null,[n[8]||(n[8]=a("支持查找 JSON 字段，")),t(e,{to:"/zh/orm/getting-started.html#where-%E6%9D%A1%E4%BB%B6"},{default:p(()=>n[7]||(n[7]=[a("查看文档")])),_:1}),n[9]||(n[9]=a("。"))])]),s("li",null,[s("p",null,[n[11]||(n[11]=a("支持更新 JSON 字段，")),t(e,{to:"/zh/orm/getting-started.html#%E6%9B%B4%E6%96%B0-json-%E5%AD%97%E6%AE%B5"},{default:p(()=>n[10]||(n[10]=[a("查看文档")])),_:1}),n[12]||(n[12]=a("。"))])]),n[13]||(n[13]=s("li",null,[s("p",null,[a("Model 中支持设置 "),s("code",null,"GlobalScope"),a(" 方法，在查找、更新和删除操作时限制作用域：")])],-1))]),n[47]||(n[47]=l(`<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">  contractsorm<span class="token string">&quot;github.com/goravel/framework/contracts/database/orm&quot;</span></span>
<span class="line">  <span class="token string">&quot;github.com/goravel/framework/database/orm&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  orm<span class="token punctuation">.</span>Model</span>
<span class="line">  Name <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">GlobalScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span>contractsorm<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> contractsorm<span class="token punctuation">.</span>Query <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span>contractsorm<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> contractsorm<span class="token punctuation">.</span>Query<span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">func</span><span class="token punctuation">(</span>query contractsorm<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> contractsorm<span class="token punctuation">.</span>Query <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> query<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;goravel&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="支持根据数据表创建-model" tabindex="-1"><a class="header-anchor" href="#支持根据数据表创建-model"><span>支持根据数据表创建 Model</span></a></h3><p><code>make:model</code> 命令新增 <code>--table</code> 选项，用于根据数据表创建 Model：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">./artisan make:model <span class="token parameter variable">--table</span><span class="token operator">=</span>users User</span>
<span class="line"></span>
<span class="line">// 如果 Model 已存在可以使用 <span class="token parameter variable">-f</span> 选项强制覆盖</span>
<span class="line">./artisan make:model <span class="token parameter variable">--table</span><span class="token operator">=</span>users <span class="token parameter variable">-f</span> User</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="支持运行时动态获取-sql-语句" tabindex="-1"><a class="header-anchor" href="#支持运行时动态获取-sql-语句"><span>支持运行时动态获取 SQL 语句</span></a></h3><p>新增 <code>EnableQueryLog</code> 等方法，用于在运行时动态获取 SQL 语句：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">ctx <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">EnableQueryLog</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">queryLogs <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">GetQueryLog</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span>
<span class="line">ctx <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">DisableQueryLog</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="migration-新增特性" tabindex="-1"><a class="header-anchor" href="#migration-新增特性"><span>Migration 新增特性</span></a></h3><ul><li>新增 <code>Change</code> 方法（适用于 Postgres, MySQL, Sqlserver），用于修改表结构：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">table<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Change</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>新增 <code>RenameColumn</code> 方法，用于重命名表列：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">table<span class="token punctuation">.</span><span class="token function">RenameColumn</span><span class="token punctuation">(</span><span class="token string">&quot;old_name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;new_name&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>新增 <code>Comment</code> 方法，用于为表添加注释（适用于 Postgres, MySQL）：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">table<span class="token punctuation">.</span><span class="token function">Comment</span><span class="token punctuation">(</span><span class="token string">&quot;user table&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>新增 <code>First</code> 方法，用于将字段设置为表的第一个字段（适用于 MySQL）：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">table<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>新增 <code>After</code> 方法，用于将字段设置为表的最后一个字段（适用于 MySQL）：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">table<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>新增 <code>Morphs</code>, <code>NullableMorphs</code>, <code>NumericMorphs</code>, <code>UuidMorphs</code>, <code>UlidMorphs</code> 方法，用于创建多态关联字段：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">table<span class="token punctuation">.</span><span class="token function">Morphs</span><span class="token punctuation">(</span><span class="token string">&quot;morphable&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// morphable_type, morphable_id</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>新增 <code>Uuid</code>, <code>Ulid</code> 方法，用于创建 UUID 和 ULID 字段：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">table<span class="token punctuation">.</span><span class="token function">Uuid</span><span class="token punctuation">(</span><span class="token string">&quot;uuid&quot;</span><span class="token punctuation">)</span></span>
<span class="line">table<span class="token punctuation">.</span><span class="token function">Ulid</span><span class="token punctuation">(</span><span class="token string">&quot;ulid&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="grpc-新增-shutdown-方法" tabindex="-1"><a class="header-anchor" href="#grpc-新增-shutdown-方法"><span>Grpc 新增 Shutdown 方法</span></a></h3>`,23)),s("p",null,[n[15]||(n[15]=a("新增 ")),n[16]||(n[16]=s("code",null,"Shutdown",-1)),n[17]||(n[17]=a(" 方法以便优雅的关闭 Grpc，")),t(e,{to:"/zh/the-basics/grpc.html#%E5%85%B3%E9%97%ADgrpc"},{default:p(()=>n[14]||(n[14]=[a("查看文档")])),_:1}),n[18]||(n[18]=a("。"))]),n[48]||(n[48]=l(`<h3 id="artisan-新增禁用打印颜色选项" tabindex="-1"><a class="header-anchor" href="#artisan-新增禁用打印颜色选项"><span>Artisan 新增禁用打印颜色选项</span></a></h3><p>有些命令默认会打印颜色，例如 <code>list</code> 命令，但在某些终端或日志中颜色值会是乱码，这时你可以使用 <code>--no-ansi</code> 选项禁用打印颜色：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">go run <span class="token builtin class-name">.</span> artisan list --no-ansi</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="加解密-env-文件" tabindex="-1"><a class="header-anchor" href="#加解密-env-文件"><span>加解密 env 文件</span></a></h3><p>你也许想将生产环境的 env 文件添加到版本控制中，但又不想将敏感信息暴露出来，这时你可以加解密 env 文件。</p>`,5)),s("p",null,[t(e,{to:"/zh/getting-started/installation.html#%E5%8A%A0%E8%A7%A3%E5%AF%86-env-%E6%96%87%E4%BB%B6"},{default:p(()=>n[19]||(n[19]=[a("查看文档")])),_:1})]),n[49]||(n[49]=l(`<h3 id="发送邮件支持设置-header" tabindex="-1"><a class="header-anchor" href="#发送邮件支持设置-header"><span>发送邮件支持设置 Header</span></a></h3><p>新增 <code>Headers</code> 方法，用于设置邮件的 Header。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">facades<span class="token punctuation">.</span><span class="token function">Mail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Headers</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;X-Mailer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Goravel&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="installer-支持自升级" tabindex="-1"><a class="header-anchor" href="#installer-支持自升级"><span>Installer 支持自升级</span></a></h3><p>goravel/installer 新增 <code>upgrade</code> 命令，用于 installer 的自身升级：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">goravel upgrade</span>
<span class="line">goravel upgrade v1.1.1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="多语言文件支持-embed-加载" tabindex="-1"><a class="header-anchor" href="#多语言文件支持-embed-加载"><span>多语言文件支持 embed 加载</span></a></h3><p>使用 embed 加载时，多语言文件将会被编译到二进制文件中，部署时不再需要多语言文件。</p>`,8)),s("p",null,[t(e,{to:"/zh/digging-deeper/localization.html#embed-%E5%8A%A0%E8%BD%BD"},{default:p(()=>n[20]||(n[20]=[a("查看文档")])),_:1})]),n[50]||(n[50]=s("h3",{id:"定时任务支持设置秒级任务",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#定时任务支持设置秒级任务"},[s("span",null,"定时任务支持设置秒级任务")])],-1)),s("p",null,[n[22]||(n[22]=a("新增 ")),n[23]||(n[23]=s("code",null,"EverySecond",-1)),n[24]||(n[24]=a(" 等方法，详细请 ")),t(e,{to:"/zh/digging-deeper/task-scheduling.html#%E8%B0%83%E5%BA%A6%E9%A2%91%E7%8E%87%E9%80%89%E9%A1%B9"},{default:p(()=>n[21]||(n[21]=[a("查看文档")])),_:1}),n[25]||(n[25]=a("。"))]),n[51]||(n[51]=l(`<h3 id="request-新增特性" tabindex="-1"><a class="header-anchor" href="#request-新增特性"><span>Request 新增特性</span></a></h3><ul><li>v1.15 之前下面 <code>Request</code> 绑定将报错，从 v1.16 开始支持绑定多个文件：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> StoreMediaRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Files <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>multipart<span class="token punctuation">.</span>FileHeader <span class="token string">\`form:&quot;files&quot; json:&quot;files&quot;\`</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>新增 <code>OriginalPath</code> 方法，用于获取原始路由路径：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">ctx<span class="token punctuation">.</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OriginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>当设置 <code>http.request_timeout</code> 配置项 为 <code>0</code> 时，请求将不会超时。</li></ul><h3 id="route-新增特性" tabindex="-1"><a class="header-anchor" href="#route-新增特性"><span>Route 新增特性</span></a></h3><ul><li>新增 <code>GetRoutes</code> 方法，用于获取所有路由：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">routes <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>新增 <code>Name</code> 方法，用于设置路由名称：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">facades<span class="token punctuation">.</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span> usersController<span class="token punctuation">.</span>Index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token string">&quot;users.index&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后可以使用 <code>Info</code> 方法获取路由信息：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">route <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;users.index&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>新增 <code>route:list</code> 命令，用于查看所有路由：</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">./artisan route:list</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="testing-支持创建-cache-镜像" tabindex="-1"><a class="header-anchor" href="#testing-支持创建-cache-镜像"><span>Testing 支持创建 Cache 镜像</span></a></h3><p>新增 <code>Cache</code> 方法，用于创建 Cache 镜像：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">cache<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,18)),s("p",null,[n[27]||(n[27]=a("详细请 ")),t(e,{to:"/zh/testing/getting-started.html#%E4%BD%BF%E7%94%A8-docker"},{default:p(()=>n[26]||(n[26]=[a("查看文档")])),_:1}),n[28]||(n[28]=a("。"))]),n[52]||(n[52]=s("h3",{id:"不同-jwt-guard-支持设置不同的-ttl-与-secert",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#不同-jwt-guard-支持设置不同的-ttl-与-secert"},[s("span",null,"不同 JWT Guard 支持设置不同的 ttl 与 secert")])],-1)),s("p",null,[n[30]||(n[30]=a("之前 JWT Guard 的 ")),n[31]||(n[31]=s("code",null,"ttl",-1)),n[32]||(n[32]=a(" 与 ")),n[33]||(n[33]=s("code",null,"secret",-1)),n[34]||(n[34]=a(" 配置项是全局配置，从 v1.16 开始，你可以为不同的 JWT Guard 设置不同的 ")),n[35]||(n[35]=s("code",null,"ttl",-1)),n[36]||(n[36]=a(" 与 ")),n[37]||(n[37]=s("code",null,"secret",-1)),n[38]||(n[38]=a("，")),t(e,{to:"/zh/security/authentication.html#%E4%B8%8D%E5%90%8C-jwt-guard-%E6%94%AF%E6%8C%81%E4%B8%8D%E5%90%8C%E9%85%8D%E7%BD%AE"},{default:p(()=>n[29]||(n[29]=[a("查看文档")])),_:1}),n[39]||(n[39]=a("。"))]),n[53]||(n[53]=l(`<h3 id="注册-serviceprovider-不再依赖顺序" tabindex="-1"><a class="header-anchor" href="#注册-serviceprovider-不再依赖顺序"><span>注册 ServiceProvider 不再依赖顺序</span></a></h3><p>ServiceProvider 新增可选方法 <code>Relationship() binding.Relationship</code>，用来声明当前 ServicerProvider 的依赖关系，设置了该方法的 ServiceProvider 将不依赖注册顺序，未设置的 ServiceProvider 将被最后注册，例如：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> ServiceProvider <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>ServiceProvider<span class="token punctuation">)</span> <span class="token function">Relationship</span><span class="token punctuation">(</span><span class="token punctuation">)</span> binding<span class="token punctuation">.</span>Relationship <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> binding<span class="token punctuation">.</span>Relationship<span class="token punctuation">{</span></span>
<span class="line">		Bindings<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span></span>
<span class="line">			BindingSession<span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		Dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span></span>
<span class="line">			binding<span class="token punctuation">.</span>Config<span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		ProvideFor<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span></span>
<span class="line">			binding<span class="token punctuation">.</span>Cache<span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>ServiceProvider<span class="token punctuation">)</span> <span class="token function">Register</span><span class="token punctuation">(</span>app foundation<span class="token punctuation">.</span>Application<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>ServiceProvider<span class="token punctuation">)</span> <span class="token function">Boot</span><span class="token punctuation">(</span>app foundation<span class="token punctuation">.</span>Application<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="移除-sql-迁移" tabindex="-1"><a class="header-anchor" href="#移除-sql-迁移"><span>移除 SQL 迁移</span></a></h3><p>SQL 迁移被完全移除，请使用 Go 语言迁移。迁移步骤：</p><ol><li>移除 <code>config/database.go</code> 中的 <code>migrations.driver</code> 键；</li></ol><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/database.go</span></span>
<span class="line"><span class="token string">&quot;migrations&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">--</span>   <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;sql&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;table&quot;</span><span class="token punctuation">:</span>  <span class="token string">&quot;migrations&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将 <code>database/migrations</code> 目录下的 SQL 迁移文件转换为 Go 语言迁移文件：</li></ol><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// Up Run the migrations.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>M20241207095921CreateUsersTable<span class="token punctuation">)</span> <span class="token function">Up</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> facades<span class="token punctuation">.</span><span class="token function">Schema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sql</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Original SQL<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Down Reverse the migrations.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>M20241207095921CreateUsersTable<span class="token punctuation">)</span> <span class="token function">Down</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> facades<span class="token punctuation">.</span><span class="token function">Schema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sql</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Original SQL<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>在 <code>database/kernel.go</code> 文件中注册迁移文件；</li></ol><h3 id="优化-config-模块方法默认值类型" tabindex="-1"><a class="header-anchor" href="#优化-config-模块方法默认值类型"><span>优化 Config 模块方法默认值类型</span></a></h3><p>之前 <code>GetString</code>、<code>GetInt</code>、<code>GetBool</code> 方法的默认值类型为 <code>any</code>，从 v1.16 开始，默认值类型为 <code>string</code>、<code>int</code>、<code>bool</code>，以保证类型安全。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token function">GetString</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> defaultValue <span class="token operator">...</span>any<span class="token punctuation">)</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token operator">++</span> <span class="token function">GetString</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> defaultValue <span class="token operator">...</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> <span class="token function">GetInt</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> defaultValue <span class="token operator">...</span>any<span class="token punctuation">)</span> <span class="token builtin">int</span></span>
<span class="line"><span class="token operator">++</span> <span class="token function">GetInt</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> defaultValue <span class="token operator">...</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> <span class="token function">GetBool</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> defaultValue <span class="token operator">...</span>any<span class="token punctuation">)</span> <span class="token builtin">bool</span></span>
<span class="line"><span class="token operator">++</span> <span class="token function">GetBool</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> defaultValue <span class="token operator">...</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token builtin">bool</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-orm-方法" tabindex="-1"><a class="header-anchor" href="#优化-orm-方法"><span>优化 Orm 方法</span></a></h3><ul><li>优化 <code>Count</code>, <code>Distinct</code>, <code>Select</code>, <code>Exists</code>, <code>Sum</code> 方法：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token function">Count</span><span class="token punctuation">(</span>count <span class="token operator">*</span><span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token builtin">error</span></span>
<span class="line"><span class="token operator">++</span> <span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> <span class="token function">Distinct</span><span class="token punctuation">(</span>args <span class="token operator">...</span>any<span class="token punctuation">)</span> Query</span>
<span class="line"><span class="token operator">++</span> <span class="token function">Distinct</span><span class="token punctuation">(</span>columns <span class="token operator">...</span><span class="token builtin">string</span><span class="token punctuation">)</span> Query</span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> <span class="token function">Exists</span><span class="token punctuation">(</span>exists <span class="token operator">*</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token builtin">error</span></span>
<span class="line"><span class="token operator">++</span> <span class="token function">Exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> <span class="token function">Select</span><span class="token punctuation">(</span>query any<span class="token punctuation">,</span> args <span class="token operator">...</span>any<span class="token punctuation">)</span> Query</span>
<span class="line"><span class="token operator">++</span> <span class="token function">Select</span><span class="token punctuation">(</span>columns <span class="token operator">...</span><span class="token builtin">string</span><span class="token punctuation">)</span> Query</span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> <span class="token function">Sum</span><span class="token punctuation">(</span>column <span class="token builtin">string</span><span class="token punctuation">,</span> dest any<span class="token punctuation">)</span> <span class="token builtin">error</span></span>
<span class="line"><span class="token operator">++</span> <span class="token function">Sum</span><span class="token punctuation">(</span>column <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Where</code> 方法支持闭包：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>query orm<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> orm<span class="token punctuation">.</span>Query <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> query<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FindOrFail</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// SELECT * FROM users WHERE id = 100 AND (height = 180 AND age = 18);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-path-方法" tabindex="-1"><a class="header-anchor" href="#优化-path-方法"><span>优化 Path 方法</span></a></h3><ul><li>path 方法返回绝对路径</li></ul><p>之前 path 方法返回的是相对于根目录的路径，例如 <code>path.Config(&quot;app.go&quot;) == config/app.go</code>，从 v1.16 开始，path 方法返回的是绝对路径，例如 <code>path.Config(&quot;app.go&quot;) == /Users/goravel/workspace/goravel/config/app.go</code>；</p><ul><li>新增 <code>Resource</code> 方法</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">path<span class="token punctuation">.</span><span class="token function">Resource</span><span class="token punctuation">(</span><span class="token string">&quot;views/welcome.tmpl&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="优化-request-方法" tabindex="-1"><a class="header-anchor" href="#优化-request-方法"><span>优化 Request 方法</span></a></h3><ul><li>修改 <code>InputMap</code> 方法默认值类型：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> ctx<span class="token punctuation">.</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">InputMap</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> defaultValue <span class="token operator">...</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span></span>
<span class="line"><span class="token operator">++</span> ctx<span class="token punctuation">.</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">InputMap</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> defaultValue <span class="token operator">...</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>新增 <code>InputMapArray</code> 方法，用于获取数组类型的 Map：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">ctx<span class="token punctuation">.</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">InputMapArray</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> defaultValue <span class="token operator">...</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>新增 <code>Files</code> 方法，用于获取多个文件：</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">ctx<span class="token punctuation">.</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Files</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>filesystem<span class="token punctuation">.</span>File<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="优化-console-confirm-方法" tabindex="-1"><a class="header-anchor" href="#优化-console-confirm-方法"><span>优化 console Confirm 方法</span></a></h3><p>修改 <code>Confirm</code> 方法的返回值，简化判断逻辑：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token function">Confirm</span><span class="token punctuation">(</span>question <span class="token builtin">string</span><span class="token punctuation">,</span> option <span class="token operator">...</span>ConfirmOption<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> <span class="token function">Confirm</span><span class="token punctuation">(</span>question <span class="token builtin">string</span><span class="token punctuation">,</span> option <span class="token operator">...</span>ConfirmOption<span class="token punctuation">)</span> <span class="token builtin">bool</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-session-自定义驱动方式" tabindex="-1"><a class="header-anchor" href="#优化-session-自定义驱动方式"><span>优化 Session 自定义驱动方式</span></a></h3><p>之前，你需要通过 <code>facades.Session().Extend</code> 方法注册驱动，从 v1.16 开始，你只需要将其添加到 <code>config/session.go</code> 配置文件中即可：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// app/providers/app_service_provider.go</span></span>
<span class="line"><span class="token operator">--</span> facades<span class="token punctuation">.</span><span class="token function">Session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Extend</span><span class="token punctuation">(</span><span class="token string">&quot;redis&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span>Driver <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">--</span>   <span class="token keyword">return</span> <span class="token operator">&amp;</span>RedisDriver<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">--</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// config/session.go</span></span>
<span class="line"><span class="token string">&quot;drivers&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;redis&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;via&quot;</span><span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>session<span class="token punctuation">.</span>Driver<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token operator">&amp;</span>RedisDriver<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,36)),s("p",null,[t(e,{to:"/zh/the-basics/session.html#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BC%9A%E8%AF%9D%E9%A9%B1%E5%8A%A8"},{default:p(()=>n[40]||(n[40]=[a("查看文档")])),_:1})]),n[54]||(n[54]=l(`<h3 id="优化-testing-request-方法" tabindex="-1"><a class="header-anchor" href="#优化-testing-request-方法"><span>优化 Testing.Request 方法</span></a></h3><p>优化 <code>WithCookies</code> 和 <code>WithCookie</code> 方法的入参：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token function">WithCookies</span><span class="token punctuation">(</span>cookies <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> Request</span>
<span class="line"><span class="token operator">++</span> <span class="token function">WithCookies</span><span class="token punctuation">(</span>cookies <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>http<span class="token punctuation">.</span>Cookie<span class="token punctuation">)</span> Request</span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> <span class="token function">WithCookie</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value <span class="token builtin">string</span><span class="token punctuation">)</span> Request</span>
<span class="line"><span class="token operator">++</span> <span class="token function">WithCookie</span><span class="token punctuation">(</span>cookie <span class="token operator">*</span>http<span class="token punctuation">.</span>Cookie<span class="token punctuation">)</span> Request</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-carbon-方法" tabindex="-1"><a class="header-anchor" href="#优化-carbon-方法"><span>优化 Carbon 方法</span></a></h3><p><code>carbon.NewDateTime</code> 等方法原来返回的是 struct 实例，v1.16 开始返回指针，如果你定义了 <code>carbon.DateTime</code> 等类型，需要修改为 <code>*carbon.DateTime</code> 等指针类型。</p><h3 id="优化-queue-配置" tabindex="-1"><a class="header-anchor" href="#优化-queue-配置"><span>优化 Queue 配置</span></a></h3><p>v1.15 之前，Queue 模块的 Redis 驱动使用 <a href="https://github.com/RichardKnop/machinery" target="_blank" rel="noopener noreferrer">RichardKnop/machinery</a> 实现。从 v1.16 开始，Redis 驱动在 <a href="https://github.com/goravel/redis" target="_blank" rel="noopener noreferrer">goravel/redis</a> 中提供官方支持。</p><p>你依然可以在 v1.16 中使用 Machinery 驱动，但其将在 v1.17 中被移除，建议使用 Redis 驱动。下面提供两种升级方式：</p><h4 id="继续使用-machinery-驱动" tabindex="-1"><a class="header-anchor" href="#继续使用-machinery-驱动"><span>继续使用 Machinery 驱动</span></a></h4><p>修改 <code>config/queue.go</code> 文件中的配置：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/queue.go</span></span>
<span class="line"><span class="token string">&quot;connections&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">...</span></span>
<span class="line">  <span class="token string">&quot;redis&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">--</span>    <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>     <span class="token string">&quot;redis&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>     <span class="token string">&quot;machinery&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;connection&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;queue&quot;</span><span class="token punctuation">:</span>      config<span class="token punctuation">.</span><span class="token function">Env</span><span class="token punctuation">(</span><span class="token string">&quot;REDIS_QUEUE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用-redis-队列驱动" tabindex="-1"><a class="header-anchor" href="#使用-redis-队列驱动"><span>使用 Redis 队列驱动</span></a></h4><p>修改 <code>config/queue.go</code> 文件中的配置：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/queue.go</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;github.com/goravel/framework/contracts/queue&quot;</span></span>
<span class="line">  redisfacades <span class="token string">&quot;github.com/goravel/redis/facades&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token string">&quot;connections&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">...</span></span>
<span class="line">  <span class="token string">&quot;redis&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">--</span>  <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>     <span class="token string">&quot;redis&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>  <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>     <span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;connection&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;queue&quot;</span><span class="token punctuation">:</span>      config<span class="token punctuation">.</span><span class="token function">Env</span><span class="token punctuation">(</span><span class="token string">&quot;REDIS_QUEUE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>  <span class="token string">&quot;via&quot;</span><span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>Driver<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token keyword">return</span> redisfacades<span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;redis&quot;</span><span class="token punctuation">)</span> <span class="token comment">// The \` + &quot;\`redis\`&quot; + \` value is the key of \` + &quot;\`connections\`&quot; + \`</span></span>
<span class="line"><span class="token operator">++</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>新的 Redis 队列驱动与原 machinery 队列驱动的任务都保存在同一个 Redis 中，但使用不同的队列名称。即使你切换为新的 Redis 队列驱动，框架会继续读取原 Machinery 队列驱动的任务，直到 Machinery 中所有任务执行完毕。与此同时，新的队列任务不再写入 Machinery 队列中，而是写入新的 Redis 队列，并被新的 Redis 队列驱动消费。以实现两个驱动间的无缝切换。</p><p>你可以到 Redis 中查看两个驱动的数据是否被正确写入与消费：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">redis-cli</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取 Redis 中所有的键</span></span>
<span class="line">keys</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看 Machinery 队列驱动数据（替换 {} 中的值）</span></span>
<span class="line">LRANGE <span class="token punctuation">{</span>app_name<span class="token punctuation">}</span>_queues:<span class="token punctuation">{</span>queue_name<span class="token punctuation">}</span> <span class="token number">0</span> <span class="token parameter variable">-1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看 Redis 队列驱动数据（替换 {} 中的值）</span></span>
<span class="line">LRANGE <span class="token punctuation">{</span>app_name<span class="token punctuation">}</span>_queues:<span class="token punctuation">{</span>connection<span class="token punctuation">}</span>_<span class="token punctuation">{</span>queue<span class="token punctuation">}</span> <span class="token number">0</span> <span class="token parameter variable">-1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,17))])}const g=i(r,[["render",d],["__file","v1.16.html.vue"]]),m=JSON.parse('{"path":"/zh/upgrade/v1.16.html","title":"从 v1.15 升级到 v1.16","lang":"zh-CN","frontmatter":{"description":"从 v1.15 升级到 v1.16 令人兴奋的新功能 🎉 新增 facades.DB() 新增 facades.Http() 重构 facades.Queue() facades.Auth() 支持自定义驱动 make:* 命令生成的文件支持自动注册 Goravel Installer 支持选择驱动 功能增强 🚀 拆分数据库驱动 Orm 新增特性 ...","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://goravel.dev/upgrade/v1.16.html"}],["meta",{"property":"og:url","content":"https://goravel.dev/zh/upgrade/v1.16.html"}],["meta",{"property":"og:site_name","content":"Goravel"}],["meta",{"property":"og:title","content":"/upgrade/v1.16.html"}],["meta",{"property":"og:description","content":"从 v1.15 升级到 v1.16 令人兴奋的新功能 🎉 新增 facades.DB() 新增 facades.Http() 重构 facades.Queue() facades.Auth() 支持自定义驱动 make:* 命令生成的文件支持自动注册 Goravel Installer 支持选择驱动 功能增强 🚀 拆分数据库驱动 Orm 新增特性 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"从 v1.15 升级到 v1.16\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":3,"title":"令人兴奋的新功能 🎉","slug":"令人兴奋的新功能-🎉","link":"#令人兴奋的新功能-🎉","children":[]},{"level":3,"title":"功能增强 🚀","slug":"功能增强-🚀","link":"#功能增强-🚀","children":[]},{"level":3,"title":"破坏性变化 🛠","slug":"破坏性变化-🛠","link":"#破坏性变化-🛠","children":[]},{"level":2,"title":"升级指南","slug":"升级指南","link":"#升级指南","children":[{"level":3,"title":"1. 更新依赖","slug":"_1-更新依赖","link":"#_1-更新依赖","children":[]},{"level":3,"title":"2. 修改数据库配置","slug":"_2-修改数据库配置","link":"#_2-修改数据库配置","children":[]},{"level":3,"title":"3. 修改 auth.go 配置文件","slug":"_3-修改-auth-go-配置文件","link":"#_3-修改-auth-go-配置文件","children":[]},{"level":3,"title":"4. 修改 session.go 配置文件","slug":"_4-修改-session-go-配置文件","link":"#_4-修改-session-go-配置文件","children":[]},{"level":3,"title":"5. 修改 queue.go 配置文件","slug":"_5-修改-queue-go-配置文件","link":"#_5-修改-queue-go-配置文件","children":[]},{"level":3,"title":"6. 如果需要使用 HTTP Client","slug":"_6-如果需要使用-http-client","link":"#_6-如果需要使用-http-client","children":[]},{"level":3,"title":"7. 如果正在使用 goravel/redis 驱动","slug":"_7-如果正在使用-goravel-redis-驱动","link":"#_7-如果正在使用-goravel-redis-驱动","children":[]},{"level":3,"title":"8. 如果正在使用 carbon.DateTime 等方法","slug":"_8-如果正在使用-carbon-datetime-等方法","link":"#_8-如果正在使用-carbon-datetime-等方法","children":[]},{"level":3,"title":"9. 如果正在使用 session 自定义驱动","slug":"_9-如果正在使用-session-自定义驱动","link":"#_9-如果正在使用-session-自定义驱动","children":[]},{"level":3,"title":"10. 如果正在使用 facades.Config() 中的方法","slug":"_10-如果正在使用-facades-config-中的方法","link":"#_10-如果正在使用-facades-config-中的方法","children":[]},{"level":3,"title":"11. 如果正在使用 SQL 数据迁移","slug":"_11-如果正在使用-sql-数据迁移","link":"#_11-如果正在使用-sql-数据迁移","children":[]},{"level":3,"title":"12. 如果正在使用 Orm","slug":"_12-如果正在使用-orm","link":"#_12-如果正在使用-orm","children":[]},{"level":3,"title":"13. 如果正在使用 Path 方法","slug":"_13-如果正在使用-path-方法","link":"#_13-如果正在使用-path-方法","children":[]},{"level":3,"title":"14. 如果 正在使用 ctx.Request().InputMap 方法","slug":"_14-如果-正在使用-ctx-request-inputmap-方法","link":"#_14-如果-正在使用-ctx-request-inputmap-方法","children":[]},{"level":3,"title":"15. 如果正在使用 console.Confirm 方法","slug":"_15-如果正在使用-console-confirm-方法","link":"#_15-如果正在使用-console-confirm-方法","children":[]},{"level":3,"title":"16. 如果正在使用 Testing.Request 方法","slug":"_16-如果正在使用-testing-request-方法","link":"#_16-如果正在使用-testing-request-方法","children":[]}]},{"level":2,"title":"功能介绍","slug":"功能介绍","link":"#功能介绍","children":[{"level":3,"title":"新增 facades.DB()","slug":"新增-facades-db","link":"#新增-facades-db","children":[]},{"level":3,"title":"新增 facades.Http()","slug":"新增-facades-http","link":"#新增-facades-http","children":[]},{"level":3,"title":"重构 facades.Queue()","slug":"重构-facades-queue","link":"#重构-facades-queue","children":[]},{"level":3,"title":"facades.Auth() 支持自定义驱动","slug":"facades-auth-支持自定义驱动","link":"#facades-auth-支持自定义驱动","children":[]},{"level":3,"title":"make:* 命令生成的文件支持自动注册","slug":"make-命令生成的文件支持自动注册","link":"#make-命令生成的文件支持自动注册","children":[]},{"level":3,"title":"Goravel Installer 支持选择驱动","slug":"goravel-installer-支持选择驱动","link":"#goravel-installer-支持选择驱动","children":[]},{"level":3,"title":"拆分数据库驱动","slug":"拆分数据库驱动","link":"#拆分数据库驱动","children":[]},{"level":3,"title":"Orm 新增特性","slug":"orm-新增特性","link":"#orm-新增特性","children":[]},{"level":3,"title":"支持根据数据表创建 Model","slug":"支持根据数据表创建-model","link":"#支持根据数据表创建-model","children":[]},{"level":3,"title":"支持运行时动态获取 SQL 语句","slug":"支持运行时动态获取-sql-语句","link":"#支持运行时动态获取-sql-语句","children":[]},{"level":3,"title":"Migration 新增特性","slug":"migration-新增特性","link":"#migration-新增特性","children":[]},{"level":3,"title":"Grpc 新增 Shutdown 方法","slug":"grpc-新增-shutdown-方法","link":"#grpc-新增-shutdown-方法","children":[]},{"level":3,"title":"Artisan 新增禁用打印颜色选项","slug":"artisan-新增禁用打印颜色选项","link":"#artisan-新增禁用打印颜色选项","children":[]},{"level":3,"title":"加解密 env 文件","slug":"加解密-env-文件","link":"#加解密-env-文件","children":[]},{"level":3,"title":"发送邮件支持设置 Header","slug":"发送邮件支持设置-header","link":"#发送邮件支持设置-header","children":[]},{"level":3,"title":"Installer 支持自升级","slug":"installer-支持自升级","link":"#installer-支持自升级","children":[]},{"level":3,"title":"多语言文件支持 embed 加载","slug":"多语言文件支持-embed-加载","link":"#多语言文件支持-embed-加载","children":[]},{"level":3,"title":"定时任务支持设置秒级任务","slug":"定时任务支持设置秒级任务","link":"#定时任务支持设置秒级任务","children":[]},{"level":3,"title":"Request 新增特性","slug":"request-新增特性","link":"#request-新增特性","children":[]},{"level":3,"title":"Route 新增特性","slug":"route-新增特性","link":"#route-新增特性","children":[]},{"level":3,"title":"Testing 支持创建 Cache 镜像","slug":"testing-支持创建-cache-镜像","link":"#testing-支持创建-cache-镜像","children":[]},{"level":3,"title":"不同 JWT Guard 支持设置不同的 ttl 与 secert","slug":"不同-jwt-guard-支持设置不同的-ttl-与-secert","link":"#不同-jwt-guard-支持设置不同的-ttl-与-secert","children":[]},{"level":3,"title":"注册 ServiceProvider 不再依赖顺序","slug":"注册-serviceprovider-不再依赖顺序","link":"#注册-serviceprovider-不再依赖顺序","children":[]},{"level":3,"title":"移除 SQL 迁移","slug":"移除-sql-迁移","link":"#移除-sql-迁移","children":[]},{"level":3,"title":"优化 Config 模块方法默认值类型","slug":"优化-config-模块方法默认值类型","link":"#优化-config-模块方法默认值类型","children":[]},{"level":3,"title":"优化 Orm 方法","slug":"优化-orm-方法","link":"#优化-orm-方法","children":[]},{"level":3,"title":"优化 Path 方法","slug":"优化-path-方法","link":"#优化-path-方法","children":[]},{"level":3,"title":"优化 Request 方法","slug":"优化-request-方法","link":"#优化-request-方法","children":[]},{"level":3,"title":"优化 console Confirm 方法","slug":"优化-console-confirm-方法","link":"#优化-console-confirm-方法","children":[]},{"level":3,"title":"优化 Session 自定义驱动方式","slug":"优化-session-自定义驱动方式","link":"#优化-session-自定义驱动方式","children":[]},{"level":3,"title":"优化 Testing.Request 方法","slug":"优化-testing-request-方法","link":"#优化-testing-request-方法","children":[]},{"level":3,"title":"优化 Carbon 方法","slug":"优化-carbon-方法","link":"#优化-carbon-方法","children":[]},{"level":3,"title":"优化 Queue 配置","slug":"优化-queue-配置","link":"#优化-queue-配置","children":[]}]}],"git":{},"filePathRelative":"zh/upgrade/v1.16.md","autoDesc":true}');export{g as comp,m as data};
