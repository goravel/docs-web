import{_ as l,c as u,b as s,e as t,f as e,d as a,a as r,r as o,o as d}from"./app-CgAH1ugc.js";const k={},v={class:"table-of-contents"};function m(g,n){const p=o("router-link"),i=o("RouteLink"),c=o("CommentService");return d(),u("div",null,[n[13]||(n[13]=s("h1",{id:"authorization",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#authorization"},[s("span",null,"Authorization")])],-1)),s("nav",v,[s("ul",null,[s("li",null,[t(p,{to:"#introduction"},{default:e(()=>n[0]||(n[0]=[a("Introduction")])),_:1})]),s("li",null,[t(p,{to:"#gates"},{default:e(()=>n[1]||(n[1]=[a("Gates")])),_:1}),s("ul",null,[s("li",null,[t(p,{to:"#writing-gates"},{default:e(()=>n[2]||(n[2]=[a("Writing Gates")])),_:1})]),s("li",null,[t(p,{to:"#authorizing-actions"},{default:e(()=>n[3]||(n[3]=[a("Authorizing Actions")])),_:1})]),s("li",null,[t(p,{to:"#gate-responses"},{default:e(()=>n[4]||(n[4]=[a("Gate Responses")])),_:1})]),s("li",null,[t(p,{to:"#intercepting-gate-checks"},{default:e(()=>n[5]||(n[5]=[a("Intercepting Gate Checks")])),_:1})]),s("li",null,[t(p,{to:"#inject-context"},{default:e(()=>n[6]||(n[6]=[a("Inject Context")])),_:1})])])]),s("li",null,[t(p,{to:"#policies"},{default:e(()=>n[7]||(n[7]=[a("Policies")])),_:1}),s("ul",null,[s("li",null,[t(p,{to:"#generating-policies"},{default:e(()=>n[8]||(n[8]=[a("Generating Policies")])),_:1})]),s("li",null,[t(p,{to:"#writing-policies"},{default:e(()=>n[9]||(n[9]=[a("Writing Policies")])),_:1})])])])])]),n[14]||(n[14]=s("h2",{id:"introduction",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#introduction"},[s("span",null,"Introduction")])],-1)),s("p",null,[n[11]||(n[11]=a("Goravel offers built-in ")),t(i,{to:"/security/authentication.html"},{default:e(()=>n[10]||(n[10]=[a("authentication")])),_:1}),n[12]||(n[12]=a(" services and an easy-to-use authorization feature to manage user actions on resources. Even if a user is authenticated, they may not have the authority to modify or delete certain Eloquent models or database records. Goravel's authorization feature allows for a systematic way of managing these authorization checks."))]),n[15]||(n[15]=r(`<p>There are two ways to authorize actions in Goravel: <a href="#Gates">gates</a> and <a href="#Policies">policies</a>. Imagine gates and policies as similar to routes and controllers. Gates are based on closures and provide a simple approach to authorization, whereas policies group logic around a specific resource, similar to controllers. This documentation will first cover gates and then delve into policies.</p><p>It&#39;s not necessary to exclusively use gates or policies when building an application. Most applications will use a combination of both, which is perfectly acceptable!</p><h2 id="gates" tabindex="-1"><a class="header-anchor" href="#gates"><span>Gates</span></a></h2><h3 id="writing-gates" tabindex="-1"><a class="header-anchor" href="#writing-gates"><span>Writing Gates</span></a></h3><p>Gates serve as closures that verify whether a user is authorized to perform a specific action. They are commonly set up in the <code>app/providers/auth_service_provider.go</code> file&#39;s <code>Boot</code> method using the Gate facade.</p><p>In this scenario, we will establish a gate to check if a user can modify a particular Post model by comparing its ID to the user_id of the post&#39;s creator.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">package</span> providers</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;context&quot;</span></span>
<span class="line"></span>
<span class="line">  contractsaccess <span class="token string">&quot;github.com/goravel/framework/contracts/auth/access&quot;</span></span>
<span class="line">  <span class="token string">&quot;github.com/goravel/framework/auth/access&quot;</span></span>
<span class="line">  <span class="token string">&quot;github.com/goravel/framework/facades&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> AuthServiceProvider <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>receiver <span class="token operator">*</span>AuthServiceProvider<span class="token punctuation">)</span> <span class="token function">Register</span><span class="token punctuation">(</span>app foundation<span class="token punctuation">.</span>Application<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>receiver <span class="token operator">*</span>AuthServiceProvider<span class="token punctuation">)</span> <span class="token function">Boot</span><span class="token punctuation">(</span>app foundation<span class="token punctuation">.</span>Application<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  facades<span class="token punctuation">.</span><span class="token function">Gate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Define</span><span class="token punctuation">(</span><span class="token string">&quot;update-post&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> arguments <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">)</span> contractsaccess<span class="token punctuation">.</span>Response <span class="token punctuation">{</span></span>
<span class="line">      user <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>User<span class="token punctuation">)</span></span>
<span class="line">      post <span class="token operator">:=</span> arguments<span class="token punctuation">[</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Post<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">if</span> user<span class="token punctuation">.</span>ID <span class="token operator">==</span> post<span class="token punctuation">.</span>UserID <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> access<span class="token punctuation">.</span><span class="token function">NewAllowResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> access<span class="token punctuation">.</span><span class="token function">NewDenyResponse</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="authorizing-actions" tabindex="-1"><a class="header-anchor" href="#authorizing-actions"><span>Authorizing Actions</span></a></h3><p>To authorize an action using gates, you should use the <code>Allows</code> or <code>Denies</code> methods provided by the Gate facade:</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">package</span> controllers</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;github.com/goravel/framework/facades&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> UserController <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>UserController<span class="token punctuation">)</span> <span class="token function">Show</span><span class="token punctuation">(</span>ctx http<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Response <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> post models<span class="token punctuation">.</span>Post</span>
<span class="line">  <span class="token keyword">if</span> facades<span class="token punctuation">.</span><span class="token function">Gate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Allows</span><span class="token punctuation">(</span><span class="token string">&quot;update-post&quot;</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;post&quot;</span><span class="token punctuation">:</span> post<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can authorize multiple actions simultaneously using the <code>Any</code> or <code>None</code> methods.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">if</span> facades<span class="token punctuation">.</span><span class="token function">Gate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;update-post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete-post&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;post&quot;</span><span class="token punctuation">:</span> post<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// The user can update or delete the post...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> facades<span class="token punctuation">.</span><span class="token function">Gate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">None</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;update-post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete-post&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;post&quot;</span><span class="token punctuation">:</span> post<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// The user can&#39;t update or delete the post...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gate-responses" tabindex="-1"><a class="header-anchor" href="#gate-responses"><span>Gate Responses</span></a></h3><p>The <code>Allows</code> method returns a boolean value. To get the full authorization response, use the <code>Inspect</code> method.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">response <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Gate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Inspect</span><span class="token punctuation">(</span><span class="token string">&quot;edit-settings&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> response<span class="token punctuation">.</span><span class="token function">Allowed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// The action is authorized...</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="intercepting-gate-checks" tabindex="-1"><a class="header-anchor" href="#intercepting-gate-checks"><span>Intercepting Gate Checks</span></a></h3><p>Sometimes, you may wish to grant all abilities to a specific user. You can define a closure using the <code>Before</code> method, which runs before any other authorization checks:</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">facades<span class="token punctuation">.</span><span class="token function">Gate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> ability <span class="token builtin">string</span><span class="token punctuation">,</span> arguments <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">)</span> contractsaccess<span class="token punctuation">.</span>Response <span class="token punctuation">{</span></span>
<span class="line">  user <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>User<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token function">isAdministrator</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> access<span class="token punctuation">.</span><span class="token function">NewAllowResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If the <code>Before</code> closure returns a non-nil result, that result will be considered the result of the authorization check.</p><p>The <code>After</code> method can be used to define a closure that will be executed after all other authorization checks.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">facades<span class="token punctuation">.</span><span class="token function">Gate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> ability <span class="token builtin">string</span><span class="token punctuation">,</span> arguments <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">,</span> result contractsaccess<span class="token punctuation">.</span>Response<span class="token punctuation">)</span> contractsaccess<span class="token punctuation">.</span>Response <span class="token punctuation">{</span></span>
<span class="line">  user <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>User<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token function">isAdministrator</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> access<span class="token punctuation">.</span><span class="token function">NewAllowResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Notice: The return result of <code>After</code> will be applied only when <code>facades.Gate().Define</code> returns nil.</p></blockquote><h3 id="inject-context" tabindex="-1"><a class="header-anchor" href="#inject-context"><span>Inject Context</span></a></h3><p>The <code>context</code> will be passed to the <code>Before</code>, <code>After</code>, and <code>Define</code> methods.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">facades<span class="token punctuation">.</span><span class="token function">Gate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Allows</span><span class="token punctuation">(</span><span class="token string">&quot;update-post&quot;</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;post&quot;</span><span class="token punctuation">:</span> post<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="policies" tabindex="-1"><a class="header-anchor" href="#policies"><span>Policies</span></a></h2><h3 id="generating-policies" tabindex="-1"><a class="header-anchor" href="#generating-policies"><span>Generating Policies</span></a></h3><p>You can use the <code>make:policy</code> Artisan command to generate a policy. The generated policy will be saved in the <code>app/policies</code> directory. If the directory does not exist in your application, Goravel will create it for you.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">go</span> run <span class="token punctuation">.</span> artisan <span class="token builtin">make</span><span class="token punctuation">:</span>policy PostPolicy</span>
<span class="line"><span class="token keyword">go</span> run <span class="token punctuation">.</span> artisan <span class="token builtin">make</span><span class="token punctuation">:</span>policy user<span class="token operator">/</span>PostPolicy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="writing-policies" tabindex="-1"><a class="header-anchor" href="#writing-policies"><span>Writing Policies</span></a></h3><p>Let&#39;s define an <code>Update</code> method on <code>PostPolicy</code> to check if a <code>User</code> can update a <code>Post</code>.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">package</span> policies</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;context&quot;</span></span>
<span class="line">  <span class="token string">&quot;goravel/app/models&quot;</span></span>
<span class="line"></span>
<span class="line">  <span class="token string">&quot;github.com/goravel/framework/auth/access&quot;</span></span>
<span class="line">  contractsaccess <span class="token string">&quot;github.com/goravel/framework/contracts/auth/access&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> PostPolicy <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NewPostPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>PostPolicy <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token operator">&amp;</span>PostPolicy<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>PostPolicy<span class="token punctuation">)</span> <span class="token function">Update</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> arguments <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">)</span> contractsaccess<span class="token punctuation">.</span>Response <span class="token punctuation">{</span></span>
<span class="line">  user <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>User<span class="token punctuation">)</span></span>
<span class="line">  post <span class="token operator">:=</span> arguments<span class="token punctuation">[</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Post<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> user<span class="token punctuation">.</span>ID <span class="token operator">==</span> post<span class="token punctuation">.</span>UserID <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> access<span class="token punctuation">.</span><span class="token function">NewAllowResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> access<span class="token punctuation">.</span><span class="token function">NewDenyResponse</span><span class="token punctuation">(</span><span class="token string">&quot;You do not own this post.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then we can register the policy to <code>app/providers/auth_service_provider.go</code>:</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">facades<span class="token punctuation">.</span><span class="token function">Gate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Define</span><span class="token punctuation">(</span><span class="token string">&quot;update-post&quot;</span><span class="token punctuation">,</span> policies<span class="token punctuation">.</span><span class="token function">NewPostPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Update<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>As you work on authorizing different actions, you can add more methods to your policy. For instance, you can create <code>View</code> or <code>Delete</code> methods to authorize various model-related actions. Feel free to name your policy methods as you see fit.</p>`,35)),t(c)])}const b=l(k,[["render",m],["__file","authorization.html.vue"]]),f=JSON.parse('{"path":"/security/authorization.html","title":"Authorization","lang":"en-US","frontmatter":{"description":"Authorization Introduction Goravel offers built-in services and an easy-to-use authorization feature to manage user actions on resources. Even if a user is authenticated, they m...","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://goravel.dev/zh/security/authorization.html"}],["meta",{"property":"og:url","content":"https://goravel.dev/security/authorization.html"}],["meta",{"property":"og:site_name","content":"Goravel"}],["meta",{"property":"og:title","content":"/security/authorization.html"}],["meta",{"property":"og:description","content":"Authorization Introduction Goravel offers built-in services and an easy-to-use authorization feature to manage user actions on resources. Even if a user is authenticated, they m..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Authorization\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Introduction","slug":"introduction","link":"#introduction","children":[]},{"level":2,"title":"Gates","slug":"gates","link":"#gates","children":[{"level":3,"title":"Writing Gates","slug":"writing-gates","link":"#writing-gates","children":[]},{"level":3,"title":"Authorizing Actions","slug":"authorizing-actions","link":"#authorizing-actions","children":[]},{"level":3,"title":"Gate Responses","slug":"gate-responses","link":"#gate-responses","children":[]},{"level":3,"title":"Intercepting Gate Checks","slug":"intercepting-gate-checks","link":"#intercepting-gate-checks","children":[]},{"level":3,"title":"Inject Context","slug":"inject-context","link":"#inject-context","children":[]}]},{"level":2,"title":"Policies","slug":"policies","link":"#policies","children":[{"level":3,"title":"Generating Policies","slug":"generating-policies","link":"#generating-policies","children":[]},{"level":3,"title":"Writing Policies","slug":"writing-policies","link":"#writing-policies","children":[]}]}],"git":{},"filePathRelative":"security/authorization.md","autoDesc":true}');export{b as comp,f as data};
