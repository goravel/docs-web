import{_ as i,r as o,o as u,c as r,a as n,b as s,w as t,d as a,e as p}from"./app-BWlA1b6i.js";const d={},k=n("h1",{id:"模型工厂",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#模型工厂"},[n("span",null,"模型工厂")])],-1),v={class:"table-of-contents"},m=p(`<h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍"><span>介绍</span></a></h2><p>测试时您可能需要在执行测试之前向数据库中插入一些记录。Goravel 允许你使用模型工厂为每个模型定义一组默认属性，而不是在创建测试数据时手动指定每一列的值。</p><p>要了解如何编写工厂，请查看应用程序中的 <code>database/factories/user_factory.go</code> 文件：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> factories

<span class="token keyword">type</span> UserFactory <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment">// Definition Define the model&#39;s default state.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>UserFactory<span class="token punctuation">)</span> <span class="token function">Definition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span>
    <span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Goravel&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),g=n("code",null,"Definition",-1),f=n("code",null,"Definition",-1),b={href:"https://github.com/brianvoe/gofakeit",target:"_blank",rel:"noopener noreferrer"},h=p(`<h2 id="创建工厂" tabindex="-1"><a class="header-anchor" href="#创建工厂"><span>创建工厂</span></a></h2><p>可以使用 Artisan 命令 <code>make:factory</code> 创建工厂：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>go run . artisan make:factory PostFactory
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>新工厂将放置在您的 <code>database/factories</code> 目录下。</p><h3 id="模型和工厂的关联约定" tabindex="-1"><a class="header-anchor" href="#模型和工厂的关联约定"><span>模型和工厂的关联约定</span></a></h3><p>定义工厂后，可以在模型中使用 <code>Factory()</code> 方法将工厂与模型绑定在一起：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> models

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;github.com/goravel/framework/contracts/database/factory&quot;</span>
  <span class="token string">&quot;github.com/goravel/framework/database/orm&quot;</span>

  <span class="token string">&quot;goravel/database/factories&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  orm<span class="token punctuation">.</span>Model
  Name   <span class="token builtin">string</span>
  Avatar <span class="token builtin">string</span>
  orm<span class="token punctuation">.</span>SoftDeletes
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> factory<span class="token punctuation">.</span>Factory <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&amp;</span>factories<span class="token punctuation">.</span>UserFactory<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用工厂创建模型" tabindex="-1"><a class="header-anchor" href="#使用工厂创建模型"><span>使用工厂创建模型</span></a></h2><h3 id="实例化模型" tabindex="-1"><a class="header-anchor" href="#实例化模型"><span>实例化模型</span></a></h3><p>我们可以使用 <code>Make</code> 方法来创建模型而且不需要将它们持久化到数据库中：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> user models<span class="token punctuation">.</span>User
err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Make</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以使用 <code>Count</code> 方法创建许多模型的集合：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>models<span class="token punctuation">.</span>User
err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Make</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果您想覆盖模型的一些默认值，你可以将 <code>map[string]any</code> 传递给 <code>Make</code> 方法。只有指定的属性将被替换，而这些属性的其余部分保持设置为其默认值：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> user models<span class="token punctuation">.</span>User
err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Make</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span>
    <span class="token string">&quot;Avatar&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;avatar&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="持久化模型" tabindex="-1"><a class="header-anchor" href="#持久化模型"><span>持久化模型</span></a></h3><p><code>Create</code> 方法创建模型实例，并使用 Orm 的 <code>Save</code> 方法其持久化到数据库中：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> user models<span class="token punctuation">.</span>User
err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>models<span class="token punctuation">.</span>User
err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>您可以通过将 <code>map[string]any</code> 传递给 <code>Create</code> 方法来覆盖模型上的属性：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> user models<span class="token punctuation">.</span>User
err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span>
    <span class="token string">&quot;Avatar&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;avatar&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="忽略模型事件" tabindex="-1"><a class="header-anchor" href="#忽略模型事件"><span>忽略模型事件</span></a></h3>`,21),y=n("code",null,"CreateQuietly",-1),_=p(`<div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> user models<span class="token punctuation">.</span>User
err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CreateQuietly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function x(w,q){const e=o("router-link"),c=o("ExternalLinkIcon"),l=o("RouteLink");return u(),r("div",null,[k,n("nav",v,[n("ul",null,[n("li",null,[s(e,{to:"#介绍"},{default:t(()=>[a("介绍")]),_:1})]),n("li",null,[s(e,{to:"#创建工厂"},{default:t(()=>[a("创建工厂")]),_:1}),n("ul",null,[n("li",null,[s(e,{to:"#模型和工厂的关联约定"},{default:t(()=>[a("模型和工厂的关联约定")]),_:1})])])]),n("li",null,[s(e,{to:"#使用工厂创建模型"},{default:t(()=>[a("使用工厂创建模型")]),_:1}),n("ul",null,[n("li",null,[s(e,{to:"#实例化模型"},{default:t(()=>[a("实例化模型")]),_:1})]),n("li",null,[s(e,{to:"#持久化模型"},{default:t(()=>[a("持久化模型")]),_:1})]),n("li",null,[s(e,{to:"#忽略模型事件"},{default:t(()=>[a("忽略模型事件")]),_:1})])])])])]),m,n("p",null,[a("正如您所见，在最基本的形式中，factories 是定义 "),g,a(" 方法的 struct。"),f,a(" 方法返回对应模型的属性值。可以使用 "),n("a",b,[a("brianvoe/gofakeit"),s(c)]),a(" 包来生成各种随机数据。")]),h,n("p",null,[a("在模型上可能会定义有"),s(l,{to:"/zh/orm/getting-started.html#events"},{default:t(()=>[a("模型事件")]),_:1}),a("，您可以使用 "),y,a(" 忽略这些事件：")]),_])}const F=i(d,[["render",x],["__file","factories.html.vue"]]),U=JSON.parse('{"path":"/zh/orm/factories.html","title":"模型工厂","lang":"zh-CN","frontmatter":{"description":"模型工厂 介绍 测试时您可能需要在执行测试之前向数据库中插入一些记录。Goravel 允许你使用模型工厂为每个模型定义一组默认属性，而不是在创建测试数据时手动指定每一列的值。 要了解如何编写工厂，请查看应用程序中的 database/factories/user_factory.go 文件： 正如您所见，在最基本的形式中，factories 是定义 D...","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://goravel.dev/orm/factories.html"}],["meta",{"property":"og:url","content":"https://goravel.dev/zh/orm/factories.html"}],["meta",{"property":"og:site_name","content":"Goravel"}],["meta",{"property":"og:title","content":"/orm/factories.html"}],["meta",{"property":"og:description","content":"模型工厂 介绍 测试时您可能需要在执行测试之前向数据库中插入一些记录。Goravel 允许你使用模型工厂为每个模型定义一组默认属性，而不是在创建测试数据时手动指定每一列的值。 要了解如何编写工厂，请查看应用程序中的 database/factories/user_factory.go 文件： 正如您所见，在最基本的形式中，factories 是定义 D..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"模型工厂\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"介绍","slug":"介绍","link":"#介绍","children":[]},{"level":2,"title":"创建工厂","slug":"创建工厂","link":"#创建工厂","children":[{"level":3,"title":"模型和工厂的关联约定","slug":"模型和工厂的关联约定","link":"#模型和工厂的关联约定","children":[]}]},{"level":2,"title":"使用工厂创建模型","slug":"使用工厂创建模型","link":"#使用工厂创建模型","children":[{"level":3,"title":"实例化模型","slug":"实例化模型","link":"#实例化模型","children":[]},{"level":3,"title":"持久化模型","slug":"持久化模型","link":"#持久化模型","children":[]},{"level":3,"title":"忽略模型事件","slug":"忽略模型事件","link":"#忽略模型事件","children":[]}]}],"git":{},"filePathRelative":"zh/orm/factories.md","autoDesc":true}');export{F as comp,U as data};
