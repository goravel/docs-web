import{_ as l,r as i,o as u,c as d,a as n,b as a,w as e,d as s,e as p}from"./app-0837LSdt.js";const r={},k=n("h1",{id:"快速入门",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#快速入门"},[n("span",null,"快速入门")])],-1),v={class:"table-of-contents"},m=p(`<h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍"><span>介绍</span></a></h2><p>Goravel 的测试功能依托于 Golang 自带的 test 官方组件，是对单元测试的扩展，使 Goravel 应用程序支持集成测试，让应用变得更加健壮。</p><h2 id="环境" tabindex="-1"><a class="header-anchor" href="#环境"><span>环境</span></a></h2><h3 id="自定义环境配置文件" tabindex="-1"><a class="header-anchor" href="#自定义环境配置文件"><span>自定义环境配置文件</span></a></h3><p>测试时默认使用根目录下的 <code>.env</code> 文件注入配置信息，如果想为不同的包使用不同的 <code>.env</code> 文件，可以在包目录下创建 <code>.env</code> 文件，测试时会优先读取该文件。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>- /app
- /config
- ...
- /test
  - /feature
    - .env
    - user_test.go
- .env
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>您也可以在运行 <code>go test</code> 时使用 <code>--env=.env.testing</code> 选项自定义配置文件，但需注意，此选项需跟在测试目录后面，例如：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>go <span class="token builtin class-name">test</span> ./<span class="token punctuation">..</span>. <span class="token parameter variable">--env</span><span class="token operator">=</span>.env.testing
go <span class="token builtin class-name">test</span> ./<span class="token punctuation">..</span>. <span class="token parameter variable">-e</span><span class="token operator">=</span>.env.testing
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="testcase-struct" tabindex="-1"><a class="header-anchor" href="#testcase-struct"><span><code>TestCase</code> Struct</span></a></h3><p>Goravel 包含一个 <code>TestCase</code> Struct，在未来该 Struct 将提供一些便捷测试方法，此外同一个文件中还存在一个 <code>init</code> 方法，该方法在运行测试之前引导注册 Goravel 应用程序，如果需要您可以在此方法中添加在运行测试前需要前置运行的逻辑。</p><h2 id="创建测试" tabindex="-1"><a class="header-anchor" href="#创建测试"><span>创建测试</span></a></h2><p>要创建新的测试用例，可以使用 Artisan 命令：<code>make:test</code>：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>go run <span class="token builtin class-name">.</span> artisan make:test feature/UserTest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,13),b={href:"https://github.com/stretchr/testify",target:"_blank",rel:"noopener noreferrer"},h=n("code",null,"suit",-1),g=p(`<div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> feature

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;testing&quot;</span>

  <span class="token string">&quot;github.com/stretchr/testify/suite&quot;</span>

  <span class="token string">&quot;goravel/tests&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> ExampleTestSuite <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  suite<span class="token punctuation">.</span>Suite
  tests<span class="token punctuation">.</span>TestCase
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestExampleTestSuite</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  suite<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span>ExampleTestSuite<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// SetupTest will run before each test in the suite.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">SetupTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment">// TearDownTest will run after each test in the suite.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TearDownTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TestIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  s<span class="token punctuation">.</span><span class="token function">True</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="http-测试" tabindex="-1"><a class="header-anchor" href="#http-测试"><span>HTTP 测试</span></a></h2><p>目前在测试中请使用 <code>net/http</code> 等第三方包发起 HTTP 请求，未来 Goravel 有计划在 <code>TestCase</code> Struct 中扩展 <code>Get</code>, <code>Post</code> 等方法，方便发起请求与断言。</p><h2 id="数据库测试" tabindex="-1"><a class="header-anchor" href="#数据库测试"><span>数据库测试</span></a></h2><p>Goravel 模型工厂和 Seeders 可以轻松地为应用程序的模型创建测试数据库记录。</p><h3 id="模型工厂" tabindex="-1"><a class="header-anchor" href="#模型工厂"><span>模型工厂</span></a></h3>`,6),f=p(`<div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> user models<span class="token punctuation">.</span>User
err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="运行-seeders" tabindex="-1"><a class="header-anchor" href="#运行-seeders"><span>运行 seeders</span></a></h3>`,2),_=n("code",null,"Seed",-1),T=n("code",null,"Seed",-1),x=n("code",null,"DatabaseSeeder",-1),S=n("code",null,"Seed",-1),q=p(`<div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> feature

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;testing&quot;</span>

	<span class="token string">&quot;github.com/stretchr/testify/suite&quot;</span>

	<span class="token string">&quot;goravel/database/seeders&quot;</span>
	<span class="token string">&quot;goravel/tests&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> ExampleTestSuite <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	suite<span class="token punctuation">.</span>Suite
	tests<span class="token punctuation">.</span>TestCase
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestExampleTestSuite</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	suite<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span>ExampleTestSuite<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// SetupTest will run before each test in the suite.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">SetupTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment">// TearDownTest will run after each test in the suite.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TearDownTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TestIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Run the DatabaseSeeder...</span>
	s<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// Run multiple specific seeders...</span>
	s<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>seeders<span class="token punctuation">.</span>UserSeeder<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>seeders<span class="token punctuation">.</span>PhotoSeeder<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用-docker" tabindex="-1"><a class="header-anchor" href="#使用-docker"><span>使用 Docker</span></a></h3><p>由于 <code>go test</code> 在不同包之间是并行测试，因此当使用本地数据库进行测试时，不能在测试用例中执行重置数据库操作，否则将有可能对并行运行的其他测试用例产生影响。针对这种情况，Goravel 支持使用 Docker 进行测试，不同包之间可以独立使用由 Docker 创建的数据库镜像。</p><blockquote><p>由于 Docker 镜像对 windows 系统的支持有限，目前 Docker 测试仅支持在非 windows 环境下运行。</p></blockquote><h4 id="初始化镜像" tabindex="-1"><a class="header-anchor" href="#初始化镜像"><span>初始化镜像</span></a></h4><p>您可以使用 <code>Database</code> 方法根据默认数据库连接初始化数据库镜像，也可以向该方法传入数据库连接名称，初始化其他数据库镜像：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>database<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
database<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token string">&quot;postgresql&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>默认支持的数据库镜像：</p>`,8),y=n("thead",null,[n("tr",null,[n("th",null,"数据库"),n("th",null,"镜像地址"),n("th",null,"版本")])],-1),w=n("td",null,"Mysql",-1),D={href:"https://hub.docker.com/_/mysql",target:"_blank",rel:"noopener noreferrer"},E=n("td",null,"latest",-1),G=n("td",null,"Postgres",-1),C={href:"https://hub.docker.com/_/postgres",target:"_blank",rel:"noopener noreferrer"},R=n("td",null,"latest",-1),P=n("td",null,"Sqlserver",-1),M={href:"https://hub.docker.com/_/microsoft-mssql-server",target:"_blank",rel:"noopener noreferrer"},z=n("td",null,"latest",-1),I=n("td",null,"Sqlite",-1),B={href:"https://hub.docker.com/r/nouchka/sqlite3",target:"_blank",rel:"noopener noreferrer"},N=n("td",null,"latest",-1),A=p(`<p>也可以使用 <code>Image</code> 方法自定义镜像：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> contractstesting <span class="token string">&quot;github.com/goravel/framework/contracts/testing&quot;</span>

database<span class="token punctuation">.</span><span class="token function">Image</span><span class="token punctuation">(</span>contractstesting<span class="token punctuation">.</span>Image<span class="token punctuation">{</span>
  Repository<span class="token punctuation">:</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span>
  Tag<span class="token punctuation">:</span>        <span class="token string">&quot;5.7&quot;</span><span class="token punctuation">,</span>
  Env<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
    <span class="token string">&quot;MYSQL_ROOT_PASSWORD=123123&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;MYSQL_DATABASE=goravel&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ExposedPorts<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;3306&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="构建镜像" tabindex="-1"><a class="header-anchor" href="#构建镜像"><span>构建镜像</span></a></h4><p>镜像初始化完毕后，您可以使用 <code>Build</code> 方法构建镜像：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这时使用 <code>docker ps</code> 命令可以看到镜像已运行在系统中，通过 <code>Config</code> 方法可以获取链接数据库的配置信息，方便连接调试：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>config <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="运行填充" tabindex="-1"><a class="header-anchor" href="#运行填充"><span>运行填充</span></a></h4>`,8),L=n("code",null,"Seed",-1),O=n("code",null,"Seed",-1),U=n("code",null,"DatabaseSeeder",-1),H=n("code",null,"Seed",-1),V=p(`<div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>seeders<span class="token punctuation">.</span>UserSeeder<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>seeders<span class="token punctuation">.</span>PhotoSeeder<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重置数据库" tabindex="-1"><a class="header-anchor" href="#重置数据库"><span>重置数据库</span></a></h4><p>由于子包内测试用例是串行执行的，所以在单个测试用例运行后刷新数据库将不会产生负面影响，可以使用 <code>Fresh</code> 方法：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Fresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>也可以使用 <code>RefreshDatabase</code> 方法执行该操作：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> feature

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;testing&quot;</span>

	<span class="token string">&quot;github.com/stretchr/testify/suite&quot;</span>

	<span class="token string">&quot;goravel/tests&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> ExampleTestSuite <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	suite<span class="token punctuation">.</span>Suite
	tests<span class="token punctuation">.</span>TestCase
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestExampleTestSuite</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	suite<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span>ExampleTestSuite<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// SetupTest will run before each test in the suite.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">SetupTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  s<span class="token punctuation">.</span><span class="token function">RefreshDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// TearDownTest will run after each test in the suite.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TearDownTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TestIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="卸载镜像" tabindex="-1"><a class="header-anchor" href="#卸载镜像"><span>卸载镜像</span></a></h4><p>子包内测试用例执行完毕后，镜像将在一小时后自动卸载，您也可以使用 <code>Stop</code> 方法手动卸载镜像。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例</span></a></h4><p>我们可以在子包中创建 <code>TestMain</code> 函数，添加测试用例的前置逻辑：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// tests/feature/main_test.go</span>
<span class="token keyword">package</span> feature

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;os&quot;</span>
  <span class="token string">&quot;testing&quot;</span>

  <span class="token string">&quot;github.com/goravel/framework/facades&quot;</span>

  <span class="token string">&quot;goravel/database/seeders&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">TestMain</span><span class="token punctuation">(</span>m <span class="token operator">*</span>testing<span class="token punctuation">.</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  database<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 执行测试用例</span>
  exit <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 所有测试用例运行完毕后卸载镜像</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>exit<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,12),F={href:"https://pkg.go.dev/testing#hdr-Main",target:"_blank",rel:"noopener noreferrer"};function Q(Y,j){const t=i("router-link"),o=i("ExternalLinkIcon"),c=i("RouteLink");return u(),d("div",null,[k,n("nav",v,[n("ul",null,[n("li",null,[a(t,{to:"#介绍"},{default:e(()=>[s("介绍")]),_:1})]),n("li",null,[a(t,{to:"#环境"},{default:e(()=>[s("环境")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#自定义环境配置文件"},{default:e(()=>[s("自定义环境配置文件")]),_:1})]),n("li",null,[a(t,{to:"#testcase-struct"},{default:e(()=>[s("TestCase Struct")]),_:1})])])]),n("li",null,[a(t,{to:"#创建测试"},{default:e(()=>[s("创建测试")]),_:1})]),n("li",null,[a(t,{to:"#http-测试"},{default:e(()=>[s("HTTP 测试")]),_:1})]),n("li",null,[a(t,{to:"#数据库测试"},{default:e(()=>[s("数据库测试")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#模型工厂"},{default:e(()=>[s("模型工厂")]),_:1})]),n("li",null,[a(t,{to:"#运行-seeders"},{default:e(()=>[s("运行 seeders")]),_:1})]),n("li",null,[a(t,{to:"#使用-docker"},{default:e(()=>[s("使用 Docker")]),_:1})])])])])]),m,n("p",null,[s("默认我们使用 "),n("a",b,[s("stretchr/testify"),a(o)]),s(" 包的 "),h,s(" 功能编写我们的测试，该功能支持配置测试前、测试后、子测试、断言等，可以使我们的测试用例更加有条理，具体使用请详见官方文档。")]),g,n("p",null,[s("当我们测试的时候，可能需要在执行测试之前向数据库插入一些数据。Goravel 允许你使用 "),a(c,{to:"/zh/orm/factories.html"},{default:e(()=>[s("模型工厂")]),_:1}),s(" 为每个模型定义一组默认值，而不是在创建测试数据时手动指定每一列的值。")]),f,n("p",null,[s("如果你在功能测试时希望使用 "),a(c,{to:"/zh/orm/seeding.html"},{default:e(()=>[s("数据库 seeders")]),_:1}),s(" 来填充你的数据库，你可以调用 "),_,s(" 方法。默认情况下，"),T,s(" 方法将会执行 "),x,s("，它将会执行你的所有其他 seeders。或者，你可以传递指定的 seeder 给 "),S,s(" 方法：")]),q,n("table",null,[y,n("tbody",null,[n("tr",null,[w,n("td",null,[n("a",D,[s("https://hub.docker.com/_/mysql"),a(o)])]),E]),n("tr",null,[G,n("td",null,[n("a",C,[s("https://hub.docker.com/_/postgres"),a(o)])]),R]),n("tr",null,[P,n("td",null,[n("a",M,[s("https://hub.docker.com/_/microsoft-mssql-server"),a(o)])]),z]),n("tr",null,[I,n("td",null,[n("a",B,[s("https://hub.docker.com/r/nouchka/sqlite3"),a(o)])]),N])])]),A,n("p",null,[s("如果您在测试时希望使用 "),a(c,{to:"/zh/orm/seeding.html"},{default:e(()=>[s("数据填充")]),_:1}),s(" 来填充数据库，可以调用 "),L,s(" 方法。 默认情况下，"),O,s(" 方法将会执行 "),U,s("，它应该执行您的所有其他种子器。或者，您可以传递指定的种子器类名给 "),H,s(" 方法：")]),V,n("blockquote",null,[n("p",null,[s("关于 TestMain 方法的更多使用，参见"),n("a",F,[s("官方文档"),a(o)]),s("。")])])])}const W=l(r,[["render",Q],["__file","getting-started.html.vue"]]),K=JSON.parse('{"path":"/zh/testing/getting-started.html","title":"快速入门","lang":"zh-CN","frontmatter":{"description":"快速入门 介绍 Goravel 的测试功能依托于 Golang 自带的 test 官方组件，是对单元测试的扩展，使 Goravel 应用程序支持集成测试，让应用变得更加健壮。 环境 自定义环境配置文件 测试时默认使用根目录下的 .env 文件注入配置信息，如果想为不同的包使用不同的 .env 文件，可以在包目录下创建 .env 文件，测试时会优先读取该...","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://goravel.dev/testing/getting-started.html"}],["meta",{"property":"og:url","content":"https://goravel.dev/zh/testing/getting-started.html"}],["meta",{"property":"og:site_name","content":"Goravel"}],["meta",{"property":"og:title","content":"/testing/getting-started.html"}],["meta",{"property":"og:description","content":"快速入门 介绍 Goravel 的测试功能依托于 Golang 自带的 test 官方组件，是对单元测试的扩展，使 Goravel 应用程序支持集成测试，让应用变得更加健壮。 环境 自定义环境配置文件 测试时默认使用根目录下的 .env 文件注入配置信息，如果想为不同的包使用不同的 .env 文件，可以在包目录下创建 .env 文件，测试时会优先读取该..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"快速入门\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"介绍","slug":"介绍","link":"#介绍","children":[]},{"level":2,"title":"环境","slug":"环境","link":"#环境","children":[{"level":3,"title":"自定义环境配置文件","slug":"自定义环境配置文件","link":"#自定义环境配置文件","children":[]},{"level":3,"title":"TestCase Struct","slug":"testcase-struct","link":"#testcase-struct","children":[]}]},{"level":2,"title":"创建测试","slug":"创建测试","link":"#创建测试","children":[]},{"level":2,"title":"HTTP 测试","slug":"http-测试","link":"#http-测试","children":[]},{"level":2,"title":"数据库测试","slug":"数据库测试","link":"#数据库测试","children":[{"level":3,"title":"模型工厂","slug":"模型工厂","link":"#模型工厂","children":[]},{"level":3,"title":"运行 seeders","slug":"运行-seeders","link":"#运行-seeders","children":[]},{"level":3,"title":"使用 Docker","slug":"使用-docker","link":"#使用-docker","children":[]}]}],"git":{},"filePathRelative":"zh/testing/getting-started.md","autoDesc":true}');export{W as comp,K as data};
