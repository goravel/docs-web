import{_ as c,c as u,b as s,e,f as t,a as l,d as a,r as o,o as r}from"./app-DmrjGHX8.js";const d={},k={class:"table-of-contents"};function v(m,n){const p=o("router-link"),i=o("RouteLink");return r(),u("div",null,[n[34]||(n[34]=s("h1",{id:"快速入门",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#快速入门"},[s("span",null,"快速入门")])],-1)),s("nav",k,[s("ul",null,[s("li",null,[e(p,{to:"#介绍"},{default:t(()=>n[0]||(n[0]=[a("介绍")])),_:1})]),s("li",null,[e(p,{to:"#环境"},{default:t(()=>n[1]||(n[1]=[a("环境")])),_:1}),s("ul",null,[s("li",null,[e(p,{to:"#自定义环境配置文件"},{default:t(()=>n[2]||(n[2]=[a("自定义环境配置文件")])),_:1})]),s("li",null,[e(p,{to:"#testcase-struct"},{default:t(()=>n[3]||(n[3]=[a("TestCase Struct")])),_:1})])])]),s("li",null,[e(p,{to:"#创建测试"},{default:t(()=>n[4]||(n[4]=[a("创建测试")])),_:1})]),s("li",null,[e(p,{to:"#数据库测试"},{default:t(()=>n[5]||(n[5]=[a("数据库测试")])),_:1}),s("ul",null,[s("li",null,[e(p,{to:"#模型工厂"},{default:t(()=>n[6]||(n[6]=[a("模型工厂")])),_:1})]),s("li",null,[e(p,{to:"#运行-seeders"},{default:t(()=>n[7]||(n[7]=[a("运行 seeders")])),_:1})]),s("li",null,[e(p,{to:"#使用-docker"},{default:t(()=>n[8]||(n[8]=[a("使用 Docker")])),_:1})])])])])]),n[35]||(n[35]=l(`<h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍"><span>介绍</span></a></h2><p>Goravel 的测试功能依托于 Golang 自带的 test 官方组件，是对单元测试的扩展，使 Goravel 应用程序支持集成测试，让应用变得更加健壮。</p><h2 id="环境" tabindex="-1"><a class="header-anchor" href="#环境"><span>环境</span></a></h2><h3 id="自定义环境配置文件" tabindex="-1"><a class="header-anchor" href="#自定义环境配置文件"><span>自定义环境配置文件</span></a></h3><p>测试时默认使用根目录下的 <code>.env</code> 文件注入配置信息，如果想为不同的包使用不同的 <code>.env</code> 文件，可以在包目录下创建 <code>.env</code> 文件，测试时会优先读取该文件。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">- /app</span>
<span class="line">- /config</span>
<span class="line">- ...</span>
<span class="line">- /test</span>
<span class="line">  - /feature</span>
<span class="line">    - .env</span>
<span class="line">    - user_test.go</span>
<span class="line">- .env</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>您也可以在运行 <code>go test</code> 时使用 <code>--env=.env.testing</code> 选项自定义配置文件，但需注意，此选项需跟在测试目录后面，例如：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">go <span class="token builtin class-name">test</span> ./<span class="token punctuation">..</span>. <span class="token parameter variable">--env</span><span class="token operator">=</span>.env.testing</span>
<span class="line">go <span class="token builtin class-name">test</span> ./<span class="token punctuation">..</span>. <span class="token parameter variable">-e</span><span class="token operator">=</span>.env.testing</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="testcase-struct" tabindex="-1"><a class="header-anchor" href="#testcase-struct"><span><code>TestCase</code> Struct</span></a></h3><p>Goravel 包含一个 <code>TestCase</code> Struct，在未来该 Struct 将提供一些便捷测试方法，此外同一个文件中还存在一个 <code>init</code> 方法，该方法在运行测试之前引导注册 Goravel 应用程序，如果需要您可以在此方法中添加在运行测试前需要前置运行的逻辑。</p><h2 id="创建测试" tabindex="-1"><a class="header-anchor" href="#创建测试"><span>创建测试</span></a></h2><p>要创建新的测试用例，可以使用 Artisan 命令：<code>make:test</code>：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">go run <span class="token builtin class-name">.</span> artisan make:test feature/UserTest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>默认我们使用 <a href="https://github.com/stretchr/testify" target="_blank" rel="noopener noreferrer">stretchr/testify</a> 包的 <code>suit</code> 功能编写我们的测试，该功能支持配置测试前、测试后、子测试、断言等，可以使我们的测试用例更加有条理，具体使用请详见官方文档。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">package</span> feature</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line">  <span class="token string">&quot;github.com/stretchr/testify/suite&quot;</span></span>
<span class="line"></span>
<span class="line">  <span class="token string">&quot;goravel/tests&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> ExampleTestSuite <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  suite<span class="token punctuation">.</span>Suite</span>
<span class="line">  tests<span class="token punctuation">.</span>TestCase</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">TestExampleTestSuite</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  suite<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span>ExampleTestSuite<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// SetupTest will run before each test in the suite.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">SetupTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// TearDownTest will run after each test in the suite.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TearDownTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TestIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  s<span class="token punctuation">.</span><span class="token function">True</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="数据库测试" tabindex="-1"><a class="header-anchor" href="#数据库测试"><span>数据库测试</span></a></h2><p>Goravel 模型工厂和 Seeders 可以轻松地为应用程序的模型创建测试数据库记录。</p><h3 id="模型工厂" tabindex="-1"><a class="header-anchor" href="#模型工厂"><span>模型工厂</span></a></h3>`,18)),s("p",null,[n[10]||(n[10]=a("当我们测试的时候，可能需要在执行测试之前向数据库插入一些数据。Goravel 允许你使用 ")),e(i,{to:"/zh/orm/factories.html"},{default:t(()=>n[9]||(n[9]=[a("模型工厂")])),_:1}),n[11]||(n[11]=a(" 为每个模型定义一组默认值，而不是在创建测试数据时手动指定每一列的值。"))]),n[36]||(n[36]=l(`<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">var</span> user models<span class="token punctuation">.</span>User</span>
<span class="line">err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="运行-seeders" tabindex="-1"><a class="header-anchor" href="#运行-seeders"><span>运行 seeders</span></a></h3>`,2)),s("p",null,[n[13]||(n[13]=a("如果你在功能测试时希望使用 ")),e(i,{to:"/zh/database/seeding.html"},{default:t(()=>n[12]||(n[12]=[a("数据库 seeders")])),_:1}),n[14]||(n[14]=a(" 来填充你的数据库，你可以调用 ")),n[15]||(n[15]=s("code",null,"Seed",-1)),n[16]||(n[16]=a(" 方法。默认情况下，")),n[17]||(n[17]=s("code",null,"Seed",-1)),n[18]||(n[18]=a(" 方法将会执行 ")),n[19]||(n[19]=s("code",null,"DatabaseSeeder",-1)),n[20]||(n[20]=a("，它将会执行你的所有其他 seeders。或者，你可以传递指定的 seeder 给 ")),n[21]||(n[21]=s("code",null,"Seed",-1)),n[22]||(n[22]=a(" 方法："))]),n[37]||(n[37]=l(`<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">package</span> feature</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line">	<span class="token string">&quot;github.com/stretchr/testify/suite&quot;</span></span>
<span class="line"></span>
<span class="line">	<span class="token string">&quot;goravel/database/seeders&quot;</span></span>
<span class="line">	<span class="token string">&quot;goravel/tests&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> ExampleTestSuite <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	suite<span class="token punctuation">.</span>Suite</span>
<span class="line">	tests<span class="token punctuation">.</span>TestCase</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">TestExampleTestSuite</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	suite<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span>ExampleTestSuite<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// SetupTest will run before each test in the suite.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">SetupTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// TearDownTest will run after each test in the suite.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TearDownTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TestIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// Run the DatabaseSeeder...</span></span>
<span class="line">	s<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Run multiple specific seeders...</span></span>
<span class="line">	s<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>seeders<span class="token punctuation">.</span>UserSeeder<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>seeders<span class="token punctuation">.</span>PhotoSeeder<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用-docker" tabindex="-1"><a class="header-anchor" href="#使用-docker"><span>使用 Docker</span></a></h3><p>由于 <code>go test</code> 在不同包之间是并行测试，因此当使用本地数据库或缓存进行测试时，不能在测试用例中执行重置数据库或缓存操作，否则将有可能对并行运行的其他测试用例产生影响。针对这种情况，Goravel 支持使用 Docker 进行测试，不同包之间可以独立使用由 Docker 创建的镜像。</p><blockquote><p>由于 Docker 镜像对 windows 系统的支持有限，目前 Docker 测试仅支持在非 windows 环境下运行。</p></blockquote><h4 id="初始化镜像" tabindex="-1"><a class="header-anchor" href="#初始化镜像"><span>初始化镜像</span></a></h4><p>你可以使用 <code>Database</code> 或 <code>Cache</code> 方法创建镜像，也可以向该方法传入连接名称：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">database<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">database<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token string">&quot;postgres&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">cache<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">cache<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Cache</span><span class="token punctuation">(</span><span class="token string">&quot;redis&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以使用 <code>Image</code> 方法自定义镜像：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">import</span> contractstesting <span class="token string">&quot;github.com/goravel/framework/contracts/testing&quot;</span></span>
<span class="line"></span>
<span class="line">image<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Image</span><span class="token punctuation">(</span>contractstesting<span class="token punctuation">.</span>Image<span class="token punctuation">{</span></span>
<span class="line">  Repository<span class="token punctuation">:</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  Tag<span class="token punctuation">:</span>        <span class="token string">&quot;5.7&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  Env<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;MYSQL_ROOT_PASSWORD=123123&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;MYSQL_DATABASE=goravel&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  ExposedPorts<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;3306&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="构建镜像" tabindex="-1"><a class="header-anchor" href="#构建镜像"><span>构建镜像</span></a></h4><p>镜像初始化完毕后，您可以使用 <code>Build</code> 方法构建镜像：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">err <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这时使用 <code>docker ps</code> 命令可以看到镜像已运行在系统中，通过 <code>Config</code> 方法可以获取链接数据库的配置信息，方便连接调试：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">config <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">config <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="运行填充" tabindex="-1"><a class="header-anchor" href="#运行填充"><span>运行填充</span></a></h4>`,15)),s("p",null,[n[24]||(n[24]=a("如果您在测试时希望使用 ")),e(i,{to:"/zh/database/seeding.html"},{default:t(()=>n[23]||(n[23]=[a("数据填充")])),_:1}),n[25]||(n[25]=a(" 来填充数据库，可以调用 ")),n[26]||(n[26]=s("code",null,"Seed",-1)),n[27]||(n[27]=a(" 方法。 默认情况下，")),n[28]||(n[28]=s("code",null,"Seed",-1)),n[29]||(n[29]=a(" 方法将会执行 ")),n[30]||(n[30]=s("code",null,"DatabaseSeeder",-1)),n[31]||(n[31]=a("，它应该执行您的所有其他种子器。或者，您可以传递指定的种子器类名给 ")),n[32]||(n[32]=s("code",null,"Seed",-1)),n[33]||(n[33]=a(" 方法："))]),n[38]||(n[38]=l(`<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>seeders<span class="token punctuation">.</span>UserSeeder<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>seeders<span class="token punctuation">.</span>PhotoSeeder<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重置数据库或缓存" tabindex="-1"><a class="header-anchor" href="#重置数据库或缓存"><span>重置数据库或缓存</span></a></h4><p>由于子包内测试用例是串行执行的，所以在单个测试用例运行后刷新数据库或缓存将不会产生负面影响，可以使用 <code>Fresh</code> 方法：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Fresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">err <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">Fresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>对于数据库，也可以使用 <code>RefreshDatabase</code> 方法执行该操作：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">package</span> feature</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line">	<span class="token string">&quot;github.com/stretchr/testify/suite&quot;</span></span>
<span class="line"></span>
<span class="line">	<span class="token string">&quot;goravel/tests&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> ExampleTestSuite <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	suite<span class="token punctuation">.</span>Suite</span>
<span class="line">	tests<span class="token punctuation">.</span>TestCase</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">TestExampleTestSuite</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	suite<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span>ExampleTestSuite<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// SetupTest will run before each test in the suite.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">SetupTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  s<span class="token punctuation">.</span><span class="token function">RefreshDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// TearDownTest will run after each test in the suite.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TearDownTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>ExampleTestSuite<span class="token punctuation">)</span> <span class="token function">TestIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="卸载镜像" tabindex="-1"><a class="header-anchor" href="#卸载镜像"><span>卸载镜像</span></a></h4><p>子包内测试用例执行完毕后，镜像将在一小时后自动卸载，您也可以使用 <code>Shutdown</code> 方法手动卸载镜像。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">err <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">Shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例</span></a></h4><p>我们可以在子包中创建 <code>TestMain</code> 函数，添加测试用例的前置逻辑：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// tests/feature/main_test.go</span></span>
<span class="line"><span class="token keyword">package</span> feature</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;fmt&quot;</span></span>
<span class="line">  <span class="token string">&quot;os&quot;</span></span>
<span class="line">  <span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line">  <span class="token string">&quot;github.com/goravel/framework/facades&quot;</span></span>
<span class="line"></span>
<span class="line">  <span class="token string">&quot;goravel/database/seeders&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">TestMain</span><span class="token punctuation">(</span>m <span class="token operator">*</span>testing<span class="token punctuation">.</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  database<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Migrate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 执行测试用例</span></span>
<span class="line">  exit <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 所有测试用例运行完毕后卸载镜像</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>exit<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>关于 TestMain 方法的更多使用，参见<a href="https://pkg.go.dev/testing#hdr-Main" target="_blank" rel="noopener noreferrer">官方文档</a>。</p></blockquote>`,13))])}const g=c(d,[["render",v],["__file","getting-started.html.vue"]]),f=JSON.parse('{"path":"/zh/testing/getting-started.html","title":"快速入门","lang":"zh-CN","frontmatter":{"description":"快速入门 介绍 Goravel 的测试功能依托于 Golang 自带的 test 官方组件，是对单元测试的扩展，使 Goravel 应用程序支持集成测试，让应用变得更加健壮。 环境 自定义环境配置文件 测试时默认使用根目录下的 .env 文件注入配置信息，如果想为不同的包使用不同的 .env 文件，可以在包目录下创建 .env 文件，测试时会优先读取该...","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://goravel.dev/testing/getting-started.html"}],["meta",{"property":"og:url","content":"https://goravel.dev/zh/testing/getting-started.html"}],["meta",{"property":"og:site_name","content":"Goravel"}],["meta",{"property":"og:title","content":"/testing/getting-started.html"}],["meta",{"property":"og:description","content":"快速入门 介绍 Goravel 的测试功能依托于 Golang 自带的 test 官方组件，是对单元测试的扩展，使 Goravel 应用程序支持集成测试，让应用变得更加健壮。 环境 自定义环境配置文件 测试时默认使用根目录下的 .env 文件注入配置信息，如果想为不同的包使用不同的 .env 文件，可以在包目录下创建 .env 文件，测试时会优先读取该..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"快速入门\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"介绍","slug":"介绍","link":"#介绍","children":[]},{"level":2,"title":"环境","slug":"环境","link":"#环境","children":[{"level":3,"title":"自定义环境配置文件","slug":"自定义环境配置文件","link":"#自定义环境配置文件","children":[]},{"level":3,"title":"TestCase Struct","slug":"testcase-struct","link":"#testcase-struct","children":[]}]},{"level":2,"title":"创建测试","slug":"创建测试","link":"#创建测试","children":[]},{"level":2,"title":"数据库测试","slug":"数据库测试","link":"#数据库测试","children":[{"level":3,"title":"模型工厂","slug":"模型工厂","link":"#模型工厂","children":[]},{"level":3,"title":"运行 seeders","slug":"运行-seeders","link":"#运行-seeders","children":[]},{"level":3,"title":"使用 Docker","slug":"使用-docker","link":"#使用-docker","children":[]}]}],"git":{},"filePathRelative":"zh/testing/getting-started.md","autoDesc":true}');export{g as comp,f as data};
