import{_ as c,c as r,a as o,b as a,e,f as p,d as s,r as l,o as u}from"./app-Bxqd4Y6U.js";const d={};function k(v,n){const t=l("RouteLink"),i=l("CommentService");return u(),r("div",null,[n[13]||(n[13]=o(`<h1 id="从-v1-14-升级到-v1-15" tabindex="-1"><a class="header-anchor" href="#从-v1-14-升级到-v1-15"><span>从 v1.14 升级到 v1.15</span></a></h1><h3 id="令人兴奋的新功能-🎉" tabindex="-1"><a class="header-anchor" href="#令人兴奋的新功能-🎉"><span>令人兴奋的新功能 🎉</span></a></h3><ul><li><a href="#migration-%E6%94%AF%E6%8C%81%E4%BD%BF%E7%94%A8-go-%E8%AF%AD%E8%A8%80%E8%BF%81%E7%A7%BB">Migration 支持使用 Go 语言迁移</a></li><li><a href="#testing-%E6%94%AF%E6%8C%81-http-%E6%B5%8B%E8%AF%95">Testing 支持 HTTP 测试</a></li></ul><h3 id="功能增强-🚀" tabindex="-1"><a class="header-anchor" href="#功能增强-🚀"><span>功能增强 🚀</span></a></h3><ul><li><a href="#http-%E6%94%AF%E6%8C%81%E8%BF%94%E5%9B%9E-stream">HTTP 支持返回 Stream</a></li><li><a href="#http-%E6%94%AF%E6%8C%81%E8%AE%BE%E7%BD%AE%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4">HTTP 支持设置超时时间</a></li><li><a href="#http-%E6%94%AF%E6%8C%81%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89-recovery-%E6%96%B9%E6%B3%95">HTTP 支持设置自定义 recovery 方法</a></li><li><a href="#http-response-%E6%94%AF%E6%8C%81-abort">HTTP Response 支持 Abort</a></li><li><a href="#request-%E6%94%AF%E6%8C%81%E8%AE%BE%E7%BD%AE-filter">Request 支持设置 Filter</a></li><li><a href="#request-%E5%A2%9E%E5%8A%A0-bindquery-%E6%96%B9%E6%B3%95">Request 增加 BindQuery 方法</a></li><li><a href="#validation-%E6%94%AF%E6%8C%81-regex-%E8%A7%84%E5%88%99">Validation 支持 Regex 规则</a></li><li><a href="#schedule-%E6%94%AF%E6%8C%81%E6%8E%A7%E5%88%B6%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA">Schedule 支持控制日志输出</a></li><li><a href="#schedule-%E6%96%B0%E5%A2%9E-shutdown-%E6%96%B9%E6%B3%95">Schedule 新增 Shutdown 方法</a></li><li><a href="#mail-%E6%94%AF%E6%8C%81-mailable-%E6%A8%A1%E7%89%88">Mail 支持 Mailable 模版</a></li><li><a href="#log-%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA%E7%9A%84-trace-%E6%94%AF%E6%8C%81%E7%82%B9%E5%87%BB%E8%B7%B3%E8%BD%AC">Log 错误日志输出的 trace 支持点击跳转</a></li><li><a href="#log-%E6%94%AF%E6%8C%81%E6%89%93%E5%8D%B0-context-%E4%B8%AD%E7%9A%84%E9%94%AE%E5%80%BC">Log 支持打印 Context 中的键值</a></li><li><a href="#%E6%94%AF%E6%8C%81%E7%9B%B4%E6%8E%A5%E8%AE%BE%E7%BD%AE-dsn-%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93">支持直接设置 DSN 连接数据库</a></li><li><a href="#orm-%E7%9A%84-create-%E6%96%B9%E6%B3%95%E6%94%AF%E6%8C%81%E4%BD%BF%E7%94%A8-map-%E5%88%9B%E5%BB%BA">Orm 的 Create 方法支持使用 map 创建</a></li><li><a href="#orm-%E6%96%B0%E5%A2%9E%E9%85%8D%E7%BD%AE%E9%A1%B9">Orm 新增配置项</a></li><li><a href="#orm-%E6%96%B0%E5%A2%9E-restore-%E6%96%B9%E6%B3%95">Orm 新增 Restore 方法</a></li><li><a href="#orm-%E6%97%A5%E5%BF%97%E9%9B%86%E6%88%90-log-%E6%A8%A1%E5%9D%97">Orm 日志集成 Log 模块</a></li><li><a href="#postgres-%E5%92%8C-sqlserver-%E9%A9%B1%E5%8A%A8%E6%94%AF%E6%8C%81-schema">Postgres 和 Sqlserver 驱动支持 Schema</a></li><li><a href="#%E6%96%B0%E5%A2%9E-about-%E5%91%BD%E4%BB%A4">新增 about 命令</a></li><li><a href="#%E6%96%B0%E5%A2%9E-db-show-%E5%91%BD%E4%BB%A4">新增 db:show 命令</a></li><li><a href="#%E6%96%B0%E5%A2%9E-db-table-%E5%91%BD%E4%BB%A4">新增 db:table 命令</a></li><li><a href="#%E4%BC%98%E5%8C%96-artisan-%E8%BE%93%E5%87%BA%E6%A0%B7%E5%BC%8F">优化 Artisan 输出样式</a></li><li><a href="#auth-%E6%96%B0%E5%A2%9E-id-%E6%96%B9%E6%B3%95">Auth 新增 ID 方法</a></li><li><a href="#%E5%A4%9A%E4%B8%AA-auth-guard-%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%B7%B1%E7%9A%84-ttl">多个 Auth.Guard 可以设置自己的 TTL</a></li></ul><h3 id="破坏性变化-🛠" tabindex="-1"><a class="header-anchor" href="#破坏性变化-🛠"><span>破坏性变化 🛠</span></a></h3><ul><li><a href="#postgresql-%E9%A9%B1%E5%8A%A8%E5%90%8D%E7%A7%B0%E6%9B%B4%E6%94%B9%E4%B8%BA-postgres">Postgresql 驱动名称更改为 Postgres</a></li><li><a href="#%E4%BF%AE%E6%94%B9-orm-transaction-%E6%96%B9%E6%B3%95%E5%9B%9E%E8%B0%83%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B">修改 Orm.Transaction 方法回调参数类型</a></li><li><a href="#%E4%BC%98%E5%8C%96-orm-%E7%9A%84-delete-%E4%B8%8E-forcedelete-%E6%96%B9%E6%B3%95">优化 Orm 的 Delete 与 ForceDelete 方法</a></li><li><a href="#%E4%BC%98%E5%8C%96-cache-%E7%9A%84-decrement-%E4%B8%8E-increment-%E6%96%B9%E6%B3%95">优化 Cache 的 Decrement 与 Increment 方法</a></li><li><a href="#%E4%BC%98%E5%8C%96-artisan-%E7%9A%84-call-%E6%96%B9%E6%B3%95">优化 Artisan 的 Call 方法</a></li><li><a href="#testing-database-%E7%9A%84-clear-%E6%96%B9%E6%B3%95%E9%87%8D%E5%91%BD%E5%90%8D%E4%B8%BA-shutdown">Testing.Database 的 Clear 方法重命名为 Shutdown</a></li><li><a href="#%E4%BC%98%E5%8C%96-testing-database-%E7%9A%84-build-%E6%96%B9%E6%B3%95">优化 Testing.Database 的 Build 方法</a></li><li><a href="#%E4%BC%98%E5%8C%96-request-input-%E6%96%B9%E6%B3%95">优化 Request.Input* 方法</a></li><li><a href="#%E4%BC%98%E5%8C%96-validation-prepareforvalidation-%E6%96%B9%E6%B3%95">优化 validation.PrepareForValidation 方法</a></li><li><a href="#%E4%BC%98%E5%8C%96-queue-%E6%A8%A1%E5%9D%97%E7%9A%84-worker-%E6%96%B9%E6%B3%95">优化 Queue 模块的 Worker 方法</a></li></ul><h3 id="v1-15-3" tabindex="-1"><a class="header-anchor" href="#v1-15-3"><span>v1.15.3</span></a></h3><ul><li><a href="#go-%E8%BF%81%E7%A7%BB%E6%94%AF%E6%8C%81-boolean-%E5%AD%97%E6%AE%B5">Go 迁移支持 Boolean 字段</a></li><li><a href="#go-%E8%BF%81%E7%A7%BB%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E6%AE%B5">Go 迁移支持自定义字段</a></li><li><a href="#%E4%BC%98%E5%8C%96-artisan-log-%E8%BE%93%E5%87%BA%E8%A7%84%E5%88%99">优化 Artisan log 输出规则</a></li></ul><h3 id="v1-15-4" tabindex="-1"><a class="header-anchor" href="#v1-15-4"><span>v1.15.4</span></a></h3><p>同时升级：goravel/gin: v1.3.3, goravel/fiber: v1.3.3</p><ul><li><a href="#%E4%BF%AE%E5%A4%8D-prepareforvalidation-%E4%B8%AD-ctx-%E4%B8%BA-nil-%E7%9A%84%E9%97%AE%E9%A2%98">修复 PrepareForValidation 中 ctx 为 nil 的问题</a></li><li><a href="#%E4%BF%AE%E5%A4%8D-fiber-%E9%A9%B1%E5%8A%A8%E9%AB%98%E5%B9%B6%E5%8F%91%E4%B8%8B-orm-withcontext-%E6%96%B9%E6%B3%95%E6%8A%A5%E9%94%99%E7%9A%84%E9%97%AE%E9%A2%98">修复 Fiber 驱动高并发下 Orm WithContext 方法报错的问题</a></li><li><a href="#%E4%BC%98%E5%8C%96%E6%89%93%E5%8C%85%E4%BD%93%E7%A7%AF">优化打包体积</a></li><li><a href="#%E4%BC%98%E5%8C%96-model-id-%E5%A4%9A%E9%87%8D%E5%B5%8C%E5%A5%97%E6%97%B6%E7%9A%84%E9%97%AE%E9%A2%98">优化 model ID 多重嵌套时的问题</a></li><li><a href="#%E6%B7%BB%E5%8A%A0-artisan-%E5%91%BD%E4%BB%A4%E5%88%AB%E5%90%8D">添加 artisan 命令别名</a></li></ul><h3 id="v1-15-5" tabindex="-1"><a class="header-anchor" href="#v1-15-5"><span>v1.15.5</span></a></h3><p>同时升级：goravel/redis: v1.3.1, goravel/fiber: v1.3.4</p><ul><li><a href="#%E4%BF%AE%E5%A4%8D%E4%BD%BF%E7%94%A8-redis-%E9%A9%B1%E5%8A%A8%E6%97%B6-throttle-%E6%97%A0%E6%95%88%E7%9A%84%E9%97%AE%E9%A2%98">修复使用 Redis 驱动时 Throttle 无效的问题</a></li><li><a href="#%E4%BF%AE%E5%A4%8D%E4%BD%BF%E7%94%A8-fiber-%E9%A9%B1%E5%8A%A8%E6%97%B6-fallback-%E5%BC%82%E5%B8%B8%E7%9A%84%E9%97%AE%E9%A2%98">修复使用 Fiber 驱动时 Fallback 异常的问题</a></li></ul><h3 id="v1-15-6" tabindex="-1"><a class="header-anchor" href="#v1-15-6"><span>v1.15.6</span></a></h3><ul><li><a href="#%E4%BF%AE%E5%A4%8D-orm-withcontext-%E6%96%B9%E6%B3%95%E5%9C%A8%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%BC%82%E5%B8%B8%E7%9A%84%E9%97%AE%E9%A2%98">修复 Orm WithContext 方法在并发下异常的问题</a></li></ul><h3 id="v1-15-7" tabindex="-1"><a class="header-anchor" href="#v1-15-7"><span>v1.15.7</span></a></h3><ul><li><a href="#%E5%8D%87%E7%BA%A7-carbon">升级 Carbon</a></li></ul><h3 id="v1-15-8" tabindex="-1"><a class="header-anchor" href="#v1-15-8"><span>v1.15.8</span></a></h3><p>同时升级：goravel/fiber: v1.3.6</p><ul><li><a href="#%E4%BF%AE%E5%A4%8D-facades-testing-docker-database-%E5%BC%82%E5%B8%B8%E7%9A%84%E9%97%AE%E9%A2%98">修复 facades.Testing().Docker().Database() 异常的问题</a></li><li><a href="#%E4%BF%AE%E5%A4%8D-fiber-%E9%A9%B1%E5%8A%A8-ctx-request-ip-%E8%8E%B7%E5%8F%96-ip-%E6%97%A0%E6%95%88%E7%9A%84%E9%97%AE%E9%A2%98">修复 fiber 驱动 ctx.Request().Ip() 获取 IP 无效的问题</a></li><li><a href="#orm-%E4%B8%AD-wherebetween-%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95%E4%B8%8D%E6%94%AF%E6%8C%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E9%97%AE%E9%A2%98">Orm 中 WhereBetween 相关方法不支持字符串的问题</a></li></ul><h3 id="v1-15-9" tabindex="-1"><a class="header-anchor" href="#v1-15-9"><span>v1.15.9</span></a></h3><ul><li><a href="#%E4%BF%AE%E5%A4%8D-orm-%E4%B8%AD-cursor-%E6%96%B9%E6%B3%95%E5%9C%A8%E6%9F%90%E4%BA%9B%E6%83%85%E5%86%B5%E4%B8%8B%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E7%9A%84%E9%97%AE%E9%A2%98">修复 Orm 中 Cursor 方法在某些情况下内存泄露的问题</a></li><li><a href="#%E4%BF%AE%E5%A4%8D-schedule-%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%A7%92%E7%BA%A7%E4%BB%BB%E5%8A%A1%E6%97%B6-ononeserver-%E5%BC%82%E5%B8%B8%E7%9A%84%E9%97%AE%E9%A2%98">修复 Schedule 中使用秒级任务时 OnOneServer 异常的问题</a></li><li><a href="#make-migration-%E5%91%BD%E4%BB%A4%E7%94%9F%E6%88%90%E7%9A%84%E8%BF%81%E7%A7%BB%E6%96%87%E4%BB%B6%E4%B8%AD%E9%BB%98%E8%AE%A4-timestamps-%E6%94%B9%E4%B8%BA-timestampstz">make:migration 命令生成的迁移文件中默认 Timestamps 改为 TimestampsTz</a></li></ul><h2 id="升级指南" tabindex="-1"><a class="header-anchor" href="#升级指南"><span>升级指南</span></a></h2><p><strong>预计升级时间：10 分钟</strong></p><p>随着 <a href="https://endoflife.date/go" target="_blank" rel="noopener noreferrer">Golang v1.21 不再被维护</a>，Goravel v1.15 默认支持 Golang 版本由 1.21 升级为 1.22，请在 go.mod 文件中更新版本。</p><h3 id="_1-更新依赖" tabindex="-1"><a class="header-anchor" href="#_1-更新依赖"><span>1. 更新依赖</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">go get github.com/goravel/framework@v1.15.9</span>
<span class="line"></span>
<span class="line">// 如果使用 gin</span>
<span class="line">go get github.com/goravel/gin@v1.3.3</span>
<span class="line"></span>
<span class="line">// 如果使用 fiber</span>
<span class="line">go get github.com/goravel/fiber@v1.3.6</span>
<span class="line"></span>
<span class="line">// 如果使用 redis</span>
<span class="line">go get github.com/goravel/redis@v1.3.1</span>
<span class="line"></span>
<span class="line">// 如果使用 S3</span>
<span class="line">go get github.com/goravel/s3@v1.3.2</span>
<span class="line"></span>
<span class="line">// 如果使用 Oss</span>
<span class="line">go get github.com/goravel/oss@v1.3.2</span>
<span class="line"></span>
<span class="line">// 如果使用 Cos</span>
<span class="line">go get github.com/goravel/cos@v1.3.2</span>
<span class="line"></span>
<span class="line">// 如果使用 Minio</span>
<span class="line">go get github.com/goravel/minio@v1.3.2</span>
<span class="line"></span>
<span class="line">// 如果使用 Cloudinary</span>
<span class="line">go get github.com/goravel/cloudinary@v1.3.1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">go mod tidy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-如果正在使用-postgres-数据库" tabindex="-1"><a class="header-anchor" href="#_2-如果正在使用-postgres-数据库"><span>2. 如果正在使用 Postgres 数据库</span></a></h3><p>需相应修改：<a href="#postgresql-%E9%A9%B1%E5%8A%A8%E5%90%8D%E7%A7%B0%E6%9B%B4%E6%94%B9%E4%B8%BA-postgres">Postgresql 驱动名称更改为 Postgres</a></p><h3 id="_3-如果正在使用-orm-transaction-方法" tabindex="-1"><a class="header-anchor" href="#_3-如果正在使用-orm-transaction-方法"><span>3. 如果正在使用 Orm.Transaction 方法</span></a></h3><p>需相应修改：<a href="#%E4%BF%AE%E6%94%B9-orm-transaction-%E6%96%B9%E6%B3%95%E5%9B%9E%E8%B0%83%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B">修改 Orm.Transaction 方法回调参数类型</a></p><h3 id="_4-如果正在使用-orm-的-delete-或-forcedelete-方法" tabindex="-1"><a class="header-anchor" href="#_4-如果正在使用-orm-的-delete-或-forcedelete-方法"><span>4. 如果正在使用 Orm 的 Delete 或 ForceDelete 方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-orm-%E7%9A%84-delete-%E4%B8%8E-forcedelete-%E6%96%B9%E6%B3%95">优化 Orm 的 Delete 与 ForceDelete 方法</a></p><h3 id="_5-如果正在使用-cache-的-decrement-或-increment-方法" tabindex="-1"><a class="header-anchor" href="#_5-如果正在使用-cache-的-decrement-或-increment-方法"><span>5. 如果正在使用 Cache 的 Decrement 或 Increment 方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-cache-%E7%9A%84-decrement-%E4%B8%8E-increment-%E6%96%B9%E6%B3%95">优化 Cache 的 Decrement 与 Increment 方法</a></p><h3 id="_6-如果正在使用-queue-模块的-worker-方法" tabindex="-1"><a class="header-anchor" href="#_6-如果正在使用-queue-模块的-worker-方法"><span>6. 如果正在使用 Queue 模块的 Worker 方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-queue-%E6%A8%A1%E5%9D%97%E7%9A%84-worker-%E6%96%B9%E6%B3%95">优化 Queue 模块的 Worker 方法</a></p><h3 id="_7-如果正在使用-artisan-的-call-方法" tabindex="-1"><a class="header-anchor" href="#_7-如果正在使用-artisan-的-call-方法"><span>7. 如果正在使用 Artisan 的 Call 方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-artisan-%E7%9A%84-call-%E6%96%B9%E6%B3%95">优化 Artisan 的 Call 方法</a></p><h3 id="_8-如果正在使用-testing-database-的-clear-方法" tabindex="-1"><a class="header-anchor" href="#_8-如果正在使用-testing-database-的-clear-方法"><span>8. 如果正在使用 Testing.Database 的 Clear 方法</span></a></h3><p>需相应修改：<a href="#testing-database-%E7%9A%84-clear-%E6%96%B9%E6%B3%95%E9%87%8D%E5%91%BD%E5%90%8D%E4%B8%BA-shutdown">Testing.Database 的 Clear 方法重命名为 Shutdown</a></p><h3 id="_9-如果正在使用-testing-database-的-build-方法" tabindex="-1"><a class="header-anchor" href="#_9-如果正在使用-testing-database-的-build-方法"><span>9. 如果正在使用 Testing.Database 的 Build 方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-testing-database-%E7%9A%84-build-%E6%96%B9%E6%B3%95">优化 Testing.Database 的 Build 方法</a></p><h3 id="_10-如果正在使用-migration-模块" tabindex="-1"><a class="header-anchor" href="#_10-如果正在使用-migration-模块"><span>10. 如果正在使用 Migration 模块</span></a></h3><p>修改 <code>config/database.go</code> 中的配置：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token string">&quot;migrations&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;migrations&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span> <span class="token string">&quot;migrations&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;sql&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;table&quot;</span><span class="token punctuation">:</span>  <span class="token string">&quot;migrations&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-如果正在使用-request-input-方法" tabindex="-1"><a class="header-anchor" href="#_11-如果正在使用-request-input-方法"><span>11. 如果正在使用 Request.Input* 方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-request-input-%E6%96%B9%E6%B3%95">优化 Request.Input* 方法</a></p><h3 id="_12-如果正在使用-validation-prepareforvalidation-方法" tabindex="-1"><a class="header-anchor" href="#_12-如果正在使用-validation-prepareforvalidation-方法"><span>12. 如果正在使用 validation.PrepareForValidation 方法</span></a></h3><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-validation-prepareforvalidation-%E6%96%B9%E6%B3%95">优化 validation.PrepareForValidation 方法</a></p><h3 id="_13-如果正在使用-mail-模块" tabindex="-1"><a class="header-anchor" href="#_13-如果正在使用-mail-模块"><span>13. 如果正在使用 Mail 模块</span></a></h3><p>修改 <code>Subject</code> 的设置方式：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token keyword">import</span> <span class="token string">&quot;github.com/goravel/framework/contracts/mail&quot;</span></span>
<span class="line"><span class="token operator">++</span> <span class="token keyword">import</span> <span class="token string">&quot;github.com/goravel/framework/mail&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> facades<span class="token punctuation">.</span><span class="token function">Mail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Content</span><span class="token punctuation">(</span>mail<span class="token punctuation">.</span>Content<span class="token punctuation">{</span>Subject<span class="token punctuation">:</span> <span class="token string">&quot;Subject&quot;</span><span class="token punctuation">,</span> Html<span class="token punctuation">:</span> <span class="token string">&quot;&lt;h1&gt;Hello Goravel&lt;/h1&gt;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> facades<span class="token punctuation">.</span><span class="token function">Mail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Content</span><span class="token punctuation">(</span>mail<span class="token punctuation">.</span><span class="token function">Html</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h1&gt;Hello Goravel&lt;/h1&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Subject</span><span class="token punctuation">(</span><span class="token string">&quot;Subject&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果使用了 <code>From</code> 方法：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token keyword">import</span> <span class="token string">&quot;github.com/goravel/framework/contracts/mail&quot;</span></span>
<span class="line"><span class="token operator">++</span> <span class="token keyword">import</span> <span class="token string">&quot;github.com/goravel/framework/mail&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> facades<span class="token punctuation">.</span><span class="token function">Mail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span>mail<span class="token punctuation">.</span>From<span class="token punctuation">{</span>Address<span class="token punctuation">:</span> testFromAddress<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> testFromName<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> facades<span class="token punctuation">.</span><span class="token function">Mail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span>mail<span class="token punctuation">.</span><span class="token function">Address</span><span class="token punctuation">(</span>testFromAddress<span class="token punctuation">,</span> testFromName<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果使用了 <code>Queue</code> 方法：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token keyword">import</span> <span class="token string">&quot;github.com/goravel/framework/contracts/mail&quot;</span></span>
<span class="line"><span class="token operator">++</span> <span class="token keyword">import</span> <span class="token string">&quot;github.com/goravel/framework/mail&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> facades<span class="token punctuation">.</span><span class="token function">Mail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span>mail<span class="token punctuation">.</span>Queue<span class="token punctuation">{</span>Connection<span class="token punctuation">:</span> <span class="token string">&quot;high&quot;</span><span class="token punctuation">,</span> Queue<span class="token punctuation">:</span> <span class="token string">&quot;mail&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> facades<span class="token punctuation">.</span><span class="token function">Mail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span>mail<span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Connection</span><span class="token punctuation">(</span><span class="token string">&quot;high&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;mail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="14"><li>如果正在使用 <code>validation.PrepareForValidation</code> 方法</li></ol><p>需相应修改：<a href="#%E4%BC%98%E5%8C%96-validation-prepareforvalidation-%E6%96%B9%E6%B3%95">优化 validation.PrepareForValidation 方法</a></p><h2 id="功能介绍" tabindex="-1"><a class="header-anchor" href="#功能介绍"><span>功能介绍</span></a></h2><h3 id="migration-支持使用-go-语言迁移" tabindex="-1"><a class="header-anchor" href="#migration-支持使用-go-语言迁移"><span>Migration 支持使用 Go 语言迁移</span></a></h3><p>之前框架仅支持 SQL 迁移，当想要切换数据库时，由于不同数据库间的 SQL 语法差异，将使迁移过程极其困难。此外，迁移文件中也无法执行代码，在进行数据修复时，无法进行逻辑判断。</p><p>现在框架支持直接使用 Go 语言生成迁移文件，方便开发者编写复杂的迁移逻辑。但在当前版本中，尚未实现对表字段的修改功能，仅支持创建表、删除表、创建索引等操作。如果想进行修改，需要使用 <code>Sql</code> 方法直接执行 SQL 语句。修改表字段的功能将在后续版本中支持。</p><p>在 v1.15 版本中，框架同时支持 Go 语言迁移（默认）和 SQL 迁移，但 SQL 迁移将在 v1.16 版本中移除。</p><h4 id="由-sql-迁移切换到-go-语言迁移" tabindex="-1"><a class="header-anchor" href="#由-sql-迁移切换到-go-语言迁移"><span>由 SQL 迁移切换到 Go 语言迁移</span></a></h4><p>如果你正在使用 SQL 迁移，可以通过以下步骤切换到 Go 语言迁移：</p><ol><li>修改 <code>config/database.go</code> 中的配置；</li></ol><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token string">&quot;migrations&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;migrations&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span> <span class="token string">&quot;migrations&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>    <span class="token string">&quot;table&quot;</span><span class="token punctuation">:</span>  <span class="token string">&quot;migrations&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>使用 <code>go run . artisan make:migration {NAME}</code> 命令创建迁移文件；</li></ol><p>在生成的文件的 <code>Up</code>, <code>Down</code> 方法中，分别执行原 SQL 迁移文件中的迁移、回滚语句，注意使用 <code>facades.Schema().HasTable</code> 方法判断表是否存在：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>M20241207095921CreateUsersTable<span class="token punctuation">)</span> <span class="token function">Up</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token operator">!</span>facades<span class="token punctuation">.</span><span class="token function">Schema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">HasTable</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> facades<span class="token punctuation">.</span><span class="token function">Schema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sql</span><span class="token punctuation">(</span><span class="token punctuation">{</span>SQL<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>注册迁移文件到 <code>database/kernel.go</code> 文件；</li></ol><p>新建 <code>database/kernel.go</code> 文件，并注册迁移文件与 Seeder：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">package</span> database</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;github.com/goravel/framework/contracts/database/schema&quot;</span></span>
<span class="line">  <span class="token string">&quot;github.com/goravel/framework/contracts/database/seeder&quot;</span></span>
<span class="line"></span>
<span class="line">  <span class="token string">&quot;goravel/database/migrations&quot;</span></span>
<span class="line">  <span class="token string">&quot;goravel/database/seeders&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Kernel <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>kernel Kernel<span class="token punctuation">)</span> <span class="token function">Migrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>schema<span class="token punctuation">.</span>Migration <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>schema<span class="token punctuation">.</span>Migration<span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">&amp;</span>migrations<span class="token punctuation">.</span>M20241207095921CreateUsersTable<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>kernel Kernel<span class="token punctuation">)</span> <span class="token function">Seeders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>seeder<span class="token punctuation">.</span>Seeder <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>seeder<span class="token punctuation">.</span>Seeder<span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">&amp;</span>seeders<span class="token punctuation">.</span>DatabaseSeeder<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>修改 <code>app/providers/database_service_provider.go</code> 文件完成注册，请将原本在此注册的 <code>Seeder</code> 移动到 <code>database/kernel.go::Seeders</code>；</li></ol><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token keyword">func</span> <span class="token punctuation">(</span>receiver <span class="token operator">*</span>DatabaseServiceProvider<span class="token punctuation">)</span> <span class="token function">Boot</span><span class="token punctuation">(</span>app foundation<span class="token punctuation">.</span>Application<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">--</span>   facades<span class="token punctuation">.</span><span class="token function">Seeder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>seeder<span class="token punctuation">.</span>Seeder<span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">--</span>     <span class="token operator">&amp;</span>seeders<span class="token punctuation">.</span>DatabaseSeeder<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">--</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">--</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">++</span> <span class="token keyword">func</span> <span class="token punctuation">(</span>receiver <span class="token operator">*</span>DatabaseServiceProvider<span class="token punctuation">)</span> <span class="token function">Boot</span><span class="token punctuation">(</span>app foundation<span class="token punctuation">.</span>Application<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span>   kernel <span class="token operator">:=</span> database<span class="token punctuation">.</span>Kernel<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">++</span>   facades<span class="token punctuation">.</span><span class="token function">Schema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>kernel<span class="token punctuation">.</span><span class="token function">Migrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span>   facades<span class="token punctuation">.</span><span class="token function">Seeder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>kernel<span class="token punctuation">.</span><span class="token function">Seeders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li><p>备份现有 <code>migrations</code> 表数据，之后删除 <code>migrations</code> 表；</p></li><li><p>执行 <code>go run . artisan migrate</code> 命令进行迁移，迁移完成后，将生成新的 <code>migrations</code> 表。</p></li></ol>`,80)),a("p",null,[e(t,{to:"/zh/orm/migrations.html"},{default:p(()=>n[0]||(n[0]=[s("查看文档")])),_:1})]),n[14]||(n[14]=a("h3",{id:"testing-支持-http-测试",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#testing-支持-http-测试"},[a("span",null,"Testing 支持 HTTP 测试")])],-1)),n[15]||(n[15]=a("p",null,"goravel/framework: v1.15.0",-1)),n[16]||(n[16]=a("p",null,[s("框架新增 "),a("code",null,"Testing.Http"),s(" 模块，支持对 HTTP 请求进行测试，可以模拟请求、获取响应、断言响应等。")],-1)),a("p",null,[e(t,{to:"/zh/testing/http-tests.html"},{default:p(()=>n[1]||(n[1]=[s("查看文档")])),_:1})]),n[17]||(n[17]=a("h3",{id:"http-支持返回-stream",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#http-支持返回-stream"},[a("span",null,"HTTP 支持返回 Stream")])],-1)),n[18]||(n[18]=a("p",null,"goravel/framework: v1.15.0",-1)),a("p",null,[e(t,{to:"/zh/the-basics/response.html#%E8%BF%94%E5%9B%9E-stream"},{default:p(()=>n[2]||(n[2]=[s("查看文档")])),_:1})]),n[19]||(n[19]=o('<h3 id="http-支持设置超时时间" tabindex="-1"><a class="header-anchor" href="#http-支持设置超时时间"><span>HTTP 支持设置超时时间</span></a></h3><p>goravel/framework: v1.15.0</p><p>可以通过在 <code>config/http.go</code> 文件中配置 <code>http.request_timeout</code> 设置超时时间，默认为 3 秒。</p><h3 id="http-支持设置自定义-recovery-方法" tabindex="-1"><a class="header-anchor" href="#http-支持设置自定义-recovery-方法"><span>HTTP 支持设置自定义 recovery 方法</span></a></h3><p>goravel/framework: v1.15.0</p>',5)),a("p",null,[e(t,{to:"/zh/the-basics/request.html#%E8%87%AA%E5%AE%9A%E4%B9%89-recovery"},{default:p(()=>n[3]||(n[3]=[s("查看文档")])),_:1})]),n[20]||(n[20]=a("h3",{id:"http-response-支持-abort",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#http-response-支持-abort"},[a("span",null,"HTTP Response 支持 Abort")])],-1)),n[21]||(n[21]=a("p",null,"goravel/framework: v1.15.0",-1)),a("p",null,[e(t,{to:"/zh/the-basics/response.html#abort"},{default:p(()=>n[4]||(n[4]=[s("查看文档")])),_:1})]),n[22]||(n[22]=a("h3",{id:"request-支持设置-filter",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#request-支持设置-filter"},[a("span",null,"Request 支持设置 Filter")])],-1)),n[23]||(n[23]=a("p",null,"goravel/framework: v1.15.0",-1)),a("p",null,[e(t,{to:"/zh/the-basics/validation.html#%E8%BF%87%E6%BB%A4%E8%BE%93%E5%85%A5%E6%95%B0%E6%8D%AE"},{default:p(()=>n[5]||(n[5]=[s("查看文档")])),_:1})]),n[24]||(n[24]=a("h3",{id:"request-增加-bindquery-方法",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#request-增加-bindquery-方法"},[a("span",null,"Request 增加 BindQuery 方法")])],-1)),n[25]||(n[25]=a("p",null,"goravel/framework: v1.15.0",-1)),n[26]||(n[26]=a("p",null,[s("支持使用 "),a("code",null,"ctx.Request().BindQuery()"),s(" 直接绑定链接中的参数。")],-1)),a("p",null,[e(t,{to:"/zh/the-basics/request.html#%E7%BB%91%E5%AE%9A-query"},{default:p(()=>n[6]||(n[6]=[s("查看文档")])),_:1})]),n[27]||(n[27]=o(`<h3 id="validation-支持-regex-规则" tabindex="-1"><a class="header-anchor" href="#validation-支持-regex-规则"><span>Validation 支持 Regex 规则</span></a></h3><p>goravel/framework: v1.15.0</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">validator<span class="token punctuation">,</span> err <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token string">\`required|regex:^\\d{4,6}$\`</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="schedule-支持控制日志输出" tabindex="-1"><a class="header-anchor" href="#schedule-支持控制日志输出"><span>Schedule 支持控制日志输出</span></a></h3><p>goravel/framework: v1.15.0</p><p>当 <code>app.debug</code> 为 <code>false</code> 时，将只输出 <code>error</code> 级别日志。</p><h3 id="schedule-新增-shutdown-方法" tabindex="-1"><a class="header-anchor" href="#schedule-新增-shutdown-方法"><span>Schedule 新增 Shutdown 方法</span></a></h3><p>使得可以优雅的关闭 Schedule。</p><p>goravel/framework: v1.15.0</p>`,9)),a("p",null,[e(t,{to:"/zh/digging-deeper/task-scheduling.html#%E5%85%B3%E9%97%AD%E8%B0%83%E5%BA%A6%E7%A8%8B%E5%BA%8F"},{default:p(()=>n[7]||(n[7]=[s("查看文档")])),_:1})]),n[28]||(n[28]=a("h3",{id:"mail-支持-mailable-模版",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#mail-支持-mailable-模版"},[a("span",null,"Mail 支持 Mailable 模版")])],-1)),n[29]||(n[29]=a("p",null,"goravel/framework: v1.15.0",-1)),a("p",null,[e(t,{to:"/zh/digging-deeper/mail.html#%E4%BD%BF%E7%94%A8-mailable"},{default:p(()=>n[8]||(n[8]=[s("查看文档")])),_:1})]),n[30]||(n[30]=o(`<h3 id="log-错误日志输出的-trace-支持点击跳转" tabindex="-1"><a class="header-anchor" href="#log-错误日志输出的-trace-支持点击跳转"><span>Log 错误日志输出的 trace 支持点击跳转</span></a></h3><p>goravel/framework: v1.15.0</p><p>在错误日志输出中，点击 trace 可以跳转到错误发生的代码行。</p><h3 id="log-支持打印-context-中的键值" tabindex="-1"><a class="header-anchor" href="#log-支持打印-context-中的键值"><span>Log 支持打印 Context 中的键值</span></a></h3><p>goravel/framework: v1.15.0</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">ctx<span class="token punctuation">.</span><span class="token function">WithValue</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span></span>
<span class="line">facades<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Goravel&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Output: </span></span>
<span class="line"><span class="token punctuation">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">36</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">]</span> local<span class="token punctuation">.</span>info<span class="token punctuation">:</span> Hello Goravel </span>
<span class="line">Context<span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span>a<span class="token punctuation">:</span>b<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="支持直接设置-dsn-连接数据库" tabindex="-1"><a class="header-anchor" href="#支持直接设置-dsn-连接数据库"><span>支持直接设置 DSN 连接数据库</span></a></h3><p>goravel/framework: v1.15.0</p>`,8)),a("p",null,[e(t,{to:"/zh/orm/getting-started.html#dsn"},{default:p(()=>n[9]||(n[9]=[s("查看文档")])),_:1})]),n[31]||(n[31]=a("h3",{id:"orm-的-create-方法支持使用-map-创建",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#orm-的-create-方法支持使用-map-创建"},[a("span",null,"Orm 的 Create 方法支持使用 map 创建")])],-1)),n[32]||(n[32]=a("p",null,"goravel/framework: v1.15.0",-1)),a("p",null,[e(t,{to:"/zh/orm/getting-started.html#%E5%88%9B%E5%BB%BA"},{default:p(()=>n[10]||(n[10]=[s("查看文档")])),_:1})]),n[33]||(n[33]=o(`<h3 id="orm-新增配置项" tabindex="-1"><a class="header-anchor" href="#orm-新增配置项"><span>Orm 新增配置项</span></a></h3><p>goravel/framework: v1.15.0</p><p>配置项是针对特定情况的，正常使用时不必须，没有被默认添加到配置文件中。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/database.go</span></span>
<span class="line"><span class="token string">&quot;{driver_name}&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>   <span class="token string">&quot;{driver_name}&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;host&quot;</span><span class="token punctuation">:</span>     config<span class="token punctuation">.</span><span class="token function">Env</span><span class="token punctuation">(</span><span class="token string">&quot;DB_HOST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token operator">...</span></span>
<span class="line"><span class="token operator">++</span> <span class="token string">&quot;schema&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;goravel&quot;</span><span class="token punctuation">,</span><span class="token comment">// Set the default schema for the connection, only for postgres and sqlserver</span></span>
<span class="line"><span class="token operator">++</span> <span class="token string">&quot;no_lower_case&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">// Set whether to convert the table name to lowercase</span></span>
<span class="line"><span class="token operator">++</span> <span class="token string">&quot;name_replacer&quot;</span><span class="token punctuation">:</span> strings<span class="token punctuation">.</span><span class="token function">NewReplacer</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// Set the columns name replacement</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="orm-新增-restore-方法" tabindex="-1"><a class="header-anchor" href="#orm-新增-restore-方法"><span>Orm 新增 Restore 方法</span></a></h3><p>goravel/framework: v1.15.0</p><p>新增 <code>Restore</code> 方法，可以用于恢复软删除的数据，并添加 <code>Restored</code>, <code>Restoring</code> 事件。</p>`,7)),a("p",null,[e(t,{to:"/zh/orm/getting-started.html#%E6%81%A2%E5%A4%8D%E8%BD%AF%E5%88%A0%E9%99%A4"},{default:p(()=>n[11]||(n[11]=[s("查看文档")])),_:1})]),n[34]||(n[34]=a("h3",{id:"orm-日志集成-log-模块",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#orm-日志集成-log-模块"},[a("span",null,"Orm 日志集成 Log 模块")])],-1)),n[35]||(n[35]=a("p",null,"goravel/framework: v1.15.0",-1)),n[36]||(n[36]=a("p",null,"之前 Orm 的日志输出是直接输出到控制台，现在 Orm 的日志输出将集成到 Log 模块，可以同时打印到控制台和日志文件。",-1)),n[37]||(n[37]=a("h3",{id:"postgres-和-sqlserver-驱动支持-schema",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#postgres-和-sqlserver-驱动支持-schema"},[a("span",null,"Postgres 和 Sqlserver 驱动支持 Schema")])],-1)),n[38]||(n[38]=a("p",null,"goravel/framework: v1.15.0",-1)),a("p",null,[e(t,{to:"/zh/orm/getting-started.html#schema"},{default:p(()=>n[12]||(n[12]=[s("查看文档")])),_:1})]),n[39]||(n[39]=o(`<h3 id="新增-about-命令" tabindex="-1"><a class="header-anchor" href="#新增-about-命令"><span>新增 about 命令</span></a></h3><p>goravel/framework: v1.15.0</p><p>新增 <code>about</code> 命令，可以查看框架的版本、配置等信息。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">go run <span class="token builtin class-name">.</span> artisan about</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="新增-db-show-命令" tabindex="-1"><a class="header-anchor" href="#新增-db-show-命令"><span>新增 db:show 命令</span></a></h3><p>goravel/framework: v1.15.0</p><p>新增 <code>db:show</code> 命令，可以查看数据库中的所有表。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">go run <span class="token builtin class-name">.</span> artisan db:show</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="新增-db-table-命令" tabindex="-1"><a class="header-anchor" href="#新增-db-table-命令"><span>新增 db:table 命令</span></a></h3><p>goravel/framework: v1.15.0</p><p>新增 <code>db:table</code> 命令，可以查看指定表的结构。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">go run <span class="token builtin class-name">.</span> artisan db:table</span>
<span class="line">go run <span class="token builtin class-name">.</span> artisan db:table <span class="token function">users</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-artisan-输出样式" tabindex="-1"><a class="header-anchor" href="#优化-artisan-输出样式"><span>优化 Artisan 输出样式</span></a></h3><p>goravel/framework: v1.15.0</p><p>优化 Artisan 输出样式，增加颜色，使输出更加美观。</p><h3 id="auth-新增-id-方法" tabindex="-1"><a class="header-anchor" href="#auth-新增-id-方法"><span>Auth 新增 ID 方法</span></a></h3><p>goravel/framework: v1.15.0</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">id<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Auth</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ID</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="多个-auth-guard-可以设置自己的-ttl" tabindex="-1"><a class="header-anchor" href="#多个-auth-guard-可以设置自己的-ttl"><span>多个 Auth.Guard 可以设置自己的 TTL</span></a></h3><p>goravel/framework: v1.15.0</p><p>之前多个 Guard 公用 <code>jwt.ttl</code> 配置，现在你可以通过在 <code>config/auth.go</code> 文件中为每个 Guard 单独设置 TTL，如果不设置，则默认使用 <code>jwt.ttl</code> 配置。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/auth.go</span></span>
<span class="line"><span class="token string">&quot;guards&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;jwt&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">++</span>  <span class="token string">&quot;ttl&quot;</span><span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="postgresql-驱动名称更改为-postgres" tabindex="-1"><a class="header-anchor" href="#postgresql-驱动名称更改为-postgres"><span>Postgresql 驱动名称更改为 Postgres</span></a></h3><p>goravel/framework: v1.15.0</p><p>Postgresql 驱动的名称已更改为 <code>postgres</code>，如果您正在使用 Postgresql 驱动程序，则需要修改配置文件：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token comment">// config/database.go</span></span>
<span class="line"><span class="token string">&quot;postgres&quot;</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span></span>
<span class="line">  <span class="token operator">--</span> <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>   <span class="token string">&quot;postgresql&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token operator">++</span> <span class="token string">&quot;driver&quot;</span><span class="token punctuation">:</span>   <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;host&quot;</span><span class="token punctuation">:</span>     config<span class="token punctuation">.</span><span class="token function">Env</span><span class="token punctuation">(</span><span class="token string">&quot;DB_HOST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改-orm-transaction-方法回调参数类型" tabindex="-1"><a class="header-anchor" href="#修改-orm-transaction-方法回调参数类型"><span>修改 Orm.Transaction 方法回调参数类型</span></a></h3><p>goravel/framework: v1.15.0</p><p><code>facades.Orm().Transaction()</code> 方法的回调参数类型由 <code>func(tx orm.Transaction) error</code> 改为 <code>func(tx orm.Query) error</code>，如果你正在使用该方法，请相应修改。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx orm<span class="token punctuation">.</span>Transaction<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx orm<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> user models<span class="token punctuation">.</span>User</span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> tx<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-orm-的-delete-与-forcedelete-方法" tabindex="-1"><a class="header-anchor" href="#优化-orm-的-delete-与-forcedelete-方法"><span>优化 Orm 的 Delete 与 ForceDelete 方法</span></a></h3><p>goravel/framework: v1.15.0</p><p>如果你正在向 <code>Delete</code> 或 <code>ForceDelete</code> 方法传入 ID 删除数据，请改为使用 <code>Where</code> 方法：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">uint</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WhereIn</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">uint</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForceDelete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForceDelete</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Delete</code> 和 <code>ForceDelete</code> 方法支持不传入参数删除数据：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">res<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">res<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Orm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-cache-的-decrement-与-increment-方法" tabindex="-1"><a class="header-anchor" href="#优化-cache-的-decrement-与-increment-方法"><span>优化 Cache 的 Decrement 与 Increment 方法</span></a></h3><p>goravel/framework: v1.15.0</p><p><code>Decrement</code> 和 <code>Increment</code> 方法的入参与出参类型由 <code>int</code> 修改为 <code>int64</code>：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> <span class="token function">Decrement</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token operator">...</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> <span class="token function">Decrement</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token operator">...</span><span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> <span class="token function">Increment</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token operator">...</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> <span class="token function">Increment</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token operator">...</span><span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-artisan-的-call-方法" tabindex="-1"><a class="header-anchor" href="#优化-artisan-的-call-方法"><span>优化 Artisan 的 Call 方法</span></a></h3><p>goravel/framework: v1.15.0</p><p>之前 <code>facades.Artisan().Call()</code> 方法执行时遇到错误将会直接 panic，现在将返回错误，如果你正在使用该方法，请处理该错误返回。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Artisan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token string">&quot;command:name&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="testing-database-的-clear-方法重命名为-shutdown" tabindex="-1"><a class="header-anchor" href="#testing-database-的-clear-方法重命名为-shutdown"><span>Testing.Database 的 Clear 方法重命名为 Shutdown</span></a></h3><p>goravel/framework: v1.15.0</p><p>为了保持方法名称与其他模块一致，我们将 <code>Clear</code> 方法重命名为 <code>Shutdown</code>。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">database<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">--</span> err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-testing-database-的-build-方法" tabindex="-1"><a class="header-anchor" href="#优化-testing-database-的-build-方法"><span>优化 Testing.Database 的 Build 方法</span></a></h3><p>goravel/framework: v1.15.0</p><p>之前在调用 <code>Build</code> 方法时，会自动进行数据库迁移，升级后，需要手动调用 <code>Migrate</code> 方法进行迁移，数据库控制更加灵活。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">database<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Migrate</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-request-input-方法" tabindex="-1"><a class="header-anchor" href="#优化-request-input-方法"><span>优化 Request.Input* 方法</span></a></h3><p>goravel/framework: v1.15.0</p><p>goravel/gin: v1.3.0</p><p>goravel/fiber: v1.3.0</p><p>之前 <code>Request.Input*</code> 方法仅能获取 <code>Body</code> 中的数据，现在将依次查找 <code>Body</code>、 <code>Query</code>、<code>Param</code>。并且之前向 <code>Request.Input*</code> 方法传递第二个参数(默认值)时，如果 <code>key</code> 存在，但置为空，将返回默认值，现在将返回空字符串，因为空字符串也是一种有效值，只有当 key 不存在时，才返回默认值。</p><p>你需要检查所有使用 <code>Request.Input*</code> 方法的地方，确保传递的参数正确与返回值符合预期。</p><h3 id="优化-validation-prepareforvalidation-方法" tabindex="-1"><a class="header-anchor" href="#优化-validation-prepareforvalidation-方法"><span>优化 validation.PrepareForValidation 方法</span></a></h3><p>goravel/framework: v1.15.0</p><p>修改入参的类型，增加 <code>http.Context</code> 参数：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">import</span> github<span class="token punctuation">.</span>com<span class="token operator">/</span>goravel<span class="token operator">/</span>framework<span class="token operator">/</span>validation</span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> validator<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Validation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Make</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> rules<span class="token punctuation">,</span> validation<span class="token punctuation">.</span><span class="token function">PrepareForValidation</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>data validationcontract<span class="token punctuation">.</span>Data<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span> validator<span class="token punctuation">,</span> err <span class="token operator">:=</span> facades<span class="token punctuation">.</span><span class="token function">Validation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Make</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> rules<span class="token punctuation">,</span> validation<span class="token punctuation">.</span><span class="token function">PrepareForValidation</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>ctx http<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> data validationcontract<span class="token punctuation">.</span>Data<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> name<span class="token punctuation">,</span> exist <span class="token operator">:=</span> data<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> exist <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优化-queue-模块的-worker-方法" tabindex="-1"><a class="header-anchor" href="#优化-queue-模块的-worker-方法"><span>优化 Queue 模块的 Worker 方法</span></a></h3><p>goravel/framework: v1.15.0</p><p>当 <code>Worker</code> 方法不需要设置参数时，可以保持为空：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> facades<span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Worker</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> facades<span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>当需要设置参数时，参数由指针改为实例：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token operator">--</span> facades<span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Worker</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>queue<span class="token punctuation">.</span>Args<span class="token punctuation">{</span>Connection<span class="token punctuation">:</span> <span class="token string">&quot;redis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">++</span> facades<span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Worker</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span>Args<span class="token punctuation">{</span>Connection<span class="token punctuation">:</span> <span class="token string">&quot;redis&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="go-迁移支持-boolean-字段" tabindex="-1"><a class="header-anchor" href="#go-迁移支持-boolean-字段"><span>Go 迁移支持 Boolean 字段</span></a></h3><p>goravel/framework: v1.15.3</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">table<span class="token punctuation">.</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token string">&quot;is_admin&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="go-迁移支持自定义字段" tabindex="-1"><a class="header-anchor" href="#go-迁移支持自定义字段"><span>Go 迁移支持自定义字段</span></a></h3><p>goravel/framework: v1.15.3</p><p>如果你正在使用框架尚不支持的字段类型，可以通过 <code>Column</code> 方法自定义字段类型：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line">table<span class="token punctuation">.</span><span class="token function">Column</span><span class="token punctuation">(</span><span class="token string">&quot;geometry&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;geometry&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="优化-artisan-log-输出规则" tabindex="-1"><a class="header-anchor" href="#优化-artisan-log-输出规则"><span>优化 Artisan log 输出规则</span></a></h3><p>goravel/framework: v1.15.3</p><p>之前 Artisan log 仅输出 error 级别的日志，现在将输出所有级别的日志。如果想禁止 console 打印日志且正在使用 <code>single</code> 或 <code>daily</code> 日志驱动，请将 <code>logging.channels.single.print</code> 或 <code>logging.channels.daily.print</code> 配置设置为 <code>false</code>。</p><h3 id="修复-prepareforvalidation-中-ctx-为-nil-的问题" tabindex="-1"><a class="header-anchor" href="#修复-prepareforvalidation-中-ctx-为-nil-的问题"><span>修复 PrepareForValidation 中 ctx 为 nil 的问题</span></a></h3><p>goravel/framework: v1.15.4</p><p>goravel/gin: v1.3.3</p><p>goravel/fiber: v1.3.3</p><p>修复前，<code>PrepareForValidation</code> 方法中 <code>ctx</code> 始终为 <code>nil</code>，现在将正确传递 <code>ctx</code> 参数。如果你正在使用 <code>validation.PrepareForValidation</code> 方法，请相应修改。</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">  github<span class="token punctuation">.</span>com<span class="token operator">/</span>goravel<span class="token operator">/</span>framework<span class="token operator">/</span>validation</span>
<span class="line">  contarctsvalidate <span class="token string">&quot;github.com/goravel/framework/contracts/validation&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">--</span> validation<span class="token punctuation">.</span><span class="token function">PrepareForValidation</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>ctx http<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> data contarctsvalidate<span class="token punctuation">.</span>Data<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">++</span> validation<span class="token punctuation">.</span><span class="token function">PrepareForValidation</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx http<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> data contarctsvalidate<span class="token punctuation">.</span>Data<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修复-fiber-驱动高并发下-orm-withcontext-方法报错的问题" tabindex="-1"><a class="header-anchor" href="#修复-fiber-驱动高并发下-orm-withcontext-方法报错的问题"><span>修复 Fiber 驱动高并发下 Orm WithContext 方法报错的问题</span></a></h3><p>goravel/framework: v1.15.4</p><p>goravel/fiber: v1.3.3</p><p>详见：<a href="https://github.com/goravel/framework/pull/866" target="_blank" rel="noopener noreferrer">#866</a></p><h3 id="优化打包体积" tabindex="-1"><a class="header-anchor" href="#优化打包体积"><span>优化打包体积</span></a></h3><p>goravel/framework: v1.15.4</p><p>详见：<a href="https://github.com/goravel/framework/pull/865" target="_blank" rel="noopener noreferrer">#865</a></p><h3 id="优化-model-id-多重嵌套时的问题" tabindex="-1"><a class="header-anchor" href="#优化-model-id-多重嵌套时的问题"><span>优化 model ID 多重嵌套时的问题</span></a></h3><p>goravel/framework: v1.15.4</p><p>详见：<a href="https://github.com/goravel/framework/pull/898" target="_blank" rel="noopener noreferrer">#898</a></p><h3 id="添加-artisan-命令别名" tabindex="-1"><a class="header-anchor" href="#添加-artisan-命令别名"><span>添加 artisan 命令别名</span></a></h3><p>goravel/framework: v1.15.4</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">// Before</span>
<span class="line">go run  . artisan key:generate</span>
<span class="line"></span>
<span class="line">// After</span>
<span class="line">./artisan key:generate</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修复使用-redis-驱动时-throttle-无效的问题" tabindex="-1"><a class="header-anchor" href="#修复使用-redis-驱动时-throttle-无效的问题"><span>修复使用 Redis 驱动时 Throttle 无效的问题</span></a></h3><p>goravel/framework: v1.15.5</p><p>goravel/redis: v1.3.1</p><p>使用 Redis 驱动时，<code>Throttle</code> 无法进行正常的存储，导致限流失效。</p><p>详见：<a href="https://github.com/goravel/goravel/issues/625" target="_blank" rel="noopener noreferrer">#625</a></p><h3 id="修复使用-fiber-驱动时-fallback-异常的问题" tabindex="-1"><a class="header-anchor" href="#修复使用-fiber-驱动时-fallback-异常的问题"><span>修复使用 Fiber 驱动时 Fallback 异常的问题</span></a></h3><p>goravel/framework: v1.15.5</p><p>goravel/fiber: v1.3.4</p><p>使用 Fiber 驱动时，如果设置 <code>Fallback</code>，其他路由将无法正常访问。</p><p>详见：<a href="https://github.com/goravel/goravel/issues/624" target="_blank" rel="noopener noreferrer">#624</a></p><h3 id="修复-orm-withcontext-方法在并发下异常的问题" tabindex="-1"><a class="header-anchor" href="#修复-orm-withcontext-方法在并发下异常的问题"><span>修复 Orm WithContext 方法在并发下异常的问题</span></a></h3><p>goravel/framework: v1.15.6</p><p>通过 <code>WithContext</code> 方法设置 <code>Context</code> 时，高并发下被异常共享。</p><h3 id="升级-carbon" tabindex="-1"><a class="header-anchor" href="#升级-carbon"><span>升级 Carbon</span></a></h3><p>goravel/framework: v1.15.7</p><p><a href="https://github.com/dromara/carbon" target="_blank" rel="noopener noreferrer">dromara/carbon</a> ~v2.5.5 以上版本引入了新的特性，导致框架部分功能异常。注意，当前尚不支持 dromara/carbon v2.6 以上版本，将在 Goravel v1.16 中兼容。</p><h3 id="修复-facades-testing-docker-database-异常的问题" tabindex="-1"><a class="header-anchor" href="#修复-facades-testing-docker-database-异常的问题"><span>修复 facades.Testing().Docker().Database() 异常的问题</span></a></h3><p>goravel/framework: v1.15.8</p><p>详见：<a href="https://github.com/goravel/goravel/issues/672" target="_blank" rel="noopener noreferrer">#672</a></p><h3 id="修复-fiber-驱动-ctx-request-ip-获取-ip-无效的问题" tabindex="-1"><a class="header-anchor" href="#修复-fiber-驱动-ctx-request-ip-获取-ip-无效的问题"><span>修复 fiber 驱动 ctx.Request().Ip() 获取 IP 无效的问题</span></a></h3><p>goravel/fiber: v1.3.6</p><p>之前一直返回 <code>127.0.0.1</code>。修复后，新增了 <code>http.drivers.fiber.proxy_header</code>, <code>http.drivers.fiber.enable_trusted_proxy_check</code> 和 <code>http.drivers.fiber.trusted_proxies</code> 配置，用于设置代理头与可信任的代理 IP 地址。</p><p>详见：<a href="https://github.com/goravel/goravel/issues/678" target="_blank" rel="noopener noreferrer">#678</a></p><h3 id="orm-中-wherebetween-相关方法不支持字符串的问题" tabindex="-1"><a class="header-anchor" href="#orm-中-wherebetween-相关方法不支持字符串的问题"><span>Orm 中 WhereBetween 相关方法不支持字符串的问题</span></a></h3><p>goravel/framework: v1.15.8</p><p>详见：<a href="https://github.com/goravel/goravel/issues/1036" target="_blank" rel="noopener noreferrer">#1036</a></p><h3 id="修复-orm-中-cursor-方法在某些情况下内存泄露的问题" tabindex="-1"><a class="header-anchor" href="#修复-orm-中-cursor-方法在某些情况下内存泄露的问题"><span>修复 Orm 中 Cursor 方法在某些情况下内存泄露的问题</span></a></h3><p>goravel/framework: v1.15.9</p><p>当获取 <code>rows</code> 时，<code>chan</code> 未被正确关闭，导致内存泄露。</p><h3 id="修复-schedule-中使用秒级任务时-ononeserver-异常的问题" tabindex="-1"><a class="header-anchor" href="#修复-schedule-中使用秒级任务时-ononeserver-异常的问题"><span>修复 Schedule 中使用秒级任务时 OnOneServer 异常的问题</span></a></h3><p>goravel/framework: v1.15.9</p><p>详见：<a href="https://github.com/goravel/goravel/issues/690" target="_blank" rel="noopener noreferrer">#690</a></p><h3 id="make-migration-命令生成的迁移文件中默认-timestamps-改为-timestampstz" tabindex="-1"><a class="header-anchor" href="#make-migration-命令生成的迁移文件中默认-timestamps-改为-timestampstz"><span>make:migration 命令生成的迁移文件中默认 Timestamps 改为 TimestampsTz</span></a></h3><p>goravel/framework: v1.15.9</p><p>详见：<a href="https://github.com/goravel/goravel/issues/699" target="_blank" rel="noopener noreferrer">#699</a></p>`,132)),e(i)])}const m=c(d,[["render",k],["__file","v1.15.html.vue"]]),g=JSON.parse('{"path":"/zh/upgrade/v1.15.html","title":"从 v1.14 升级到 v1.15","lang":"zh-CN","frontmatter":{"description":"从 v1.14 升级到 v1.15 令人兴奋的新功能 🎉 Migration 支持使用 Go 语言迁移 Testing 支持 HTTP 测试 功能增强 🚀 HTTP 支持返回 Stream HTTP 支持设置超时时间 HTTP 支持设置自定义 recovery 方法 HTTP Response 支持 Abort Request 支持设置 Filte...","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://goravel.dev/upgrade/v1.15.html"}],["meta",{"property":"og:url","content":"https://goravel.dev/zh/upgrade/v1.15.html"}],["meta",{"property":"og:site_name","content":"Goravel"}],["meta",{"property":"og:title","content":"/upgrade/v1.15.html"}],["meta",{"property":"og:description","content":"从 v1.14 升级到 v1.15 令人兴奋的新功能 🎉 Migration 支持使用 Go 语言迁移 Testing 支持 HTTP 测试 功能增强 🚀 HTTP 支持返回 Stream HTTP 支持设置超时时间 HTTP 支持设置自定义 recovery 方法 HTTP Response 支持 Abort Request 支持设置 Filte..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"从 v1.14 升级到 v1.15\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":3,"title":"令人兴奋的新功能 🎉","slug":"令人兴奋的新功能-🎉","link":"#令人兴奋的新功能-🎉","children":[]},{"level":3,"title":"功能增强 🚀","slug":"功能增强-🚀","link":"#功能增强-🚀","children":[]},{"level":3,"title":"破坏性变化 🛠","slug":"破坏性变化-🛠","link":"#破坏性变化-🛠","children":[]},{"level":3,"title":"v1.15.3","slug":"v1-15-3","link":"#v1-15-3","children":[]},{"level":3,"title":"v1.15.4","slug":"v1-15-4","link":"#v1-15-4","children":[]},{"level":3,"title":"v1.15.5","slug":"v1-15-5","link":"#v1-15-5","children":[]},{"level":3,"title":"v1.15.6","slug":"v1-15-6","link":"#v1-15-6","children":[]},{"level":3,"title":"v1.15.7","slug":"v1-15-7","link":"#v1-15-7","children":[]},{"level":3,"title":"v1.15.8","slug":"v1-15-8","link":"#v1-15-8","children":[]},{"level":3,"title":"v1.15.9","slug":"v1-15-9","link":"#v1-15-9","children":[]},{"level":2,"title":"升级指南","slug":"升级指南","link":"#升级指南","children":[{"level":3,"title":"1. 更新依赖","slug":"_1-更新依赖","link":"#_1-更新依赖","children":[]},{"level":3,"title":"2. 如果正在使用 Postgres 数据库","slug":"_2-如果正在使用-postgres-数据库","link":"#_2-如果正在使用-postgres-数据库","children":[]},{"level":3,"title":"3. 如果正在使用 Orm.Transaction 方法","slug":"_3-如果正在使用-orm-transaction-方法","link":"#_3-如果正在使用-orm-transaction-方法","children":[]},{"level":3,"title":"4. 如果正在使用 Orm 的 Delete 或 ForceDelete 方法","slug":"_4-如果正在使用-orm-的-delete-或-forcedelete-方法","link":"#_4-如果正在使用-orm-的-delete-或-forcedelete-方法","children":[]},{"level":3,"title":"5. 如果正在使用 Cache 的 Decrement 或 Increment 方法","slug":"_5-如果正在使用-cache-的-decrement-或-increment-方法","link":"#_5-如果正在使用-cache-的-decrement-或-increment-方法","children":[]},{"level":3,"title":"6. 如果正在使用 Queue 模块的 Worker 方法","slug":"_6-如果正在使用-queue-模块的-worker-方法","link":"#_6-如果正在使用-queue-模块的-worker-方法","children":[]},{"level":3,"title":"7. 如果正在使用 Artisan 的 Call 方法","slug":"_7-如果正在使用-artisan-的-call-方法","link":"#_7-如果正在使用-artisan-的-call-方法","children":[]},{"level":3,"title":"8. 如果正在使用 Testing.Database 的 Clear 方法","slug":"_8-如果正在使用-testing-database-的-clear-方法","link":"#_8-如果正在使用-testing-database-的-clear-方法","children":[]},{"level":3,"title":"9. 如果正在使用 Testing.Database 的 Build 方法","slug":"_9-如果正在使用-testing-database-的-build-方法","link":"#_9-如果正在使用-testing-database-的-build-方法","children":[]},{"level":3,"title":"10. 如果正在使用 Migration 模块","slug":"_10-如果正在使用-migration-模块","link":"#_10-如果正在使用-migration-模块","children":[]},{"level":3,"title":"11. 如果正在使用 Request.Input* 方法","slug":"_11-如果正在使用-request-input-方法","link":"#_11-如果正在使用-request-input-方法","children":[]},{"level":3,"title":"12. 如果正在使用 validation.PrepareForValidation 方法","slug":"_12-如果正在使用-validation-prepareforvalidation-方法","link":"#_12-如果正在使用-validation-prepareforvalidation-方法","children":[]},{"level":3,"title":"13. 如果正在使用 Mail 模块","slug":"_13-如果正在使用-mail-模块","link":"#_13-如果正在使用-mail-模块","children":[]}]},{"level":2,"title":"功能介绍","slug":"功能介绍","link":"#功能介绍","children":[{"level":3,"title":"Migration 支持使用 Go 语言迁移","slug":"migration-支持使用-go-语言迁移","link":"#migration-支持使用-go-语言迁移","children":[]},{"level":3,"title":"Testing 支持 HTTP 测试","slug":"testing-支持-http-测试","link":"#testing-支持-http-测试","children":[]},{"level":3,"title":"HTTP 支持返回 Stream","slug":"http-支持返回-stream","link":"#http-支持返回-stream","children":[]},{"level":3,"title":"HTTP 支持设置超时时间","slug":"http-支持设置超时时间","link":"#http-支持设置超时时间","children":[]},{"level":3,"title":"HTTP 支持设置自定义 recovery 方法","slug":"http-支持设置自定义-recovery-方法","link":"#http-支持设置自定义-recovery-方法","children":[]},{"level":3,"title":"HTTP Response 支持 Abort","slug":"http-response-支持-abort","link":"#http-response-支持-abort","children":[]},{"level":3,"title":"Request 支持设置 Filter","slug":"request-支持设置-filter","link":"#request-支持设置-filter","children":[]},{"level":3,"title":"Request 增加 BindQuery 方法","slug":"request-增加-bindquery-方法","link":"#request-增加-bindquery-方法","children":[]},{"level":3,"title":"Validation 支持 Regex 规则","slug":"validation-支持-regex-规则","link":"#validation-支持-regex-规则","children":[]},{"level":3,"title":"Schedule 支持控制日志输出","slug":"schedule-支持控制日志输出","link":"#schedule-支持控制日志输出","children":[]},{"level":3,"title":"Schedule 新增 Shutdown 方法","slug":"schedule-新增-shutdown-方法","link":"#schedule-新增-shutdown-方法","children":[]},{"level":3,"title":"Mail 支持 Mailable 模版","slug":"mail-支持-mailable-模版","link":"#mail-支持-mailable-模版","children":[]},{"level":3,"title":"Log 错误日志输出的 trace 支持点击跳转","slug":"log-错误日志输出的-trace-支持点击跳转","link":"#log-错误日志输出的-trace-支持点击跳转","children":[]},{"level":3,"title":"Log 支持打印 Context 中的键值","slug":"log-支持打印-context-中的键值","link":"#log-支持打印-context-中的键值","children":[]},{"level":3,"title":"支持直接设置 DSN 连接数据库","slug":"支持直接设置-dsn-连接数据库","link":"#支持直接设置-dsn-连接数据库","children":[]},{"level":3,"title":"Orm 的 Create 方法支持使用 map 创建","slug":"orm-的-create-方法支持使用-map-创建","link":"#orm-的-create-方法支持使用-map-创建","children":[]},{"level":3,"title":"Orm 新增配置项","slug":"orm-新增配置项","link":"#orm-新增配置项","children":[]},{"level":3,"title":"Orm 新增 Restore 方法","slug":"orm-新增-restore-方法","link":"#orm-新增-restore-方法","children":[]},{"level":3,"title":"Orm 日志集成 Log 模块","slug":"orm-日志集成-log-模块","link":"#orm-日志集成-log-模块","children":[]},{"level":3,"title":"Postgres 和 Sqlserver 驱动支持 Schema","slug":"postgres-和-sqlserver-驱动支持-schema","link":"#postgres-和-sqlserver-驱动支持-schema","children":[]},{"level":3,"title":"新增 about 命令","slug":"新增-about-命令","link":"#新增-about-命令","children":[]},{"level":3,"title":"新增 db:show 命令","slug":"新增-db-show-命令","link":"#新增-db-show-命令","children":[]},{"level":3,"title":"新增 db:table 命令","slug":"新增-db-table-命令","link":"#新增-db-table-命令","children":[]},{"level":3,"title":"优化 Artisan 输出样式","slug":"优化-artisan-输出样式","link":"#优化-artisan-输出样式","children":[]},{"level":3,"title":"Auth 新增 ID 方法","slug":"auth-新增-id-方法","link":"#auth-新增-id-方法","children":[]},{"level":3,"title":"多个 Auth.Guard 可以设置自己的 TTL","slug":"多个-auth-guard-可以设置自己的-ttl","link":"#多个-auth-guard-可以设置自己的-ttl","children":[]},{"level":3,"title":"Postgresql 驱动名称更改为 Postgres","slug":"postgresql-驱动名称更改为-postgres","link":"#postgresql-驱动名称更改为-postgres","children":[]},{"level":3,"title":"修改 Orm.Transaction 方法回调参数类型","slug":"修改-orm-transaction-方法回调参数类型","link":"#修改-orm-transaction-方法回调参数类型","children":[]},{"level":3,"title":"优化 Orm 的 Delete 与 ForceDelete 方法","slug":"优化-orm-的-delete-与-forcedelete-方法","link":"#优化-orm-的-delete-与-forcedelete-方法","children":[]},{"level":3,"title":"优化 Cache 的 Decrement 与 Increment 方法","slug":"优化-cache-的-decrement-与-increment-方法","link":"#优化-cache-的-decrement-与-increment-方法","children":[]},{"level":3,"title":"优化 Artisan 的 Call 方法","slug":"优化-artisan-的-call-方法","link":"#优化-artisan-的-call-方法","children":[]},{"level":3,"title":"Testing.Database 的 Clear 方法重命名为 Shutdown","slug":"testing-database-的-clear-方法重命名为-shutdown","link":"#testing-database-的-clear-方法重命名为-shutdown","children":[]},{"level":3,"title":"优化 Testing.Database 的 Build 方法","slug":"优化-testing-database-的-build-方法","link":"#优化-testing-database-的-build-方法","children":[]},{"level":3,"title":"优化 Request.Input* 方法","slug":"优化-request-input-方法","link":"#优化-request-input-方法","children":[]},{"level":3,"title":"优化 validation.PrepareForValidation 方法","slug":"优化-validation-prepareforvalidation-方法","link":"#优化-validation-prepareforvalidation-方法","children":[]},{"level":3,"title":"优化 Queue 模块的 Worker 方法","slug":"优化-queue-模块的-worker-方法","link":"#优化-queue-模块的-worker-方法","children":[]},{"level":3,"title":"Go 迁移支持 Boolean 字段","slug":"go-迁移支持-boolean-字段","link":"#go-迁移支持-boolean-字段","children":[]},{"level":3,"title":"Go 迁移支持自定义字段","slug":"go-迁移支持自定义字段","link":"#go-迁移支持自定义字段","children":[]},{"level":3,"title":"优化 Artisan log 输出规则","slug":"优化-artisan-log-输出规则","link":"#优化-artisan-log-输出规则","children":[]},{"level":3,"title":"修复 PrepareForValidation 中 ctx 为 nil 的问题","slug":"修复-prepareforvalidation-中-ctx-为-nil-的问题","link":"#修复-prepareforvalidation-中-ctx-为-nil-的问题","children":[]},{"level":3,"title":"修复 Fiber 驱动高并发下 Orm WithContext 方法报错的问题","slug":"修复-fiber-驱动高并发下-orm-withcontext-方法报错的问题","link":"#修复-fiber-驱动高并发下-orm-withcontext-方法报错的问题","children":[]},{"level":3,"title":"优化打包体积","slug":"优化打包体积","link":"#优化打包体积","children":[]},{"level":3,"title":"优化 model ID 多重嵌套时的问题","slug":"优化-model-id-多重嵌套时的问题","link":"#优化-model-id-多重嵌套时的问题","children":[]},{"level":3,"title":"添加 artisan 命令别名","slug":"添加-artisan-命令别名","link":"#添加-artisan-命令别名","children":[]},{"level":3,"title":"修复使用 Redis 驱动时 Throttle 无效的问题","slug":"修复使用-redis-驱动时-throttle-无效的问题","link":"#修复使用-redis-驱动时-throttle-无效的问题","children":[]},{"level":3,"title":"修复使用 Fiber 驱动时 Fallback 异常的问题","slug":"修复使用-fiber-驱动时-fallback-异常的问题","link":"#修复使用-fiber-驱动时-fallback-异常的问题","children":[]},{"level":3,"title":"修复 Orm WithContext 方法在并发下异常的问题","slug":"修复-orm-withcontext-方法在并发下异常的问题","link":"#修复-orm-withcontext-方法在并发下异常的问题","children":[]},{"level":3,"title":"升级 Carbon","slug":"升级-carbon","link":"#升级-carbon","children":[]},{"level":3,"title":"修复 facades.Testing().Docker().Database() 异常的问题","slug":"修复-facades-testing-docker-database-异常的问题","link":"#修复-facades-testing-docker-database-异常的问题","children":[]},{"level":3,"title":"修复 fiber 驱动 ctx.Request().Ip() 获取 IP 无效的问题","slug":"修复-fiber-驱动-ctx-request-ip-获取-ip-无效的问题","link":"#修复-fiber-驱动-ctx-request-ip-获取-ip-无效的问题","children":[]},{"level":3,"title":"Orm 中 WhereBetween 相关方法不支持字符串的问题","slug":"orm-中-wherebetween-相关方法不支持字符串的问题","link":"#orm-中-wherebetween-相关方法不支持字符串的问题","children":[]},{"level":3,"title":"修复 Orm 中 Cursor 方法在某些情况下内存泄露的问题","slug":"修复-orm-中-cursor-方法在某些情况下内存泄露的问题","link":"#修复-orm-中-cursor-方法在某些情况下内存泄露的问题","children":[]},{"level":3,"title":"修复 Schedule 中使用秒级任务时 OnOneServer 异常的问题","slug":"修复-schedule-中使用秒级任务时-ononeserver-异常的问题","link":"#修复-schedule-中使用秒级任务时-ononeserver-异常的问题","children":[]},{"level":3,"title":"make:migration 命令生成的迁移文件中默认 Timestamps 改为 TimestampsTz","slug":"make-migration-命令生成的迁移文件中默认-timestamps-改为-timestampstz","link":"#make-migration-命令生成的迁移文件中默认-timestamps-改为-timestampstz","children":[]}]}],"git":{},"filePathRelative":"zh/upgrade/v1.15.md","autoDesc":true}');export{m as comp,g as data};
