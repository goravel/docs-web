import{_ as r,c as p,b as n,e,f as l,a as c,r as t,o,d as i}from"./app-DH8RX3ii.js";const u={},v={class:"table-of-contents"};function m(b,s){const a=t("router-link"),d=t("CommentService");return o(),p("div",null,[s[9]||(s[9]=n("h1",{id:"编译",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#编译"},[n("span",null,"编译")])],-1)),n("nav",v,[n("ul",null,[n("li",null,[e(a,{to:"#编译命令"},{default:l(()=>s[0]||(s[0]=[i("编译命令")])),_:1})]),n("li",null,[e(a,{to:"#手动编译"},{default:l(()=>s[1]||(s[1]=[i("手动编译")])),_:1}),n("ul",null,[n("li",null,[e(a,{to:"#常规编译"},{default:l(()=>s[2]||(s[2]=[i("常规编译")])),_:1})]),n("li",null,[e(a,{to:"#静态编译"},{default:l(()=>s[3]||(s[3]=[i("静态编译")])),_:1})]),n("li",null,[e(a,{to:"#交叉编译"},{default:l(()=>s[4]||(s[4]=[i("交叉编译")])),_:1})])])]),n("li",null,[e(a,{to:"#docker"},{default:l(()=>s[5]||(s[5]=[i("Docker")])),_:1}),n("ul",null,[n("li",null,[e(a,{to:"#docker-compose"},{default:l(()=>s[6]||(s[6]=[i("Docker Compose")])),_:1})])])]),n("li",null,[e(a,{to:"#设置时区"},{default:l(()=>s[7]||(s[7]=[i("设置时区")])),_:1})]),n("li",null,[e(a,{to:"#减小打包体积"},{default:l(()=>s[8]||(s[8]=[i("减小打包体积")])),_:1})])])]),s[10]||(s[10]=c(`<h2 id="编译命令" tabindex="-1"><a class="header-anchor" href="#编译命令"><span>编译命令</span></a></h2><p>Goravel 项目可以通过以下命令编译：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">// 选择系统进行编译</span>
<span class="line">go run . artisan build</span>
<span class="line"></span>
<span class="line">// 指定系统进行编译</span>
<span class="line">go run . artisan build --os=linux</span>
<span class="line">go run . artisan build -o=linux</span>
<span class="line"></span>
<span class="line">// 静态编译</span>
<span class="line">go run . artisan build --static</span>
<span class="line">go run . artisan build -s</span>
<span class="line"></span>
<span class="line">// 指定输出文件名 </span>
<span class="line">go run . artisan build --name=goravel</span>
<span class="line">go run . artisan build -n=goravel</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="手动编译" tabindex="-1"><a class="header-anchor" href="#手动编译"><span>手动编译</span></a></h2><h3 id="常规编译" tabindex="-1"><a class="header-anchor" href="#常规编译"><span>常规编译</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">go build <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="部署服务器" tabindex="-1"><a class="header-anchor" href="#部署服务器"><span>部署服务器</span></a></h4><p>部署时需要将下列文件与文件夹上传至服务器：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">./main // 编译生成的二进制文件</span>
<span class="line">.env</span>
<span class="line">./public</span>
<span class="line">./storage</span>
<span class="line">./resources</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="静态编译" tabindex="-1"><a class="header-anchor" href="#静态编译"><span>静态编译</span></a></h3><p>常规编译后的包还需要依赖部署环境的支持，静态编译出的文件可以任意放到指定平台下运行，不需要环境配置。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">go build <span class="token parameter variable">--ldflags</span> <span class="token string">&quot;-extldflags -static&quot;</span> <span class="token parameter variable">-o</span> main <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="交叉编译" tabindex="-1"><a class="header-anchor" href="#交叉编译"><span>交叉编译</span></a></h3><p>编译有平台区分，需要根据部署情况，选择匹配的编译方式。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">// 编译 Linux 环境</span>
<span class="line"><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line">// 编译 Windows 环境</span>
<span class="line"><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>windows <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line">// 编译 Mac 环境</span>
<span class="line"><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>darwin <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="docker" tabindex="-1"><a class="header-anchor" href="#docker"><span>Docker</span></a></h2><p>Goravel 默认自带 <code>Dockerfile</code> 与 <code>docker-compose.yml</code> 文件，可以直接使用，注意此时 <code>APP_HOST</code> 应为 <code>0.0.0.0</code>。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> build <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>国内会有下载依赖较慢与时区问题，可以将 Dockerfile 内容替换为下面脚本：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">FROM golang:alpine AS builder</span>
<span class="line"></span>
<span class="line">ENV GO111MODULE=on \\</span>
<span class="line">    CGO_ENABLED=0  \\</span>
<span class="line">    GOARCH=&quot;amd64&quot; \\</span>
<span class="line">    GOOS=linux   \\</span>
<span class="line">    GOPROXY=https://goproxy.cn,direct</span>
<span class="line"></span>
<span class="line">WORKDIR /build</span>
<span class="line">COPY . .</span>
<span class="line">RUN go mod tidy</span>
<span class="line">RUN go build --ldflags &quot;-extldflags -static&quot; -o main .</span>
<span class="line"></span>
<span class="line">FROM alpine:latest</span>
<span class="line"></span>
<span class="line">RUN sed -i &#39;s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g&#39; /etc/apk/repositories</span>
<span class="line">RUN apk add tzdata &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\</span>
<span class="line">    &amp;&amp; echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone</span>
<span class="line">WORKDIR /www</span>
<span class="line"></span>
<span class="line">COPY --from=builder /build/main /www/</span>
<span class="line">COPY --from=builder /build/database/ /www/database/</span>
<span class="line">COPY --from=builder /build/public/ /www/public/</span>
<span class="line">COPY --from=builder /build/storage/ /www/storage/</span>
<span class="line">COPY --from=builder /build/resources/ /www/resources/</span>
<span class="line">COPY --from=builder /build/.env /www/.env</span>
<span class="line"></span>
<span class="line">ENTRYPOINT [&quot;/www/main&quot;]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="docker-compose" tabindex="-1"><a class="header-anchor" href="#docker-compose"><span>Docker Compose</span></a></h3><p>您也可以使用以下命令快速启动服务：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker-compose</span> build</span>
<span class="line"><span class="token function">docker-compose</span> up</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意：如需外部访问，需要将 APP_HOST 改为 0.0.0.0</p></blockquote><h2 id="设置时区" tabindex="-1"><a class="header-anchor" href="#设置时区"><span>设置时区</span></a></h2><p>当你在 <code>app.timezone</code> 配置中非 <code>UTC</code> 时区时，在编译时需要通过将时区设置到应用中，可以选择下面三种方式中的任意一种：</p><ol><li>在 Dockerfile 中添加时区设置</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">RUN apk add tzdata &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>在编译时设置时区</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">go build -tags timetzdata .</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>在 <code>main.go</code> 中导入时区</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">import</span> <span class="token punctuation">(</span></span>
<span class="line">    _ <span class="token string">&quot;time/tzdata&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="减小打包体积" tabindex="-1"><a class="header-anchor" href="#减小打包体积"><span>减小打包体积</span></a></h2><p>将 <code>config/app.go::providers</code> 中未用到的 <code>ServiceProvider</code> 注释掉将能有效地减少打包体积。</p>`,34)),e(d)])}const g=r(u,[["render",m],["__file","compile.html.vue"]]),k=JSON.parse('{"path":"/zh/getting-started/compile.html","title":"编译","lang":"zh-CN","frontmatter":{"description":"编译 编译命令 Goravel 项目可以通过以下命令编译： 手动编译 常规编译 部署服务器 部署时需要将下列文件与文件夹上传至服务器： 静态编译 常规编译后的包还需要依赖部署环境的支持，静态编译出的文件可以任意放到指定平台下运行，不需要环境配置。 交叉编译 编译有平台区分，需要根据部署情况，选择匹配的编译方式。 Docker Goravel 默认自带 ...","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://goravel.dev/getting-started/compile.html"}],["meta",{"property":"og:url","content":"https://goravel.dev/zh/getting-started/compile.html"}],["meta",{"property":"og:site_name","content":"Goravel"}],["meta",{"property":"og:title","content":"/getting-started/compile.html"}],["meta",{"property":"og:description","content":"编译 编译命令 Goravel 项目可以通过以下命令编译： 手动编译 常规编译 部署服务器 部署时需要将下列文件与文件夹上传至服务器： 静态编译 常规编译后的包还需要依赖部署环境的支持，静态编译出的文件可以任意放到指定平台下运行，不需要环境配置。 交叉编译 编译有平台区分，需要根据部署情况，选择匹配的编译方式。 Docker Goravel 默认自带 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"编译\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"编译命令","slug":"编译命令","link":"#编译命令","children":[]},{"level":2,"title":"手动编译","slug":"手动编译","link":"#手动编译","children":[{"level":3,"title":"常规编译","slug":"常规编译","link":"#常规编译","children":[]},{"level":3,"title":"静态编译","slug":"静态编译","link":"#静态编译","children":[]},{"level":3,"title":"交叉编译","slug":"交叉编译","link":"#交叉编译","children":[]}]},{"level":2,"title":"Docker","slug":"docker","link":"#docker","children":[{"level":3,"title":"Docker Compose","slug":"docker-compose","link":"#docker-compose","children":[]}]},{"level":2,"title":"设置时区","slug":"设置时区","link":"#设置时区","children":[]},{"level":2,"title":"减小打包体积","slug":"减小打包体积","link":"#减小打包体积","children":[]}],"git":{},"filePathRelative":"zh/getting-started/compile.md","autoDesc":true}');export{g as comp,k as data};
